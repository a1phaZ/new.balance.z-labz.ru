{"version":3,"sources":["handlers/currency.js","state/actions.js","components/ListOfItems.js","handlers/smoothScrollToTop.js","state/index.js","components/InfoSnackbar.js","components/MonthSwitch.js","panels/Home.js","handlers/useApi.js","handlers/validate.js","handlers/regexp.js","components/modals/AddAccount.js","components/modals/AddMoney.js","components/Color.js","handlers/mapRichCell.js","handlers/sort.js","components/SearchForm.js","panels/AccountInfo.js","panels/Budgets.js","components/modals/AddBudget.js","handlers/reduce.js","panels/BudgetInfo.js","panels/Stats.js","handlers/mapStats.js","panels/InitialScreen.js","panels/More.js","panels/ShopListPanel.js","App.js","handlers/useLocalStorage.js","index.js"],"names":["number","Intl","NumberFormat","style","currency","format","SET_MODAL","data","showAll","dispatch","itemsName","needHide","useState","isShow","setIsShow","length","list","sort","a","b","sum","map","account","index","key","indicator","expandable","data-id","_id","onClick","e","type","payload","id","currentTarget","dataset","view","panel","title","weight","marginBottom","push","smoothScrollToTop","c","document","documentElement","scrollTop","body","window","requestAnimationFrame","scrollTo","initialState","accounts","budgets","budget","modal","successMessage","error","activeView","activePanel","popout","editedItem","currentDate","Date","history","modalsHistory","popoutHistory","contextHistory","canClose","scheme","modalOpenTime","reducer","state","action","pushState","lastHistoryState","backEl","newHistory","pop","accountId","find","item","budgetId","alert","context","message","date","State","createContext","StateProvider","children","value","useReducer","Provider","InfoSnackbar","useContext","snackbar","setSnackbar","useEffect","onClose","before","color","onRefresh","disabledAfter","isAfter","addMonths","disabledBefore","isBefore","clickTime","setClickTime","disabled","timeNow","subMonths","mode","asideContent","textAlign","fontWeight","cursor","locale","ru","toLocaleUpperCase","Home","isFetching","shopList","sumOfAll","el","reduce","acc","cur","shopListDone","curr","done","shopListButton","left","MonthSwitch","header","separator","level","ListOfItems","url","isLoading","setLoading","response","setResponse","setError","options","setOptions","doApiFetch","useCallback","method","params","bodyFields","axiosOptions","baseURL","process","headers","queryString","parse","location","search","axios","then","catch","Error","fetchData","validity","valid","status","badInput","valueMissing","tooLong","typeMismatch","stepMismatch","rangeOverflow","rangeUnderflow","str","replace","titleValidation","sumValidation","stateForm","dispatchForm","useApi","onSubmit","preventDefault","placeholder","top","required","maxLength","bottom","onChange","regexp","validate","pattern","inputMode","max","min","step","size","income","description","price","quantity","tags","boxPrice","validateForm","shopListItemTitle","setShopListItemTitle","apiStr","descriptionShow","setDescriptionShow","accountList","Number","toFixed","toLowerCase","split","filter","tag","marginRight","maxWidth","overflow","overflowWrap","itemFrom","tzOffset","getTimezoneOffset","defaultValue","name","defaultChecked","join","display","flexWrap","checked","mapRichCell","caption","caps","ruLocale","outcome","Color","marginLeft","multiline","after","aDate","bDate","compareAsc","onSearch","searchStr","setSearchStr","searchRef","useRef","current","focus","substring","position","height","width","ref","isOpened","setIsOpened","operations","items","setItems","filteredItems","setFilteredItems","indexAr","prev","accountItemsListArray","Object","keys","forEach","splice","accountItemsList","toggleContext","actions","autoclose","indexOf","aside","transform","opened","SearchForm","bannerData","setBannerData","bridge","send","vertical","startSum","isEqual","deletedCount","alertDelete","itemsList","differenceInMonths","flat","localeCompare","setOperations","prevItem","slice","data-title","loading","icon","stretched","addToHomeScreenSupported","addedToHomeScreen","lastClickTime","setLastClickTime","userId","URL","href","searchParams","get","link","group_id","newList","findIndex","localStorage","removeItem","shopListFromServer","setShopList","success","dispatchList","deleteMode","setDeleteMode","selectable","removable","i","onRemove","App","os","platform","needFetch","setNeedFetch","lastBackAction","setLastBackAction","initialValue","getItem","JSON","console","log","storedValue","setStoredValue","valueToStore","Function","setItem","stringify","useLocalStorage","setAddToHomeScreenSupported","setAddedToHomeScreen","subscribe","detail","is_feature_supported","is_added_to_home_screen","result","onpopstate","modalBack","activeModal","ANDROID","right","IOS","AddAccount","AddMoney","AddBudget","onStoryChange","story","tabBar","itemsLayout","selected","data-story","data-panel","text","activeStory","tabbar","InitialScreen","AccountInfo","Budgets","BudgetInfo","Stats","More","ShopListPanel","ReactDOM","render","getElementById","toString"],"mappings":"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","file":"static/js/main.448681a9.chunk.js","sourcesContent":["export default (number) => {\r\n\treturn new Intl.NumberFormat('ru-RU', {style: 'currency', currency: 'RUB'}).format(number);\r\n}","export const SET_ACCOUNTS = 'SET_ACCOUNTS';\r\nexport const SET_BUDGETS = 'SET_BUDGETS';\r\nexport const SET_BUDGET = 'SET_BUDGET';\r\nexport const SET_MODAL = 'SET_MODAL';\r\nexport const SET_ERROR = 'SET_ERROR';\r\nexport const SET_SUCCESS_MESSAGE = 'SET_SUCCESS_MESSAGE';\r\nexport const SET_ACTIVE_VIEW = 'SET_ACTIVE_VIEW';\r\nexport const SET_ACCOUNT = 'SET_ACCOUNT';\r\nexport const SET_POPOUT = 'SET_POPOUT';\r\nexport const SET_EDITED_ITEM = 'SET_EDITED_ITEM';\r\nexport const SET_DATE = 'SET_DATE';\r\nexport const SET_HISTORY_BACK = 'SET_HISTORY_BACK';\r\nexport const SET_COLOR_SCHEME = 'SET_COLOR_SCHEME';\r\nexport const SET_TOGGLE_CONTEXT = 'SET_TOGGLE_CONTEXT';","import React, {useState} from 'react';\r\nimport Cell from \"@vkontakte/vkui/dist/components/Cell/Cell\";\r\nimport {Footer, Text} from \"@vkontakte/vkui\";\r\nimport currency from \"../handlers/currency\";\r\nimport {SET_ACCOUNT, SET_ACTIVE_VIEW, SET_BUDGET} from \"../state/actions\";\r\n\r\nexport default ({data, showAll = false, dispatch, itemsName, needHide = true}) => {\r\n\tconst [isShow, setIsShow] = useState(() => {\r\n\t\treturn showAll;\r\n\t});\r\n\r\n\tif (data.length === 0) {\r\n\t\tif (itemsName === 'accounts') {\r\n\t\t\treturn <Footer>Нет счетов для отображения</Footer>\r\n\t\t}\r\n\t\tif (itemsName === 'budgets') {\r\n\t\t\treturn <Footer>Нет бюджетов для отображения</Footer>\r\n\t\t}\r\n\t}\r\n\r\n\tlet list = data\r\n\t\t.sort((a, b) => {\r\n\t\t\treturn b.sum - a.sum;\r\n\t\t})\r\n\t\t.map((account, index) => {\r\n\t\t\tif (index === 3 && !isShow) {\r\n\t\t\t\treturn <Cell\r\n\t\t\t\t\tkey={'showAll'}\r\n\t\t\t\t\texpandable\r\n\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\tsetIsShow(true);\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Text weight=\"semibold\" style={{marginBottom: 16}}>\r\n\t\t\t\t\t\tПоказать все\r\n\t\t\t\t\t</Text>\r\n\t\t\t\t</Cell>\r\n\t\t\t}\r\n\t\t\tif (index > 3 && !isShow) {\r\n\t\t\t\treturn null\r\n\t\t\t}\r\n\t\t\treturn <Cell\r\n\t\t\t\tkey={index}\r\n\t\t\t\tindicator={currency(account.sum)}\r\n\t\t\t\texpandable\r\n\t\t\t\tdata-id={account._id}\r\n\t\t\t\tonClick={async (e) => {\r\n\t\t\t\t\tif (itemsName === 'accounts') {\r\n\t\t\t\t\t\tawait dispatch({type: SET_ACCOUNT, payload: {id: e.currentTarget.dataset.id}});\r\n\t\t\t\t\t\tawait dispatch({type: SET_ACTIVE_VIEW, payload: {view: 'info', panel: 'account'}});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (itemsName === 'budgets') {\r\n\t\t\t\t\t\tawait dispatch({type: SET_BUDGET, payload: {id: e.currentTarget.dataset.id}});\r\n\t\t\t\t\t\tawait dispatch({type: SET_ACTIVE_VIEW, payload: {view: 'info', panel: 'budget'}});\r\n\t\t\t\t\t}\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t{account.title}\r\n\t\t\t</Cell>\r\n\t\t});\r\n\tif (needHide) {\r\n\t\tif (isShow) list.push(<Cell\r\n\t\t\tkey={data.length}\r\n\t\t\texpandable\r\n\t\t\tonClick={() => {\r\n\t\t\t\tsetIsShow(false);\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<Text weight=\"semibold\" style={{marginBottom: 16}}>\r\n\t\t\t\t{itemsName === 'accounts' ? 'Скрыть счета' : 'Скрыть бюджеты'}\r\n\t\t\t</Text>\r\n\t\t</Cell>);\r\n\t}\r\n\r\n\r\n\treturn list;\r\n}","export const smoothScrollToTop = () => {\r\n\tconst c = document.documentElement.scrollTop || document.body.scrollTop;\r\n\r\n\tif (c > 30) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (c > 0) {\r\n\t\twindow.requestAnimationFrame(smoothScrollToTop);\r\n\t\twindow.scrollTo(0, c - c / 8);\r\n\t}\r\n};","import React, {createContext, useReducer} from 'react';\r\nimport {\r\n\tSET_ACCOUNT,\r\n\tSET_ACCOUNTS,\r\n\tSET_ACTIVE_VIEW,\r\n\tSET_BUDGET,\r\n\tSET_BUDGETS,\r\n\tSET_DATE,\r\n\tSET_EDITED_ITEM,\r\n\tSET_ERROR,\r\n\tSET_HISTORY_BACK,\r\n\tSET_MODAL,\r\n\tSET_POPOUT,\r\n\tSET_SUCCESS_MESSAGE,\r\n\tSET_COLOR_SCHEME, SET_TOGGLE_CONTEXT\r\n} from './actions';\r\nimport {smoothScrollToTop} from \"../handlers/smoothScrollToTop\";\r\n\r\nconst initialState = {\r\n\taccounts: [],\r\n\tbudgets: [],\r\n\taccount: null,\r\n\tbudget: null,\r\n\tmodal: null,\r\n\tsuccessMessage: null,\r\n\terror: null,\r\n\tactiveView: 'init',\r\n\tactivePanel: 'init',\r\n\tpopout: null,\r\n\teditedItem: null,\r\n\tcurrentDate: new Date(),\r\n\thistory: [],\r\n\tmodalsHistory: [],\r\n\tpopoutHistory: [],\r\n\tcontextHistory: false,\r\n\tcanClose: true,\r\n\tscheme: 'client_light',\r\n\tmodalOpenTime: +new Date()\r\n}\r\n\r\nconst reducer = (state, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase SET_COLOR_SCHEME: {\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tscheme: action.payload.scheme\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_ACTIVE_VIEW: {\r\n\t\t\twindow.history.pushState(null, null);\r\n\r\n\t\t\twindow.scrollTo(0, 30);\r\n\t\t\tsmoothScrollToTop();\r\n\r\n\t\t\tlet history = state.history;\r\n\t\t\tif (history.length !== 0) {\r\n\t\t\t\tlet lastHistoryState = history[history.length - 1];\r\n\t\t\t\tif (lastHistoryState.view === action.payload.view && lastHistoryState.panel === action.payload.panel) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\t...state\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\t...state,\r\n\t\t\t\t\t\tactiveView: action.payload.view,\r\n\t\t\t\t\t\tactivePanel: action.payload.panel,\r\n\t\t\t\t\t\thistory: [...history, {view: action.payload.view, panel: action.payload.panel}],\r\n\t\t\t\t\t\tcanClose: false,\r\n\t\t\t\t\t\tcontextHistory: false,\r\n\t\t\t\t\t\tsuccessMessage: null,\r\n\t\t\t\t\t\terror: null\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...state,\r\n\t\t\t\t\tactiveView: action.payload.view,\r\n\t\t\t\t\tactivePanel: action.payload.panel,\r\n\t\t\t\t\thistory: [...history, {view: action.payload.view, panel: action.payload.panel}],\r\n\t\t\t\t\tcanClose: true,\r\n\t\t\t\t\tcontextHistory: false,\r\n\t\t\t\t\tsuccessMessage: null,\r\n\t\t\t\t\terror: null\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_HISTORY_BACK: {\r\n\t\t\twindow.history.pushState(null, null);\r\n\r\n\t\t\twindow.scrollTo(0, 30);\r\n\t\t\tsmoothScrollToTop();\r\n\r\n\t\t\tconst backEl = state.history[state.history.length - 2];\r\n\t\t\tlet popoutHistory = state.popoutHistory || [];\r\n\t\t\tlet modalsHistory = state.modalsHistory || [];\r\n\t\t\tlet contextHistory = state.contextHistory || false;\r\n\r\n\t\t\tif (popoutHistory.length !== 0) {\r\n\t\t\t\tconst canClose = state.history.length <= 1;\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...state,\r\n\t\t\t\t\tpopout: null,\r\n\t\t\t\t\tpopoutHistory: [],\r\n\t\t\t\t\tcanClose: canClose,\r\n\t\t\t\t\teditedItem: null\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!!contextHistory) {\r\n\t\t\t\tconst canClose = state.history.length <= 1;\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...state,\r\n\t\t\t\t\tcontextHistory: false,\r\n\t\t\t\t\tcanClose: canClose,\r\n\t\t\t\t\teditedItem: null\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (modalsHistory.length !== 0) {\r\n\t\t\t\tif (+new Date() - state.modalOpenTime < 700) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\t...state\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tconst canClose = state.history.length <= 1;\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...state,\r\n\t\t\t\t\tmodal: null,\r\n\t\t\t\t\tmodalsHistory: [],\r\n\t\t\t\t\tcanClose: canClose,\r\n\t\t\t\t\teditedItem: null\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!backEl) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...state,\r\n\t\t\t\t\tactiveView: 'home',\r\n\t\t\t\t\tactivePanel: 'home',\r\n\t\t\t\t\thistory: [],\r\n\t\t\t\t\tcanClose: true,\r\n\t\t\t\t\teditedItem: null,\r\n\t\t\t\t\tsuccessMessage: null,\r\n\t\t\t\t\terror: null\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst canClose = (backEl.view === 'home' && backEl.panel === 'home');\r\n\t\t\t\tconst newHistory = state.history;\r\n\t\t\t\tnewHistory.pop();\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...state,\r\n\t\t\t\t\tactiveView: backEl.view,\r\n\t\t\t\t\tactivePanel: backEl.panel,\r\n\t\t\t\t\thistory: [...newHistory],\r\n\t\t\t\t\teditedItem: null,\r\n\t\t\t\t\tcanClose: canClose,\r\n\t\t\t\t\tsuccessMessage: null,\r\n\t\t\t\t\terror: null\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tcase SET_ACCOUNTS: {\r\n\t\t\tconst accountId = state.account?._id;\r\n\t\t\tconst account = !accountId ? accountId : action.payload.accounts.find(item => {\r\n\t\t\t\treturn item._id === accountId;\r\n\t\t\t})\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\taccounts: action.payload.accounts,\r\n\t\t\t\taccount: account\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_BUDGETS: {\r\n\t\t\tconst budgetId = state.budget?._id;\r\n\t\t\tconst budget = !budgetId ? budgetId : action.payload.budgets.find(item => item._id === budgetId)\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tbudgets: action.payload.budgets,\r\n\t\t\t\tbudget: budget\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_ACCOUNT: {\r\n\t\t\tconst {payload: {id}} = action;\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\taccount: state.accounts.find(item => {\r\n\t\t\t\t\treturn item._id === id;\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_BUDGET: {\r\n\t\t\tconst {payload: {id}} = action;\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tbudget: !id ? id : state.budgets.find(item => item._id === id)\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_EDITED_ITEM: {\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\teditedItem: action.payload.item\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_POPOUT: {\r\n\t\t\tif (action.payload.alert) {\r\n\t\t\t\twindow.history.pushState(null, null);\r\n\t\t\t}\r\n\t\t\tlet history = state.history;\r\n\t\t\tlet canClose = state.canClose;\r\n\t\t\tif (history.length !== 0 || action.payload.popout) {\r\n\t\t\t\tcanClose = history.length === 1 && !action.payload.popout;\r\n\t\t\t} else {\r\n\t\t\t\tif (history.length === 0 && !action.payload.popout) {\r\n\t\t\t\t\tcanClose = true\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tpopout: action.payload.popout,\r\n\t\t\t\tpopoutHistory: action.payload.popout ? [action.payload.popout] : [],\r\n\t\t\t\tcanClose: canClose\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_MODAL: {\r\n\t\t\t// window.history.pushState(null, null);\r\n\t\t\tlet history = state.history;\r\n\t\t\tlet canClose = state.canClose;\r\n\t\t\tif (history.length !== 0 || action.payload.modal) {\r\n\t\t\t\tcanClose = history.length === 1 && !action.payload.modal;\r\n\t\t\t} else {\r\n\t\t\t\tif (history.length === 0 && !action.payload.modal) {\r\n\t\t\t\t\tcanClose = true\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tmodal: action.payload.modal,\r\n\t\t\t\tmodalsHistory: action.payload.modal ? [action.payload.modal] : [],\r\n\t\t\t\tcanClose: canClose,\r\n\t\t\t\tmodalOpenTime: +new Date()\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_TOGGLE_CONTEXT: {\r\n\t\t\tlet history = state.history;\r\n\t\t\tlet canClose = state.canClose;\r\n\t\t\tif (history.length !== 0 || action.payload.context) {\r\n\t\t\t\tcanClose = history.length === 1 && !action.payload.context;\r\n\t\t\t} else {\r\n\t\t\t\tif (history.length === 0 && !action.payload.context) {\r\n\t\t\t\t\tcanClose = true\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\t// modal: action.payload.modal,\r\n\t\t\t\tcontextHistory: action.payload.context,\r\n\t\t\t\tcanClose: canClose\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_SUCCESS_MESSAGE: {\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tsuccessMessage: action.payload.message\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_ERROR: {\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\terror: action.payload.error\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_DATE: {\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tcurrentDate: new Date(action.payload.date)\r\n\t\t\t}\r\n\t\t}\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n}\r\n\r\nexport const State = createContext();\r\n\r\nexport const StateProvider = ({children}) => {\r\n\tconst value = useReducer(reducer, initialState);\r\n\treturn (\r\n\t\t<State.Provider value={value}>\r\n\t\t\t{children}\r\n\t\t</State.Provider>\r\n\t)\r\n}","import React, {useContext, useEffect, useState} from 'react';\r\nimport {Snackbar} from \"@vkontakte/vkui\";\r\nimport {State} from \"../state\";\r\nimport {SET_ERROR, SET_SUCCESS_MESSAGE} from \"../state/actions\";\r\nimport Icon24ErrorCircle from '@vkontakte/icons/dist/24/error_circle';\r\nimport Icon24CheckCircleOn from '@vkontakte/icons/dist/24/check_circle_on';\r\n\r\nconst InfoSnackbar = () => {\r\n\tconst [state, dispatch] = useContext(State);\r\n\tconst [snackbar, setSnackbar] = useState(null);\r\n\tuseEffect(() => {\r\n\t\tif (!state.error) return;\r\n\t\tsetSnackbar(<Snackbar\r\n\t\t\tonClose={\r\n\t\t\t\t() => {\r\n\t\t\t\t\tdispatch({type: SET_ERROR, payload: {error: null}});\r\n\t\t\t\t\tsetSnackbar(null);\r\n\t\t\t\t}}\r\n\t\t\tbefore={<Icon24ErrorCircle style={{color: 'var(--destructive)'}}/>}\r\n\t\t>\r\n\t\t\t{state.error.message}\r\n\t\t</Snackbar>)\r\n\t}, [setSnackbar, dispatch, state.error]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!state.successMessage) return;\r\n\t\tsetSnackbar(<Snackbar\r\n\t\t\tonClose={\r\n\t\t\t\t() => {\r\n\t\t\t\t\tdispatch({type: SET_SUCCESS_MESSAGE, payload: {message: null}});\r\n\t\t\t\t\tsetSnackbar(null);\r\n\t\t\t\t}}\r\n\t\t\tbefore={<Icon24CheckCircleOn style={{color: 'var(--accent)'}}/>}\r\n\t\t>\r\n\t\t\t{state.successMessage}\r\n\t\t</Snackbar>)\r\n\t}, [setSnackbar, dispatch, state.successMessage]);\r\n\treturn (\r\n\t\t<>\r\n\t\t\t{snackbar}\r\n\t\t</>\r\n\t)\r\n}\r\n\r\nexport default InfoSnackbar;","import React, {useContext, useState} from 'react';\r\nimport {addMonths, format, subMonths, isAfter, isBefore} from 'date-fns';\r\nimport {ru} from 'date-fns/locale';\r\nimport Icon24BrowserBack from '@vkontakte/icons/dist/24/browser_back';\r\nimport Icon24BrowserForward from '@vkontakte/icons/dist/24/browser_forward';\r\nimport {State} from \"../state\";\r\nimport {Button, Cell, Group} from \"@vkontakte/vkui\";\r\n\r\nexport default ({onRefresh}) => {\r\n\tconst [state, dispatch] = useContext(State);\r\n\tconst dateFormat = 'LLLL yyyy';\r\n\tconst disabledAfter = isAfter(addMonths(state.currentDate, 1), new Date());\r\n\tconst disabledBefore = isBefore(new Date(state.currentDate), new Date(2015, 0, 1));\r\n\tconst [clickTime, setClickTime] = useState(0);\r\n\t\r\n\tconst nextMonth = () => {\r\n\t\tlet timeNow = +new Date();\r\n\t\tif (timeNow - clickTime > 500) {\r\n\t\t\tdispatch({type: 'SET_DATE', payload: {date: (addMonths(state.currentDate, 1))}});\r\n\t\t\tonRefresh();\r\n\t\t\tsetClickTime(timeNow);\r\n\t\t}\r\n\t};\r\n\r\n\tconst prevMonth = () => {\r\n\t\tlet timeNow = +new Date();\r\n\t\tif (timeNow - clickTime > 500) {\r\n\t\t\tdispatch({type: 'SET_DATE', payload: {date: (subMonths(state.currentDate, 1))}});\r\n\t\t\tonRefresh();\r\n\t\t\tsetClickTime(timeNow);\r\n\t\t}\r\n\t};\r\n\r\n\treturn (\r\n\t\t<Group>\r\n\t\t\t<Cell\r\n\t\t\t\tbefore={<Button disabled={disabledBefore} onClick={prevMonth} mode={'secondary'}><Icon24BrowserBack/></Button>}\r\n\t\t\t\tasideContent={<Button disabled={disabledAfter} onClick={nextMonth}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmode={'secondary'}><Icon24BrowserForward/></Button>}\r\n\t\t\t\tstyle={{textAlign: 'center', fontWeight: 'bold'}}\r\n\t\t\t>\r\n\t\t\t\t<div style={{cursor: 'auto'}}>\r\n\t\t\t\t\t{format(state.currentDate, dateFormat, {locale: ru}).toLocaleUpperCase()}\r\n\t\t\t\t</div>\r\n\t\t\t</Cell>\r\n\t\t</Group>\r\n\t)\r\n}","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Panel from '@vkontakte/vkui/dist/components/Panel/Panel';\r\nimport PanelHeader from '@vkontakte/vkui/dist/components/PanelHeader/PanelHeader';\r\nimport Group from '@vkontakte/vkui/dist/components/Group/Group';\r\nimport Div from '@vkontakte/vkui/dist/components/Div/Div';\r\nimport {Button, Footer, Header, List, PanelHeaderButton, PullToRefresh, Title} from \"@vkontakte/vkui\";\r\nimport currency from \"../handlers/currency\";\r\nimport ListOfItems from \"../components/ListOfItems\";\r\nimport {SET_ACCOUNT, SET_ACTIVE_VIEW, SET_MODAL} from \"../state/actions\";\r\nimport Icon28MarketAddBadgeOutline from '@vkontakte/icons/dist/28/market_add_badge_outline';\r\nimport Icon28ListAddOutline from '@vkontakte/icons/dist/28/list_add_outline';\r\nimport InfoSnackbar from \"../components/InfoSnackbar\";\r\nimport MonthSwitch from \"../components/MonthSwitch\";\r\n\r\nconst Home = ({id, accounts, budgets, dispatch, onRefresh, isFetching, shopList}) => {\r\n\tconst sumOfAll = accounts.map(el => el.sum).reduce((acc, cur) => acc + cur, 0);\r\n\tconst shopListDone = shopList.reduce((acc, curr) => curr.done ? acc + 1 : acc, 0);\r\n\tconst shopListButton = (\r\n\t\t<Button\r\n\t\t\tmode={'tertiary'}\r\n\t\t\tonClick={() => {\r\n\t\t\t\tdispatch({type: SET_ACTIVE_VIEW, payload: {view: 'more', panel: 'shop-list'}})\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t{shopList.length === 0 ? 'Сформировать список покупок' : 'Перейти к списку покупок'}\r\n\t\t</Button>\r\n\t)\r\n\treturn (\r\n\t\t<Panel id={id}>\r\n\t\t\t<PanelHeader\r\n\t\t\t\tleft={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<PanelHeaderButton\r\n\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: 'add-account'}});\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<Icon28ListAddOutline/>\r\n\t\t\t\t\t\t</PanelHeaderButton>\r\n\t\t\t\t\t\t{accounts.length !== 0 && <PanelHeaderButton\r\n\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\tdispatch({type: SET_ACCOUNT, payload: {id: null}});\r\n\t\t\t\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: 'add-money'}});\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<Icon28MarketAddBadgeOutline/>\r\n\t\t\t\t\t\t</PanelHeaderButton>}\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t>Баланс</PanelHeader>\r\n\t\t\t<MonthSwitch onRefresh={onRefresh}/>\r\n\t\t\t<PullToRefresh onRefresh={onRefresh} isFetching={isFetching}>\r\n\t\t\t\t<List>\r\n\t\t\t\t\t<Group\r\n\t\t\t\t\t\theader={<Header mode=\"secondary\">Ваши счета</Header>}\r\n\t\t\t\t\t\tseparator=\"show\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Div>\r\n\t\t\t\t\t\t\t<Title level=\"1\" weight=\"semibold\" style={{marginBottom: 16}}>{currency(sumOfAll)}</Title>\r\n\t\t\t\t\t\t\t<ListOfItems data={accounts} dispatch={dispatch} showAll={false} itemsName={'accounts'}/>\r\n\t\t\t\t\t\t</Div>\r\n\t\t\t\t\t</Group>\r\n\t\t\t\t\t<Group\r\n\t\t\t\t\t\theader={<Header mode={'secondary'}>Ваши бюджеты</Header>}\r\n\t\t\t\t\t\tseparator={'show'}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Div>\r\n\t\t\t\t\t\t\t<ListOfItems data={budgets} dispatch={dispatch} showAll={false} itemsName={'budgets'}/>\r\n\t\t\t\t\t\t</Div>\r\n\t\t\t\t\t</Group>\r\n\t\t\t\t\t<Group\r\n\t\t\t\t\t\theader={<Header mode={'secondary'}>Список покупок</Header>}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{/*<ShopList list={shopList} dispatch={dispatch}/>*/}\r\n\t\t\t\t\t\t<Footer>\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tshopList.length === 0 ?\r\n\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t`Ваш список покупок пуст`\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t</> :\r\n\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t{`В Вашем списке покупок ${shopList.length} элементов. ${shopListDone} выполнено.`}\r\n\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t<br/>\r\n\t\t\t\t\t\t\t{shopListButton}\r\n\t\t\t\t\t\t</Footer>\r\n\t\t\t\t\t</Group>\r\n\t\t\t\t</List>\r\n\t\t\t</PullToRefresh>\r\n\t\t\t<InfoSnackbar/>\r\n\t\t</Panel>\r\n\t)\r\n};\r\n\r\nHome.propTypes = {\r\n\tid: PropTypes.string.isRequired,\r\n};\r\n\r\nexport default Home;\r\n","import React, {useState, useEffect, useCallback, useContext} from 'react';\r\nimport queryString from 'query-string';\r\nimport axios from 'axios';\r\nimport {SET_ERROR, SET_MODAL, SET_POPOUT, SET_SUCCESS_MESSAGE} from \"../state/actions\";\r\nimport {State} from \"../state\";\r\nimport {PopoutWrapper, ScreenSpinner} from \"@vkontakte/vkui\";\r\n\r\nexport default url => {\r\n\tconst [isLoading, setLoading] = useState(false);\r\n\tconst [response, setResponse] = useState(null);\r\n\tconst [error, setError] = useState(null);\r\n\tconst [options, setOptions] = useState({});\r\n\tconst [, dispatch] = useContext(State);\r\n\r\n\tconst apiBase = process.env.NODE_ENV !== 'development' ? process.env.REACT_APP_BASEURL : process.env.REACT_APP_BASEURL_DEV;\r\n\r\n\tconst doApiFetch = useCallback((options = {}) => {\r\n\t\tsetOptions(options);\r\n\t\tsetResponse(null);\r\n\t\tsetError(null);\r\n\t\tsetLoading(true);\r\n\t\tdispatch({type: SET_POPOUT, payload: {popout: (<PopoutWrapper><ScreenSpinner /></PopoutWrapper>)}});\r\n\t}, [dispatch]);\r\n\r\n\tconst {method = 'GET', params, ...bodyFields} = options;\r\n\tconst headers = {\r\n\t\t'Content-Type': 'application/json',\r\n\t}\r\n\tconst axiosOptions = {\r\n\t\tmethod: method,\r\n\t\tbaseURL: apiBase,\r\n\t\turl,\r\n\t\theaders,\r\n\t\tparams: params ? {...params, ...queryString.parse(window.location.search)} : {...queryString.parse(window.location.search)},\r\n\t\tdata: method !== 'GET' ? bodyFields : null,\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\r\n\t\tif (!isLoading) return;\r\n\r\n\t\tconst fetchData = async () => {\r\n\t\t\tsetLoading(false);\r\n\t\t\treturn await axios(axiosOptions)\r\n\t\t\t\t.then(async (response) => {\r\n\t\t\t\t\tsetResponse(response.data.data);\r\n\t\t\t\t\tdispatch({type: SET_POPOUT, payload: {popout: null}});\r\n\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: null}});\r\n\t\t\t\t\tdispatch({type: SET_SUCCESS_MESSAGE, payload: {message: response.data.message}});\r\n\t\t\t\t})\r\n\t\t\t\t.catch((error) => {\r\n\t\t\t\t\tlet e = error?.response ? error.response.data.error : new Error('Проблемы с подключением к API');\r\n\t\t\t\t\tsetError(e);\r\n\t\t\t\t\tsetLoading(false);\r\n\t\t\t\t\tdispatch({type: SET_POPOUT, payload: {popout: null}});\r\n\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: null}});\r\n\t\t\t\t\tdispatch({type: SET_ERROR, payload: {error: e}});\r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t\tfetchData();\r\n\r\n\t}, [isLoading, axiosOptions, dispatch]);\r\n\treturn [{isLoading, response, error}, doApiFetch];\r\n}","export default (e) => {\r\n\tconst validity = e.currentTarget.validity;\r\n\tif (validity.valid && e.currentTarget.value !== ' ') {\r\n\t\treturn {status: 'valid', message: null}\r\n\t} else {\r\n\t\tif (validity.badInput || validity.valueMissing || e.currentTarget.value === ' ') {\r\n\t\t\treturn {status: 'error', message: 'Неверный формат ввода | Отсутствует значение'}\r\n\t\t}\r\n\t\tif (validity.tooLong) {\r\n\t\t\treturn {status: 'error', message: 'Превышена максимальная длина'}\r\n\t\t}\r\n\t\tif (validity.typeMismatch) {\r\n\t\t\treturn {status: 'error', message: 'Несоответствие типа'}\r\n\t\t}\r\n\t\tif (validity.stepMismatch) {\r\n\t\t\treturn {status: 'error', message: 'Слишком большая дробная часть'}\r\n\t\t}\r\n\t\tif (validity.rangeOverflow) {\r\n\t\t\tif (e.currentTarget.type === 'date') return {status: 'error', message: 'Нельзя ввести будущую дату'}\r\n\t\t\treturn {status: 'error', message: 'Слишком большое число'}\r\n\t\t}\r\n\t\tif (validity.rangeUnderflow) {\r\n\t\t\tif (e.currentTarget.type === 'date') return {status: 'error', message: 'Нельзя ввести дату раньше 1 января 2015'}\r\n\t\t\treturn {status: 'error', message: 'Нельзя вводить отрицательные числа'}\r\n\t\t}\r\n\r\n\t\treturn {status: 'default', message: null}\r\n\t}\r\n}","// const ranges = [\r\n// \t'\\ud83c[\\udf00-\\udfff]', // U+1F300 to U+1F3FF\r\n// \t'\\ud83d[\\udc00-\\ude4f]', // U+1F400 to U+1F64F\r\n// \t'\\ud83d[\\ude80-\\udeff]'  // U+1F680 to U+1F6FF\r\n// ]\r\n//\r\n// const regexp = new RegExp(ranges.join('|'), 'g');\r\nexport default (str) => {\r\n\treturn str.replace(/^\\s*/g, '').replace(/\\s{2,}/g, ' ').replace(/<% RGI_Emoji %>|\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F|\\p{Emoji_Modifier_Base}/gu, '');\r\n}","import React, {useEffect, useReducer} from 'react';\r\nimport {Button, FormLayout, Input} from \"@vkontakte/vkui\";\r\nimport currency from \"../../handlers/currency\";\r\nimport useApi from \"../../handlers/useApi\";\r\nimport validate from \"../../handlers/validate\";\r\nimport regexp from \"../../handlers/regexp\";\r\nimport {SET_ACCOUNTS, SET_BUDGETS} from \"../../state/actions\";\r\n\r\nconst initialState = {\r\n\ttitle: '',\r\n\tsum: '',\r\n\ttitleValidation: {},\r\n\tsumValidation: {}\r\n}\r\n\r\nconst reducer = (state, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'CHANGE_STATE':\r\n\t\t\tconst {payload} = action;\r\n\t\t\t// if (payload.title === ' ' && state.title === '') {\r\n\t\t\t// \tconsole.log(payload.title);\r\n\t\t\t// \treturn {\r\n\t\t\t// \t\t...state,\r\n\t\t\t// \t\ttitle: payload.title,\r\n\t\t\t// \t\ttitleValidation: payload.titleValidation\r\n\t\t\t// \t}\r\n\t\t\t// }\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\t...payload\r\n\t\t\t}\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n}\r\n\r\nexport default ({onRefresh, dispatch}) => {\r\n\tconst [stateForm, dispatchForm] = useReducer(reducer, initialState);\r\n\tconst [{response}, doApiFetch] = useApi('/money-box');\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tdispatch({type: SET_ACCOUNTS, payload: {accounts: response?.accounts ? response?.accounts : []}});\r\n\t\tdispatch({type: SET_BUDGETS, payload: {budgets: response?.budgets ? response?.budgets : []}});\r\n\t}, [response, dispatch]);\r\n\r\n\treturn (\r\n\t\t<FormLayout\r\n\t\t\tonSubmit={async e => {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tawait doApiFetch({\r\n\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\ttitle: stateForm.title,\r\n\t\t\t\t\tsum: stateForm.sum\r\n\t\t\t\t});\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<Input type={'text'} placeholder={'Карта, наличные, счет в банке'} top={'Название'} value={stateForm.title}\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t maxLength={'20'}\r\n\t\t\t\t\t\t status={stateForm.titleValidation.status}\r\n\t\t\t\t\t\t bottom={stateForm.titleValidation.message ? stateForm.titleValidation.message : `${stateForm.title.length} из 20`}\r\n\t\t\t\t\t\t onChange={e => dispatchForm({type: 'CHANGE_STATE', payload: {title: regexp(e.currentTarget.value), titleValidation: validate(e)}})}/>\r\n\t\t\t<Input type={'number'} placeholder={currency(0)} top={'Баланс счета'} value={stateForm.sum}\r\n\t\t\t\t\t\t pattern={'[0-9]+([,\\\\.][0-9]+)?'}\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t status={stateForm.sumValidation.status}\r\n\t\t\t\t\t\t inputMode=\"decimal\"\r\n\t\t\t\t\t\t max={999999999}\r\n\t\t\t\t\t\t min={0}\r\n\t\t\t\t\t\t step={0.01}\r\n\t\t\t\t\t\t bottom={stateForm.sumValidation.message ? stateForm.sumValidation.message : 'Денежные средства, находящиеся на счете в данный момент'}\r\n\t\t\t\t\t\t onChange={e => dispatchForm({type: 'CHANGE_STATE', payload: {sum: e.currentTarget.value.replace(/[^\\d.]*/, ''), sumValidation: validate(e)}})}/>\r\n\t\t\t<Button size={'xl'}>Сохранить</Button>\r\n\t\t</FormLayout>\r\n\t)\r\n}","import React, {useEffect, useReducer, useState} from 'react';\r\nimport {format} from 'date-fns';\r\nimport {\r\n\tButton,\r\n\tCheckbox,\r\n\tCounter,\r\n\tDiv,\r\n\tFormLayout,\r\n\tFormLayoutGroup,\r\n\tInput,\r\n\tRadio,\r\n\tSelect,\r\n\tTextarea\r\n} from \"@vkontakte/vkui\";\r\nimport currency from \"../../handlers/currency\";\r\nimport useApi from \"../../handlers/useApi\";\r\nimport validate from \"../../handlers/validate\";\r\nimport regexp from \"../../handlers/regexp\";\r\nimport {SET_ACCOUNTS, SET_BUDGETS, SET_EDITED_ITEM} from \"../../state/actions\";\r\nimport Icon24AddSquareOutline from '@vkontakte/icons/dist/24/add_square_outline';\r\n\r\nconst initialState = {\r\n\taccount: '',\r\n\ttitle: '',\r\n\tdate: format(new Date(), 'yyyy-MM-dd'),\r\n\tincome: false,\r\n\tdescription: '',\r\n\tprice: '',\r\n\tquantity: '',\r\n\ttags: [],\r\n\tboxPrice: false,\r\n\tvalidate: {\r\n\t\taccount: {},\r\n\t\ttitle: {},\r\n\t\tdescription: {},\r\n\t\tprice: {},\r\n\t\tquantity: {},\r\n\t\ttags: {},\r\n\t}\r\n}\r\n\r\nconst reducer = (state, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'CHANGE_STATE':\r\n\t\t\tconst {payload: {validateForm, ...payload}} = action;\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\t...payload,\r\n\t\t\t\tvalidate: {...state.validate, ...validateForm}\r\n\t\t\t}\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n}\r\n\r\nexport default ({accounts, id = null, editedItem = null, dispatch, budget, panel = '', shopListItemTitle, setShopListItemTitle, date}) => {\r\n\tconst [apiStr] = useState(() => {\r\n\t\treturn !editedItem ? '/item' : `/item/${editedItem._id}`;\r\n\t})\r\n\tconst [{response}, doApiFetch] = useApi(apiStr);\r\n\tconst [state, dispatchForm] = useReducer(reducer, initialState);\r\n\tconst [descriptionShow, setDescriptionShow] = useState(() => !!state.description);\r\n\tconst accountList = accounts.map(item => {\r\n\t\treturn (<option key={item._id} value={item._id}>{item.title} ({currency(item.sum)})</option>)\r\n\t});\r\n\r\n\tuseEffect(() => {\r\n\t\tif (descriptionShow) return;\r\n\t\tsetDescriptionShow(!!state.description);\r\n\t}, [state.description, descriptionShow]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!shopListItemTitle) return;\r\n\t\tdispatchForm({type: 'CHANGE_STATE', payload: {title: shopListItemTitle}})\r\n\t}, [shopListItemTitle]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!editedItem) return;\r\n\t\teditedItem.date = format(new Date(editedItem.date), 'yyyy-MM-dd');\r\n\t\tif (editedItem.boxPrice) {\r\n\t\t\teditedItem.price = Number(editedItem.sum).toFixed(2);\r\n\t\t}\r\n\t\tdispatchForm({type: 'CHANGE_STATE', payload: {...editedItem}});\r\n\t}, [editedItem]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!budget?.title) return;\r\n\t\tif (panel === 'home') return;\r\n\t\tdispatchForm({\r\n\t\t\ttype: 'CHANGE_STATE',\r\n\t\t\tpayload: {\r\n\t\t\t\ttags: editedItem?.tags || budget?.title.toLowerCase().split(' ')\r\n\t\t\t}\r\n\t\t})\r\n\t}, [budget, panel, editedItem]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tdispatch({type: SET_ACCOUNTS, payload: {accounts: response?.accounts ? response?.accounts : []}});\r\n\t\tdispatch({type: SET_BUDGETS, payload: {budgets: response?.budgets ? response?.budgets : []}});\r\n\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: null}});\r\n\t}, [response, dispatch]);\r\n\r\n\tconst tags = state.tags.filter(tag => !!tag.length).map(\r\n\t\t(tag, index) =>\r\n\t\t\t<Counter\r\n\t\t\t\tstyle={{\r\n\t\t\t\t\tmarginRight: '5px',\r\n\t\t\t\t\tmarginBottom: '5px',\r\n\t\t\t\t\tmaxWidth: '100%',\r\n\t\t\t\t\toverflow: 'hidden',\r\n\t\t\t\t\toverflowWrap: 'normal'\r\n\t\t\t\t}}\r\n\t\t\t\tkey={index}\r\n\t\t\t>\r\n\t\t\t\t{tag}\r\n\t\t\t</Counter>\r\n\t);\r\n\r\n\treturn (\r\n\t\t<FormLayout\r\n\t\t\tonSubmit={e => {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tdoApiFetch({\r\n\t\t\t\t\tmethod: !editedItem ? 'POST' : 'PATCH',\r\n\t\t\t\t\tdate: state.date,\r\n\t\t\t\t\ttitle: state.title,\r\n\t\t\t\t\tdescription: state.income ? '' : state.description,\r\n\t\t\t\t\tprice: state.boxPrice ? (state.price / state.quantity).toFixed(4) : Number(state.price).toFixed(2),\r\n\t\t\t\t\tquantity: state.quantity,\r\n\t\t\t\t\tincome: state.income,\r\n\t\t\t\t\ttags: state.tags.filter(tag => !!tag.length),\r\n\t\t\t\t\titemFrom: state.account || editedItem?.itemFrom || id,\r\n\t\t\t\t\tboxPrice: state.boxPrice,\r\n\t\t\t\t\tparams: {\r\n\t\t\t\t\t\tdate: new Date(date),\r\n\t\t\t\t\t\ttzOffset: new Date().getTimezoneOffset()\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tsetShopListItemTitle('');\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<Select top={'Счет'}\r\n\t\t\t\t\t\t\tplaceholder={'Выберите счет'}\r\n\t\t\t\t\t\t\tonChange={(e) => {\r\n\t\t\t\t\t\t\t\tdispatchForm({\r\n\t\t\t\t\t\t\t\t\ttype: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t\t\tpayload: {account: e.currentTarget.value, validateForm: {account: validate(e)}}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\tdefaultValue={state.account || editedItem?.itemFrom || id} required={true}\r\n\t\t\t\t\t\t\tstatus={state.validate?.account?.status}\r\n\t\t\t\t\t\t\tbottom={state.validate?.account?.message}\r\n\t\t\t>\r\n\t\t\t\t{accountList}\r\n\t\t\t</Select>\r\n\t\t\t<Input type={'date'}\r\n\t\t\t\t\t\t top={'Дата'}\r\n\t\t\t\t\t\t value={state.date}\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t min={'2015-01-01'}\r\n\t\t\t\t\t\t max={format(new Date(), 'yyyy-MM-dd')}\r\n\t\t\t\t\t\t onChange={(e) => {\r\n\t\t\t\t\t\t\t dispatchForm({\r\n\t\t\t\t\t\t\t\t type: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t\t payload: {date: e.currentTarget.value, validateForm: {date: validate(e)}}\r\n\t\t\t\t\t\t\t })\r\n\t\t\t\t\t\t }}\r\n\t\t\t\t\t\t status={state.validate?.date?.status}\r\n\t\t\t\t\t\t bottom={state.validate?.date?.message}\r\n\t\t\t/>\r\n\t\t\t<Input type={'text'}\r\n\t\t\t\t\t\t placeholder={'Продукт, услуга, товар'}\r\n\t\t\t\t\t\t value={state.title}\r\n\t\t\t\t\t\t top={'Название'}\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t maxLength={20}\r\n\t\t\t\t\t\t status={state.validate?.title?.status}\r\n\t\t\t\t\t\t bottom={state.validate?.title?.message ? state.validate?.title?.message : `${state.title.length} из 20`}\r\n\t\t\t\t\t\t onChange={(e) => {\r\n\t\t\t\t\t\t\t dispatchForm({\r\n\t\t\t\t\t\t\t\t type: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t\t payload: {\r\n\t\t\t\t\t\t\t\t\t title: regexp(e.currentTarget.value),\r\n\t\t\t\t\t\t\t\t\t validateForm: {title: validate(e)}\r\n\t\t\t\t\t\t\t\t }\r\n\t\t\t\t\t\t\t })\r\n\t\t\t\t\t\t }}/>\r\n\t\t\t<Radio name={'income'}\r\n\t\t\t\t\t\t value={false}\r\n\t\t\t\t\t\t defaultChecked={state.income ? null : true}\r\n\t\t\t\t\t\t onClick={() => {\r\n\t\t\t\t\t\t\t dispatchForm({type: 'CHANGE_STATE', payload: {income: false}})\r\n\t\t\t\t\t\t }}\r\n\t\t\t>\r\n\t\t\t\tРасход\r\n\t\t\t</Radio>\r\n\t\t\t<Radio name={'income'}\r\n\t\t\t\t\t\t value={true}\r\n\t\t\t\t\t\t defaultChecked={state.income ? true : null}\r\n\t\t\t\t\t\t onClick={() => {\r\n\t\t\t\t\t\t\t dispatchForm({type: 'CHANGE_STATE', payload: {income: true}})\r\n\t\t\t\t\t\t\t setDescriptionShow(false);\r\n\t\t\t\t\t\t }}\r\n\t\t\t\t\t\t disabled={!!shopListItemTitle}\r\n\t\t\t>\r\n\t\t\t\tДоход\r\n\t\t\t</Radio>\r\n\t\t\t{!state.income\r\n\t\t\t&&\r\n\t\t\t\t<FormLayoutGroup top={'Описание'}>\r\n\t\t\t\t\t<Button\r\n\t\t\t\t\t\ttype={'button'}\r\n\t\t\t\t\t\tmode=\"secondary\"\r\n\t\t\t\t\t\tbefore={<Icon24AddSquareOutline/>}\r\n\t\t\t\t\t\tsize=\"l\"\r\n\t\t\t\t\t\tdisabled={state.description || descriptionShow}\r\n\t\t\t\t\t\t// style={state.description ? {display: 'none'} : {}}\r\n\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\tsetDescriptionShow(true);\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\tДобавить описание\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t(descriptionShow || state.description) &&\r\n\t\t\t\t\t\t<Textarea top={'Описание'}\r\n\t\t\t\t\t\t\t\t\t\t\tplaceholder={'Описание товара(продукта, услуги)'}\r\n\t\t\t\t\t\t\t\t\t\t\tvalue={state.description}\r\n\t\t\t\t\t\t\t\t\t\t\tmaxLength={70}\r\n\t\t\t\t\t\t\t\t\t\t\tstatus={state.validate?.description?.status}\r\n\t\t\t\t\t\t\t\t\t\t\tbottom={state.validate?.description?.message ? state.validate?.description?.message : `${state.description.length} из 70`}\r\n\t\t\t\t\t\t\t\t\t\t\tonChange={(e) => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tdispatchForm({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tpayload: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: regexp(e.currentTarget.value),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalidateForm: {description: validate(e)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t}\r\n\t\t\t\t</FormLayoutGroup>\r\n\t\t\t\t}\r\n\t\t\t<Input type={'text'}\r\n\t\t\t\t\t\t top={'Теги'}\r\n\t\t\t\t\t\t value={state.tags.join(' ')}\r\n\t\t\t\t\t\t placeholder={'Теги через пробел'}\r\n\t\t\t\t\t\t status={state.validate?.tags?.status}\r\n\t\t\t\t\t\t maxLength={50}\r\n\t\t\t\t\t\t bottom={state.validate?.tags?.message ? state.validate?.tags?.message : `${state.tags.join(' ').length} из 50 символов`}\r\n\t\t\t\t\t\t onChange={(e) => {\r\n\t\t\t\t\t\t\t dispatchForm({\r\n\t\t\t\t\t\t\t\t type: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t\t payload: {\r\n\t\t\t\t\t\t\t\t\t tags: e.currentTarget.value !== '' ? regexp(e.currentTarget.value).toLowerCase().split(' ') : [],\r\n\t\t\t\t\t\t\t\t\t validateForm: {tags: validate(e)}\r\n\t\t\t\t\t\t\t\t }\r\n\t\t\t\t\t\t\t })\r\n\t\t\t\t\t\t }}\r\n\t\t\t/>\r\n\t\t\t{\r\n\t\t\t\t!!tags.length &&\r\n\t\t\t\tstate.tags.length !== 0\r\n\t\t\t\t&&\r\n\t\t\t\t<Div style={{display: 'flex', flexWrap: 'wrap'}}>\r\n\t\t\t\t\t{tags}\r\n\t\t\t\t</Div>\r\n\t\t\t}\r\n\t\t\t<Input type={'number'}\r\n\t\t\t\t\t\t placeholder={currency(0)}\r\n\t\t\t\t\t\t pattern={'[0-9]+([,\\\\.][0-9]+)?'}\r\n\t\t\t\t\t\t top={'Цена'}\r\n\t\t\t\t\t\t inputMode=\"decimal\"\r\n\t\t\t\t\t\t max={99999999}\r\n\t\t\t\t\t\t min={0}\r\n\t\t\t\t\t\t step={0.0001}\r\n\t\t\t\t\t\t status={state.validate?.price?.status}\r\n\t\t\t\t\t\t bottom={state.validate?.price?.message}\r\n\t\t\t\t\t\t value={state.price}\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t onChange={(e) => {\r\n\t\t\t\t\t\t\t dispatchForm({\r\n\t\t\t\t\t\t\t\t type: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t\t payload: {price: e.currentTarget.value.replace(/[^\\d.]*/, ''), validateForm: {price: validate(e)}}\r\n\t\t\t\t\t\t\t })\r\n\t\t\t\t\t\t }}\r\n\t\t\t/>\r\n\t\t\t{\r\n\t\t\t\t!state.income\r\n\t\t\t\t&&\r\n\t\t\t\t<Checkbox checked={state.boxPrice}\r\n\t\t\t\t\t\t\t\t\tonChange={() => {\r\n\t\t\t\t\t\t\t\t\t\tdispatchForm({type: 'CHANGE_STATE', payload: {boxPrice: !state.boxPrice}})\r\n\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\tЦена за упаковку\r\n\t\t\t\t</Checkbox>\r\n\t\t\t}\r\n\t\t\t<Input type={'number'}\r\n\t\t\t\t\t\t placeholder={'0'}\r\n\t\t\t\t\t\t pattern={'[0-9]+([,\\\\.][0-9]+)?'}\r\n\t\t\t\t\t\t top={'Кол-во'}\r\n\t\t\t\t\t\t inputMode=\"decimal\"\r\n\t\t\t\t\t\t max={9999999}\r\n\t\t\t\t\t\t min={0}\r\n\t\t\t\t\t\t step={0.001}\r\n\t\t\t\t\t\t status={state.validate?.quantity?.status}\r\n\t\t\t\t\t\t bottom={state.validate?.quantity?.message}\r\n\t\t\t\t\t\t value={state.quantity}\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t onChange={(e) => {\r\n\t\t\t\t\t\t\t dispatchForm({\r\n\t\t\t\t\t\t\t\t type: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t\t payload: {\r\n\t\t\t\t\t\t\t\t\t quantity: e.currentTarget.value.replace(/[^\\d.]*/, ''),\r\n\t\t\t\t\t\t\t\t\t validateForm: {quantity: validate(e)}\r\n\t\t\t\t\t\t\t\t }\r\n\t\t\t\t\t\t\t })\r\n\t\t\t\t\t\t }}\r\n\t\t\t/>\r\n\t\t\t<Button size={'xl'}>\r\n\t\t\t\t{`Сохранить ${state.boxPrice ? currency(state.price) : currency(state.price * state.quantity)}`}\r\n\t\t\t</Button>\r\n\t\t</FormLayout>\r\n\t)\r\n}","import React from 'react';\r\nimport currency from \"../handlers/currency\";\r\n\r\nexport default ({color = 'black', value}) => {\r\n\tif (!value) return null;\r\n\treturn (\r\n\t\t<span style={{color: color}}>\r\n\t\t\t{currency(value)}\r\n\t\t</span>\r\n\t)\r\n}","import React from 'react';\r\nimport {Caption, RichCell} from \"@vkontakte/vkui\";\r\nimport {format} from \"date-fns\";\r\nimport ruLocale from \"date-fns/locale/ru\";\r\nimport currency from \"./currency\";\r\nimport {SET_EDITED_ITEM, SET_MODAL} from \"../state/actions\";\r\nimport Color from \"../components/Color\";\r\n\r\nexport default function mapRichCell(dispatch) {\r\n\treturn (item, index) => {\r\n\t\tif (item?.caption) {\r\n\t\t\treturn (\r\n\t\t\t\t<Caption level=\"2\" weight=\"semibold\" caps\r\n\t\t\t\t\t\t\t\t key={index}>\r\n\t\t\t\t\t{format(new Date(item?.date), 'dd MMMM yyyy ', {locale: ruLocale})}\r\n\t\t\t\t\t<br/>\r\n\t\t\t\t\t{item?.income && item?.outcome ? ' [ ' : null}\r\n\t\t\t\t\t<Color value={item?.income} color={'green'}/>\r\n\t\t\t\t\t{item?.income && item?.outcome ? ' | ' : null}\r\n\t\t\t\t\t<Color value={item?.outcome} color={'red'}/>\r\n\t\t\t\t\t{item?.income && item?.outcome ? ' ]' : null}\r\n\t\t\t\t</Caption>\r\n\t\t\t)\r\n\t\t}\r\n\r\n\t\tconst tags = item?.tags.filter(tag => !!tag.length).map(\r\n\t\t\t(tag, index) =>\r\n\t\t\t\t<span key={index} style={{\r\n\t\t\t\t\tmarginLeft: '5px',\r\n\t\t\t\t\tmarginRight: '5px',\r\n\t\t\t\t\tmarginBottom: '5px',\r\n\t\t\t\t\tmaxWidth: '100%',\r\n\t\t\t\t\toverflow: 'hidden',\r\n\t\t\t\t\toverflowWrap: 'normal',\r\n\t\t\t\t\t// background: 'var(--counter_secondary_background)',\r\n\t\t\t\t\t// color: 'var(--counter_secondary_text)',\r\n\t\t\t\t\t// padding: '5px'\r\n\t\t\t\t}}><b>{tag}</b></span>\r\n\t\t);\r\n\t\treturn (\r\n\t\t\t<RichCell\r\n\t\t\t\tkey={index}\r\n\t\t\t\tmultiline\r\n\t\t\t\tcaption={item?.tags.length !== 0 && <div style={{display: 'flex', flexWrap: 'wrap'}}><span>Теги:</span> {tags}</div>}\r\n\t\t\t\tafter={item?.income ? currency(item?.sum) : currency(-1 * item?.sum)}\r\n\t\t\t\tdata-id={item?._id}\r\n\t\t\t\tonClick={() => {\r\n\t\t\t\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: item}});\r\n\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: 'add-money'}});\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t{item?.title}\r\n\t\t\t</RichCell>\r\n\t\t)\r\n\t};\r\n}","import compareAsc from \"date-fns/compareAsc\";\r\n\r\nexport default function (a, b){\r\n\tconst aDate = new Date(a.date);\r\n\tconst bDate = new Date(b.date);\r\n\treturn compareAsc(bDate, aDate);\r\n}","import React, {useRef, useState, useEffect} from 'react';\r\nimport {FormLayout, Search} from \"@vkontakte/vkui\";\r\n\r\nexport default ({onSearch}) => {\r\n\r\n\tconst [searchStr, setSearchStr] = useState('');\r\n\tconst searchRef = useRef(null);\r\n\r\n\tuseEffect(() => {\r\n\t\tonSearch(searchStr);\r\n\t}, [searchStr, onSearch])\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t<FormLayout\r\n\t\t\tonSubmit={(e) => {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tsearchRef.current.focus();\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<Search\r\n\t\t\t\tvalue={searchStr}\r\n\t\t\t\tonChange={(e) => {\r\n\t\t\t\t\tsetSearchStr(e.currentTarget.value.substring(0, 20))\r\n\t\t\t\t}}\r\n\t\t\t/>\r\n\t\t</FormLayout>\r\n\t\t<input type={'radio'} style={{position: 'absolute', height: '0', width: '0', top: '0', left: '0'}} ref={searchRef}/>\r\n\t\t</>\r\n\t)\r\n}\r\n","import React, {useEffect, useState} from 'react';\r\nimport useApi from \"../handlers/useApi\";\r\nimport {\r\n\tAlert,\r\n\tCell,\r\n\tDiv,\r\n\tFooter,\r\n\tHeader,\r\n\tList,\r\n\tPanel,\r\n\tPanelHeader,\r\n\tPanelHeaderBack,\r\n\tPanelHeaderButton,\r\n\tPanelHeaderContent,\r\n\tPanelHeaderContext,\r\n\tTitle\r\n} from \"@vkontakte/vkui\";\r\nimport currency from \"../handlers/currency\";\r\nimport Group from \"@vkontakte/vkui/dist/components/Group/Group\";\r\nimport {\r\n\tSET_ACCOUNTS,\r\n\tSET_BUDGETS,\r\n\tSET_EDITED_ITEM,\r\n\tSET_HISTORY_BACK,\r\n\tSET_MODAL,\r\n\tSET_POPOUT,\r\n\tSET_TOGGLE_CONTEXT\r\n} from \"../state/actions\";\r\nimport Icon28MarketAddBadgeOutline from \"@vkontakte/icons/dist/28/market_add_badge_outline\";\r\nimport Icon16Dropdown from '@vkontakte/icons/dist/16/dropdown';\r\n\r\nimport Icon28DeleteOutline from '@vkontakte/icons/dist/28/delete_outline';\r\nimport mapRichCell from \"../handlers/mapRichCell\";\r\nimport InfoSnackbar from \"../components/InfoSnackbar\";\r\nimport sort from \"../handlers/sort\";\r\nimport MonthSwitch from \"../components/MonthSwitch\";\r\nimport SearchForm from \"../components/SearchForm\";\r\n\r\nexport default ({id, account, dispatch, onRefresh, context, date}) => {\r\n\tconst [isOpened, setIsOpened] = useState(() => context);\r\n\tconst [{response}, doApiFetch] = useApi(`/money-box/${account?._id}`);\r\n\tconst [items, setItems] = useState(() => {\r\n\t\tif (!account) return [];\r\n\t\treturn account?.operations;\r\n\t});\r\n\tconst [searchStr, setSearchStr] = useState('');\r\n\tconst [filteredItems, setFilteredItems] = useState(() => items || []);\r\n\r\n\tconst indexAr = filteredItems.sort(sort).reduce((prev, curr) => {\r\n\t\tconst index = +new Date(curr.date);\r\n\t\tif (prev[index]) {\r\n\t\t\tprev[index] = [...prev[index], curr];\r\n\t\t} else {\r\n\t\t\tprev[index] = [curr];\r\n\t\t}\r\n\t\treturn prev;\r\n\t}, {});\r\n\r\n\tlet accountItemsListArray = [];\r\n\r\n\tObject.keys(indexAr).forEach(key => {\r\n\t\tconst items = indexAr[key];\r\n\t\tlet date = '';\r\n\t\tindexAr[key].income = 0;\r\n\t\tindexAr[key].outcome = 0;\r\n\t\titems.forEach(item => {\r\n\t\t\tdate = item.date;\r\n\t\t\taccountItemsListArray.splice(0,0, item);\r\n\t\t\tif (item.income) {\r\n\t\t\t\tindexAr[key].income += item.sum;\r\n\t\t\t} else {\r\n\t\t\t\tindexAr[key].outcome += item.sum;\r\n\t\t\t}\r\n\t\t})\r\n\t\tindexAr[key].income = indexAr[key].income.toFixed(2);\r\n\t\tindexAr[key].outcome = indexAr[key].outcome.toFixed(2);\r\n\t\taccountItemsListArray.splice(0,0,{date: date, income: indexAr[key].income, outcome: indexAr[key].outcome, caption: true})\r\n\t})\r\n\r\n\tconst accountItemsList = accountItemsListArray.sort(sort).map(mapRichCell(dispatch));\r\n\r\n\tconst toggleContext = () => {\r\n\t\tdispatch({type: SET_TOGGLE_CONTEXT, payload: {context: !isOpened}});\r\n\t}\r\n\tconst alert = (\r\n\t\t<Alert\r\n\t\t\tactions={[\r\n\t\t\t\t{\r\n\t\t\t\t\ttitle: 'Отмена',\r\n\t\t\t\t\tautoclose: true,\r\n\t\t\t\t\tmode: \"cancel\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttitle: 'Удалить',\r\n\t\t\t\t\tmode: 'destructive',\r\n\t\t\t\t\tautoclose: true,\r\n\t\t\t\t\taction: async () => {\r\n\t\t\t\t\t\ttoggleContext();\r\n\t\t\t\t\t\tawait doApiFetch({\r\n\t\t\t\t\t\t\tmethod: 'DELETE',\r\n\t\t\t\t\t\t\tparams: {\r\n\t\t\t\t\t\t\t\tdate: date\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]}\r\n\t\t\tonClose={() => {\r\n\t\t\t\ttoggleContext();\r\n\t\t\t\tdispatch({type: SET_POPOUT, payload: {popout: null}})\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<h2>Удалить счет?</h2>\r\n\t\t\t<p>Удаление счета приведет к удалению всех данных по доходам и расходам, привязанным к данному счету. Суммы\r\n\t\t\t\tбюджетов могут отображаться некорректно.</p>\r\n\t\t</Alert>\r\n\t)\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!account) return;\r\n\t\tsetItems(account?.operations);\r\n\t\tsetFilteredItems(account?.operations);\r\n\t}, [account]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tdispatch({type: SET_HISTORY_BACK});\r\n\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: null}});\r\n\t\tdispatch({type: SET_ACCOUNTS, payload: {accounts: response?.accounts ? response?.accounts : []}});\r\n\t\tdispatch({type: SET_BUDGETS, payload: {budgets: response?.budgets ? response?.budgets : []}});\r\n\t}, [dispatch, response]);\r\n\r\n\tuseEffect(() => {\r\n\t\tsetIsOpened(context);\r\n\t}, [context]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (searchStr === '') {\r\n\t\t\tsetFilteredItems(items);\r\n\t\t} else {\r\n\t\t\tsetFilteredItems(account?.operations.filter(({title}) => title.toLowerCase().indexOf(searchStr.toLowerCase()) > -1));\r\n\t\t}\r\n\t}, [searchStr, account, items]);\r\n\r\n\tconst onSearch = (str) => {\r\n\t\tsetSearchStr(str);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Panel id={id}>\r\n\t\t\t<PanelHeader left={\r\n\t\t\t\t<>\r\n\t\t\t\t\t<PanelHeaderBack onClick={() => {\r\n\t\t\t\t\t\tdispatch({type: SET_HISTORY_BACK})\r\n\t\t\t\t\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: null}});\r\n\t\t\t\t\t}}/>\r\n\t\t\t\t\t<PanelHeaderButton\r\n\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: null}});\r\n\t\t\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: 'add-money'}});\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Icon28MarketAddBadgeOutline/>\r\n\t\t\t\t\t</PanelHeaderButton>\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\t\t\t>\r\n\t\t\t\t<PanelHeaderContent\r\n\t\t\t\t\taside={account && <Icon16Dropdown style={{transform: `rotate(${isOpened ? '180deg' : '0'})`}}/>}\r\n\t\t\t\t\tonClick={toggleContext}\r\n\t\t\t\t>\r\n\t\t\t\t\t{account ? account?.title : 'Счет удалён'}\r\n\t\t\t\t</PanelHeaderContent>\r\n\t\t\t</PanelHeader>\r\n\t\t\t{\r\n\t\t\t\taccount\r\n\t\t\t\t&&\r\n\t\t\t\t<>\r\n\t\t\t\t\t<PanelHeaderContext opened={isOpened} onClose={toggleContext}>\r\n\t\t\t\t\t\t<List>\r\n\t\t\t\t\t\t\t<Cell\r\n\t\t\t\t\t\t\t\tbefore={<Icon28DeleteOutline/>}\r\n\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\tdispatch({type: SET_POPOUT, payload: {popout: alert, alert: true}})\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tУдалить счет {account?.title}\r\n\t\t\t\t\t\t\t</Cell>\r\n\t\t\t\t\t\t</List>\r\n\t\t\t\t\t</PanelHeaderContext>\r\n\t\t\t\t\t<MonthSwitch onRefresh={onRefresh}/>\r\n\r\n\t\t\t\t\t<SearchForm onSearch={onSearch}/>\r\n\r\n\t\t\t\t\t<Group\r\n\t\t\t\t\t\theader={<Header mode=\"secondary\">Информация по счету</Header>}\r\n\t\t\t\t\t\tseparator=\"show\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Div>\r\n\t\t\t\t\t\t\t<Title level=\"1\" weight=\"semibold\" style={{marginBottom: 16}}>{currency(account?.sum)}</Title>\r\n\t\t\t\t\t\t</Div>\r\n\r\n\t\t\t\t\t\t{account?.operations.length === 0 && <Footer>Операций по счету еще не было</Footer>}\r\n\t\t\t\t\t\t<Div>\r\n\t\t\t\t\t\t\t{accountItemsList}\r\n\t\t\t\t\t\t\t{accountItemsList.length === 0 && <Footer>Нет данных для отображения</Footer>}\r\n\t\t\t\t\t\t</Div>\r\n\t\t\t\t\t</Group>\r\n\t\t\t\t\t<InfoSnackbar/>\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\r\n\t\t</Panel>\r\n\t)\r\n}","import React, {useEffect} from 'react';\r\nimport {format} from 'date-fns';\r\nimport ruLocale from 'date-fns/locale/ru';\r\nimport {FixedLayout, Footer, Group, Header, Panel, PanelHeader, PanelHeaderButton, PromoBanner} from \"@vkontakte/vkui\";\r\nimport ListOfItems from \"../components/ListOfItems\";\r\nimport {SET_MODAL} from \"../state/actions\";\r\nimport Icon28ListAddOutline from \"@vkontakte/icons/dist/28/list_add_outline\";\r\nimport InfoSnackbar from \"../components/InfoSnackbar\";\r\nimport MonthSwitch from \"../components/MonthSwitch\";\r\nimport bridge from \"@vkontakte/vk-bridge\";\r\n\r\nexport default ({id, budgets, dispatch, date = new Date(), onRefresh, bannerData, setBannerData}) => {\r\n\t// let budgetsStartSum = budgets.map(el => el.startSum).reduce((acc, cur) => acc + cur, 0);\r\n\t// let incomeBudgetSum = budgets.map(el => el.items).flat().map(item => item.income ? item.sum : 0).reduce((acc, cur) => acc + cur, 0);\r\n\t// let outcomeBudgetsSum = budgets.map(el => el.items).flat().map(item => !item.income ? item.sum : 0).reduce((acc, cur) => acc + cur, 0);\r\n\r\n\tuseEffect(() => {\r\n\t\tbridge.send('VKWebAppGetAds', {});\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<Panel id={id}>\r\n\t\t\t<PanelHeader\r\n\t\t\t\tleft={\r\n\t\t\t\t\t<PanelHeaderButton onClick={() => dispatch({type: SET_MODAL, payload: {modal: 'add-budget'}})}>\r\n\t\t\t\t\t\t<Icon28ListAddOutline/>\r\n\t\t\t\t\t</PanelHeaderButton>\r\n\t\t\t\t}\r\n\t\t\t>\r\n\t\t\t\tБюджеты\r\n\t\t\t</PanelHeader>\r\n\t\t\t<MonthSwitch onRefresh={onRefresh} />\r\n\t\t\t<Group\r\n\t\t\t\theader={<Header mode=\"secondary\">Ваши бюджеты\r\n\t\t\t\t\tна {format(new Date(date), 'dd MMMM yyyy', {locale: ruLocale})}</Header>}\r\n\t\t\t\t// separator=\"show\"\r\n\t\t\t>\r\n\t\t\t\t<ListOfItems data={budgets} dispatch={dispatch} showAll={true} itemsName={'budgets'} needHide={false}/>\r\n\t\t\t\t<Footer>Цифры напротив бюджета отображают сколько Вы можете еще потратить, но помните, что могут быть смежные траты, которые относятся к нескольким бюджетам. Проверяйте внимательно.</Footer>\r\n\t\t\t</Group>\r\n\t\t\t<FixedLayout vertical={\"bottom\"}>\r\n\t\t\t\t{bannerData && <PromoBanner bannerData={bannerData} onClose={() => setBannerData(null)}/>}\r\n\t\t\t</FixedLayout>\r\n\t\t\t<InfoSnackbar/>\r\n\t\t</Panel>\r\n\t)\r\n}","import React, {useEffect, useReducer, useState} from 'react';\r\nimport {Button, FormLayout, Input} from \"@vkontakte/vkui\";\r\nimport useApi from \"../../handlers/useApi\";\r\nimport validate from \"../../handlers/validate\";\r\nimport currency from \"../../handlers/currency\";\r\nimport regexp from \"../../handlers/regexp\";\r\nimport {SET_ACCOUNTS, SET_BUDGETS, SET_EDITED_ITEM} from \"../../state/actions\";\r\n\r\nconst initialState = {\r\n\ttitle: '',\r\n\tstartSum: '',\r\n\tvalidate: {\r\n\t\ttitle: {},\r\n\t\tstartSum: {}\r\n\t}\r\n}\r\n\r\nconst reducer = (state, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'CHANGE_STATE':\r\n\t\t\tconst {payload: {validateForm, ...payload}} = action;\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\t...payload,\r\n\t\t\t\tvalidate: {...state.validate, ...validateForm}\r\n\t\t\t}\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n}\r\n\r\nexport default ({dispatch, editedItem = null, date}) => {\r\n\tconst [stateForm, dispatchForm] = useReducer(reducer, initialState);\r\n\tconst [apiStr] = useState(() => {\r\n\t\treturn !editedItem ? '/budget' : `/budget/${editedItem._id}`;\r\n\t})\r\n\tconst [{response}, doApiFetch] = useApi(apiStr);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!editedItem) return;\r\n\t\tif (!response) dispatchForm({type: 'CHANGE_STATE', payload: {...editedItem}});\r\n\t}, [editedItem, dispatchForm, response]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tdispatch({type: SET_ACCOUNTS, payload: {accounts: response?.accounts ? response?.accounts : []}});\r\n\t\tdispatch({type: SET_BUDGETS, payload: {budgets: response?.budgets ? response?.budgets : []}});\r\n\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: null}});\r\n\t}, [response, dispatch]);\r\n\r\n\treturn (\r\n\t\t<FormLayout\r\n\t\t\tonSubmit={async e => {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tawait doApiFetch({\r\n\t\t\t\t\tmethod: !editedItem ? 'POST' : 'PATCH',\r\n\t\t\t\t\ttitle: stateForm.title,\r\n\t\t\t\t\tsum: stateForm.startSum,\r\n\t\t\t\t\tparams: {\r\n\t\t\t\t\t\tdate: new Date(date)\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<Input type={'text'} placeholder={'Название бюджета'} top={'Название'} value={stateForm.title}\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t maxLength={'20'}\r\n\t\t\t\t\t\t status={stateForm.validate?.title?.status}\r\n\t\t\t\t\t\t bottom={stateForm.validate?.title?.message ? stateForm.validate?.title?.message : `${stateForm.title.length} из 20`}\r\n\t\t\t\t\t\t onChange={e => dispatchForm({\r\n\t\t\t\t\t\t\t type: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t payload: {title: regexp(e.currentTarget.value), validateForm: {title: validate(e)}}\r\n\t\t\t\t\t\t })}/>\r\n\t\t\t<Input type={'number'} placeholder={currency(0)} top={'Бюджет в рублях'} value={stateForm.startSum}\r\n\t\t\t\t\t\t pattern={'[0-9]+([,\\\\.][0-9]+)?'}\r\n\t\t\t\t\t\t inputMode=\"decimal\"\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t status={stateForm.validate?.startSum?.status}\r\n\t\t\t\t\t\t min={0}\r\n\t\t\t\t\t\t max={999999999}\r\n\t\t\t\t\t\t step={0.01}\r\n\t\t\t\t\t\t bottom={stateForm.validate?.startSum?.message ? stateForm.validate?.startSum?.message : 'Сколько вы готовы на это потратить?'}\r\n\t\t\t\t\t\t onChange={e => dispatchForm({\r\n\t\t\t\t\t\t\t type: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t payload: {startSum: e.currentTarget.value, validateForm: {startSum: validate(e)}}\r\n\t\t\t\t\t\t })}/>\r\n\t\t\t<Button size={'xl'}>Сохранить</Button>\r\n\t\t</FormLayout>\r\n\t)\r\n}","import isEqual from \"date-fns/isEqual\";\r\n\r\nexport default function (prev, curr) {\r\n\tif (isEqual(new Date(prev[prev.length-1]?.date), new Date(curr.date))) {\r\n\t\treturn [...prev, curr];\r\n\t} else {\r\n\t\treturn [...prev, {date: curr.date, caption: true}, curr];\r\n\t}\r\n}","import React, {useEffect, useState} from 'react';\r\nimport {\r\n\tAlert,\r\n\tCell,\r\n\tDiv,\r\n\tFooter,\r\n\tGroup,\r\n\tList,\r\n\tMiniInfoCell,\r\n\tPanel,\r\n\tPanelHeader,\r\n\tPanelHeaderBack,\r\n\tPanelHeaderButton,\r\n\tPanelHeaderContent,\r\n\tPanelHeaderContext\r\n} from \"@vkontakte/vkui\";\r\nimport {\r\n\tSET_ACCOUNTS, SET_BUDGETS,\r\n\tSET_EDITED_ITEM,\r\n\tSET_HISTORY_BACK,\r\n\tSET_MODAL,\r\n\tSET_POPOUT,\r\n\tSET_TOGGLE_CONTEXT\r\n} from \"../state/actions\";\r\nimport Icon28MarketAddBadgeOutline from \"@vkontakte/icons/dist/28/market_add_badge_outline\";\r\nimport useApi from \"../handlers/useApi\";\r\nimport Icon16Dropdown from \"@vkontakte/icons/dist/16/dropdown\";\r\nimport Icon28DeleteOutline from '@vkontakte/icons/dist/28/delete_outline';\r\nimport Icon28EditOutline from '@vkontakte/icons/dist/28/edit_outline';\r\nimport Icon20PinOutline from '@vkontakte/icons/dist/20/pin_outline';\r\nimport Icon20Add from '@vkontakte/icons/dist/20/add';\r\nimport Icon20BombOutline from '@vkontakte/icons/dist/20/bomb_outline';\r\nimport mapRichCell from \"../handlers/mapRichCell\";\r\nimport InfoSnackbar from \"../components/InfoSnackbar\";\r\nimport sort from \"../handlers/sort\";\r\nimport reduce from \"../handlers/reduce\";\r\nimport currency from \"../handlers/currency\";\r\nimport SearchForm from \"../components/SearchForm\";\r\nimport {differenceInMonths} from 'date-fns';\r\n\r\nexport default ({id, budget, dispatch, context, date}) => {\r\n\tconst [isOpened, setIsOpened] = useState(() => context);\r\n\tconst [{response}, doApiFetch] = useApi(`/budget/${budget?._id}`);\r\n\tconst [items, setItems] = useState(() => budget?.items);\r\n\tconst [filteredItems, setFilteredItems] = useState(() => items);\r\n\tconst [searchStr, setSearchStr] = useState('');\r\n\r\n\tuseEffect(() => {\r\n\t\tsetItems(budget?.items);\r\n\t\tsetFilteredItems(budget?.items);\r\n\t}, [budget])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tif (response?.deletedCount) {\r\n\t\t\tdispatch({type: SET_HISTORY_BACK});\r\n\t\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: null}});\r\n\t\t}\r\n\t\tdispatch({type: SET_ACCOUNTS, payload: {accounts: response?.accounts ? response?.accounts : []}});\r\n\t\tdispatch({type: SET_BUDGETS, payload: {budgets: response?.budgets ? response?.budgets : []}});\r\n\t}, [response, dispatch]);\r\n\r\n\tuseEffect(() => {\r\n\t\tsetIsOpened(context);\r\n\t}, [context]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (searchStr === '') {\r\n\t\t\tsetFilteredItems(items);\r\n\t\t} else {\r\n\t\t\tsetFilteredItems(budget.items.filter(({title}) => title.toLowerCase().indexOf(searchStr.toLowerCase()) > -1));\r\n\t\t}\r\n\t}, [searchStr, budget, items]);\r\n\r\n\tconst toggleContext = () => {\r\n\t\tdispatch({type: SET_TOGGLE_CONTEXT, payload: {context: !isOpened}});\r\n\t}\r\n\r\n\tconst alertDelete = (\r\n\t\t<Alert\r\n\t\t\tactions={[\r\n\t\t\t\t{\r\n\t\t\t\t\ttitle: 'Отмена',\r\n\t\t\t\t\tautoclose: true,\r\n\t\t\t\t\tmode: \"cancel\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttitle: 'Удалить',\r\n\t\t\t\t\tmode: 'destructive',\r\n\t\t\t\t\tautoclose: true,\r\n\t\t\t\t\taction: async () => {\r\n\t\t\t\t\t\ttoggleContext();\r\n\t\t\t\t\t\tawait doApiFetch({\r\n\t\t\t\t\t\t\tmethod: 'DELETE',\r\n\t\t\t\t\t\t\tparams: {\r\n\t\t\t\t\t\t\t\tdate: date\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]}\r\n\t\t\tonClose={() => {\r\n\t\t\t\ttoggleContext();\r\n\t\t\t\tdispatch({type: SET_POPOUT, payload: {popout: null}})\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<h2>Удалить бюджет?</h2>\r\n\t\t\t<p>Вы действительно хотите удалить бюджет?</p>\r\n\t\t</Alert>\r\n\t)\r\n\r\n\tconst itemsList = filteredItems && filteredItems.sort(sort).reduce(reduce, []).map(mapRichCell(dispatch));\r\n\r\n\tconst onSearch = (str) => {\r\n\t\tsetSearchStr(str);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Panel id={id}>\r\n\t\t\t<PanelHeader left={\r\n\t\t\t\t<>\r\n\t\t\t\t\t<PanelHeaderBack onClick={() => {\r\n\t\t\t\t\t\tdispatch({type: SET_HISTORY_BACK});\r\n\t\t\t\t\t}}/>\r\n\t\t\t\t\t{differenceInMonths(new Date(), new Date(date)) === 0 &&\r\n\t\t\t\t\t\t<PanelHeaderButton\r\n\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: null}});\r\n\t\t\t\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: 'add-money'}});\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<Icon28MarketAddBadgeOutline/>\r\n\t\t\t\t\t\t</PanelHeaderButton>\r\n\t\t\t\t\t}\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\t\t\t>\r\n\t\t\t\t<PanelHeaderContent\r\n\t\t\t\t\taside={budget && <Icon16Dropdown style={{transform: `rotate(${isOpened ? '180deg' : '0'})`}}/>}\r\n\t\t\t\t\tonClick={toggleContext}\r\n\t\t\t\t>\r\n\t\t\t\t\t{budget ? budget?.title : 'Бюджет удалён'}\r\n\t\t\t\t</PanelHeaderContent>\r\n\t\t\t</PanelHeader>\r\n\t\t\t{\r\n\t\t\t\tbudget &&\r\n\t\t\t\t<>\r\n\t\t\t\t\t<PanelHeaderContext opened={isOpened} onClose={toggleContext}>\r\n\t\t\t\t\t\t<List>\r\n\t\t\t\t\t\t\t<Cell\r\n\t\t\t\t\t\t\t\tbefore={<Icon28EditOutline/>}\r\n\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: budget}})\r\n\t\t\t\t\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: 'add-budget'}})\r\n\t\t\t\t\t\t\t\t\ttoggleContext();\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tИзменить бюджет {budget?.title}\r\n\t\t\t\t\t\t\t</Cell>\r\n\t\t\t\t\t\t\t<Cell\r\n\t\t\t\t\t\t\t\tbefore={<Icon28DeleteOutline/>}\r\n\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\tdispatch({type: SET_POPOUT, payload: {popout: alertDelete, alert: true}})\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tУдалить бюджет {budget?.title}\r\n\t\t\t\t\t\t\t</Cell>\r\n\t\t\t\t\t\t</List>\r\n\t\t\t\t\t</PanelHeaderContext>\r\n\t\t\t\t\t<SearchForm onSearch={onSearch}/>\r\n\t\t\t\t\t<Group>\r\n\t\t\t\t\t\t<MiniInfoCell\r\n\t\t\t\t\t\t\tbefore={<Icon20PinOutline/>}\r\n\t\t\t\t\t\t\tmode={'base'}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tПервоначальная сумма {currency(budget.startSum)}\r\n\t\t\t\t\t\t</MiniInfoCell>\r\n\t\t\t\t\t\t<MiniInfoCell\r\n\t\t\t\t\t\t\tbefore={<Icon20Add/>}\r\n\t\t\t\t\t\t\tmode={'base'}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tДобавлено в\r\n\t\t\t\t\t\t\tбюджет {currency(budget.items.map(item => item.income ? item.sum : 0).reduce((acc, cur) => acc + cur, 0))}\r\n\t\t\t\t\t\t</MiniInfoCell>\r\n\t\t\t\t\t\t<MiniInfoCell\r\n\t\t\t\t\t\t\tbefore={<Icon20BombOutline/>}\r\n\t\t\t\t\t\t\tmode={'base'}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tПотрачено {currency(budget.items.map(item => !item.income ? item.sum : 0).reduce((acc, cur) => acc + cur, 0))}\r\n\t\t\t\t\t\t</MiniInfoCell>\r\n\t\t\t\t\t</Group>\r\n\t\t\t\t\t<Div>\r\n\t\t\t\t\t\t{itemsList}\r\n\t\t\t\t\t\t{itemsList?.length === 0 && <Footer>Нет данных для отображения</Footer>}\r\n\t\t\t\t\t</Div>\r\n\t\t\t\t\t<InfoSnackbar/>\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\t\t</Panel>\r\n\t)\r\n}","import React, {useEffect, useState} from 'react';\r\nimport {Footer, Group, Panel, PanelHeader} from \"@vkontakte/vkui\";\r\nimport MonthSwitch from \"../components/MonthSwitch\";\r\nimport mapStats from \"../handlers/mapStats\";\r\nimport SearchForm from \"../components/SearchForm\";\r\n\r\nexport default ({id, accounts, onRefresh}) => {\r\n\tconst [operations, setOperations] = useState(() => {\r\n\t\treturn accounts\r\n\t\t\t.map(item => item.operations)\r\n\t\t\t.flat()\r\n\t\t\t.filter(({income}) => !income)\r\n\t\t\t.sort((a, b) => a.title.localeCompare(b.title))\r\n\t});\r\n\tconst [searchStr, setSearchStr] = useState('');\r\n\tconst [filteredItems, setFilteredItems] = useState(() => operations);\r\n\tconst reducer = (prev, curr) => {\r\n\t\tif (prev[prev.length - 1]?.title === curr.title) {\r\n\t\t\tconst prevItem = prev[prev.length - 1];\r\n\t\t\tprevItem.sum = prevItem.sum + curr.sum;\r\n\t\t\tprevItem.quantity += curr.quantity;\r\n\t\t\tconst array = [...prev.slice(0, prev.length - 1), prevItem];\r\n\t\t\treturn [...array];\r\n\t\t} else {\r\n\t\t\treturn [...prev, {title: curr.title, sum: curr.sum, quantity: curr.quantity}];\r\n\t\t}\r\n\t}\r\n\r\n\tconst accountItemsList = filteredItems\r\n\t\t.reduce(reducer, [])\r\n\t\t.map(mapStats());\r\n\r\n\tuseEffect(() => {\r\n\t\tconst items = accounts\r\n\t\t\t.map(item => item.operations)\r\n\t\t\t.flat()\r\n\t\t\t.filter(({income}) => !income)\r\n\t\t\t.sort((a, b) => a.title.localeCompare(b.title));\r\n\t\tsetOperations(items);\r\n\t\tsetFilteredItems(items);\r\n\t}, [accounts]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (searchStr === '') {\r\n\t\t\tsetFilteredItems(accounts\r\n\t\t\t\t.map(item => item.operations)\r\n\t\t\t\t.flat()\r\n\t\t\t\t.filter(({income}) => !income)\r\n\t\t\t\t.sort((a, b) => a.title.localeCompare(b.title))\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tsetFilteredItems(accounts\r\n\t\t\t\t.map(item => item.operations)\r\n\t\t\t\t.flat()\r\n\t\t\t\t.filter(({income}) => !income)\r\n\t\t\t\t.sort((a, b) => a.title.localeCompare(b.title))\r\n\t\t\t\t.filter(({title}) => title.toLowerCase().indexOf(searchStr.toLowerCase()) > -1));\r\n\t\t}\r\n\t}, [searchStr, accounts]);\r\n\r\n\tconst onSearch = (str) => {\r\n\t\tsetSearchStr(str);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Panel id={id}>\r\n\t\t\t<PanelHeader>\r\n\t\t\t\tСводка\r\n\t\t\t</PanelHeader>\r\n\t\t\t<MonthSwitch onRefresh={onRefresh}/>\r\n\t\t\t<SearchForm onSearch={onSearch}/>\r\n\t\t\t<Group>\r\n\t\t\t\t{accountItemsList}\r\n\t\t\t\t{accountItemsList.length === 0 && <Footer>Нет данных для отображения</Footer>}\r\n\t\t\t</Group>\r\n\t\t</Panel>\r\n\t)\r\n}","import React from 'react';\r\nimport {RichCell} from \"@vkontakte/vkui\";\r\nimport currency from \"./currency\";\r\n\r\nexport default () => {\r\n\treturn (item, index) => {\r\n\t\treturn (\r\n\t\t\t<RichCell\r\n\t\t\t\tdisabled\r\n\t\t\t\tkey={index}\r\n\t\t\t\tmultiline\r\n\t\t\t\tcaption={`Кол-во: ${item?.quantity} | Ср. цена ${currency(item?.sum/item?.quantity)}`}\r\n\t\t\t\tafter={currency(item?.sum)}\r\n\t\t\t\tdata-title={item?.title}\r\n\t\t\t>\r\n\t\t\t\t{item?.title}\r\n\t\t\t</RichCell>\r\n\t\t)\r\n\t}\r\n}","import React from 'react';\r\nimport {Button, FixedLayout, Panel, Placeholder, PromoBanner, Spinner} from \"@vkontakte/vkui\";\r\nimport {SET_ACTIVE_VIEW} from \"../state/actions\";\r\nimport Icon36Done from '@vkontakte/icons/dist/36/done';\r\n\r\nexport default ({id, dispatch, loading, bannerData, setBannerData}) => {\r\n\treturn (\r\n\t\t<Panel id={id}>\r\n\t\t\t<Placeholder\r\n\t\t\t\ticon={loading ? <Spinner size=\"large\"/> : <Icon36Done/>}\r\n\t\t\t\taction={\r\n\t\t\t\t\t!loading && <Button\r\n\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\tdispatch({type: SET_ACTIVE_VIEW, payload: {view: 'home', panel: 'home'}});\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tid={'initial-button'}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\tЗапустить\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t}\r\n\t\t\t\tstretched\r\n\t\t\t>\r\n\t\t\t\t{loading ? 'Подготавливаем приложение к запуску' : 'Приложение готово'}\r\n\t\t\t</Placeholder>\r\n\t\t\t<FixedLayout vertical={\"bottom\"}>\r\n\t\t\t\t{bannerData && <PromoBanner bannerData={bannerData} onClose={() => setBannerData(null)}/>}\r\n\t\t\t</FixedLayout>\r\n\t\t</Panel>\r\n\t)\r\n}\r\n","import React, {useEffect, useState} from 'react';\r\nimport bridge from '@vkontakte/vk-bridge';\r\nimport {Cell, FixedLayout, Group, Header, Panel, PanelHeader, PromoBanner} from \"@vkontakte/vkui\";\r\nimport Icon28ShareExternalOutline from '@vkontakte/icons/dist/28/share_external_outline';\r\nimport Icon28Users3Outline from '@vkontakte/icons/dist/28/users_3_outline';\r\nimport Icon28AddCircleOutline from '@vkontakte/icons/dist/28/add_circle_outline';\r\nimport Icon28ListCheckOutline from '@vkontakte/icons/dist/28/list_check_outline';\r\nimport {SET_ACTIVE_VIEW} from \"../state/actions\";\r\nimport InfoSnackbar from \"../components/InfoSnackbar\";\r\n\r\nexport default ({id, dispatch, bannerData, setBannerData, addToHomeScreenSupported, addedToHomeScreen}) => {\r\n\tconst [lastClickTime, setLastClickTime] = useState(0);\r\n\tconst userId = new URL(window.location.href).searchParams.get('vk_user_id');\r\n\r\n\tuseEffect(() => {\r\n\t\tbridge.send('VKWebAppGetAds', {});\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<Panel id={id}>\r\n\t\t\t<PanelHeader>Ещё</PanelHeader>\r\n\t\t\t<Group>\r\n\t\t\t\t<Cell\r\n\t\t\t\t\texpandable\r\n\t\t\t\t\tbefore={<Icon28ListCheckOutline/>}\r\n\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\tdispatch({type: SET_ACTIVE_VIEW, payload: {view: 'more', panel: 'shop-list'}})\r\n\t\t\t\t\t}}\r\n\t\t\t\t>Список покупок</Cell>\r\n\t\t\t</Group>\r\n\t\t\t<Group\r\n\t\t\t\theader={\r\n\t\t\t\t\t<Header\r\n\t\t\t\t\t\tmode=\"secondary\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\tДополнительно\r\n\t\t\t\t\t</Header>\r\n\t\t\t\t}\r\n\t\t\t>\r\n\t\t\t\t<Cell\r\n\t\t\t\t\texpandable\r\n\t\t\t\t\tbefore={\r\n\t\t\t\t\t\t<Icon28ShareExternalOutline/>\r\n\t\t\t\t\t}\r\n\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\tif (+new Date() - lastClickTime > 1000) {\r\n\t\t\t\t\t\t\tbridge.send(\"VKWebAppShare\", {link: `https://vk.com/zlabz_balance#ref=${userId}`})\r\n\t\t\t\t\t\t\tsetLastClickTime(+new Date())\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\tПоделиться\r\n\t\t\t\t</Cell>\r\n\t\t\t\t<Cell\r\n\t\t\t\t\texpandable\r\n\t\t\t\t\tbefore={<Icon28Users3Outline/>}\r\n\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\tif (+new Date() - lastClickTime > 1000) {\r\n\t\t\t\t\t\t\tbridge.send('VKWebAppJoinGroup', {group_id: 195358095})\r\n\t\t\t\t\t\t\tsetLastClickTime(+new Date())\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\tПрисоединиться к Балансу\r\n\t\t\t\t</Cell>\r\n\r\n\t\t\t\t{addToHomeScreenSupported && !addedToHomeScreen && <Cell\r\n\t\t\t\t\texpandable\r\n\t\t\t\t\tbefore={<Icon28AddCircleOutline/>}\r\n\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\tbridge.send('VKWebAppAddToHomeScreen');\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\tДобавить на главный экран\r\n\t\t\t\t</Cell>}\r\n\t\t\t</Group>\r\n\t\t\t<FixedLayout vertical={\"bottom\"}>\r\n\t\t\t\t<InfoSnackbar/>\r\n\t\t\t\t{bannerData && <PromoBanner bannerData={bannerData} onClose={() => setBannerData(null)}/>}\r\n\t\t\t</FixedLayout>\r\n\t\t</Panel>\r\n\t)\r\n}","import React, {useEffect, useReducer, useState} from 'react';\r\nimport {\r\n\tCell,\r\n\tFooter,\r\n\tFormLayout,\r\n\tInput,\r\n\tList,\r\n\tPanel,\r\n\tPanelHeader,\r\n\tPanelHeaderBack,\r\n\tPanelHeaderContent, PanelHeaderContext\r\n} from \"@vkontakte/vkui\";\r\nimport {SET_HISTORY_BACK, SET_MODAL, SET_SUCCESS_MESSAGE, SET_TOGGLE_CONTEXT} from \"../state/actions\";\r\nimport InfoSnackbar from \"../components/InfoSnackbar\";\r\nimport regexp from \"../handlers/regexp\";\r\nimport validate from \"../handlers/validate\";\r\nimport Icon16Dropdown from \"@vkontakte/icons/dist/16/dropdown\";\r\nimport Icon28DeleteOutline from '@vkontakte/icons/dist/28/delete_outline';\r\nimport Icon28DoneOutline from '@vkontakte/icons/dist/28/done_outline';\r\n\r\nconst initialState = {\r\n\tlist: [],\r\n\titem: {\r\n\t\tid: 1,\r\n\t\ttitle: '',\r\n\t\tdone: false\r\n\t},\r\n\tid: null,\r\n\tvalidate: {\r\n\t\ttitle: {}\r\n\t}\r\n}\r\n\r\nconst reducer = (state, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'INITIAL_LIST': {\r\n\t\t\tconst index = action.payload.list[action.payload.list.length - 1] ? action.payload.list[action.payload.list.length - 1].id : 1;\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tlist: action.payload.list,\r\n\t\t\t\titem: {\r\n\t\t\t\t\tid: index + 1,\r\n\t\t\t\t\ttitle: '',\r\n\t\t\t\t\tdone: false\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase 'SET_TITLE': {\r\n\t\t\tconst {payload: {validateForm, title}} = action;\r\n\t\t\tconst item = {\r\n\t\t\t\tid: state.item.id,\r\n\t\t\t\ttitle: title,\r\n\t\t\t\tdone: false\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\titem,\r\n\t\t\t\tvalidate: {...state.validate, ...validateForm}\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase 'SET_ID': {\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tid: action.payload.id\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase 'SET_ITEM_TO_LIST': {\r\n\t\t\tconst newList = [...state.list, state.item];\r\n\t\t\tconst index = newList[newList.length - 1] ? newList[newList.length - 1].id : 1;\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tlist: newList,\r\n\t\t\t\titem: {title: '', done: false, id: index + 1},\r\n\t\t\t\tvalidate: {\r\n\t\t\t\t\ttitle: {}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase 'SET_DONE': {\r\n\t\t\tconst {list} = state;\r\n\t\t\tconst {id} = action.payload;\r\n\t\t\tconst index = list.findIndex((item) => item.id === id);\r\n\t\t\tif (index !== -1) {\r\n\t\t\t\tlist[index].done = !list[index].done;\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tlist\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase 'DELETE_ITEM': {\r\n\t\t\tconst {list} = state;\r\n\t\t\tconst {id} = action.payload;\r\n\t\t\tconst index = list.findIndex((item) => item.id === id);\r\n\t\t\tlist.splice(index, 1);\r\n\t\t\tif (list.length === 0) {\r\n\t\t\t\tlocalStorage.removeItem('shopList');\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tlist\r\n\t\t\t}\r\n\t\t}\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n}\r\n\r\nexport default ({id, dispatch, shopListFromServer, setShopListItemTitle, setShopList, context, success}) => {\r\n\r\n\tconst [state, dispatchList] = useReducer(reducer, initialState);\r\n\tconst [isOpened, setIsOpened] = useState(() => context);\r\n\tconst [deleteMode, setDeleteMode] = useState(false);\r\n\tconst shopList =\r\n\t\tshopListFromServer.length\r\n\t\t\t?\r\n\t\t\tstate.list.map((item) => {\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<Cell\r\n\t\t\t\t\t\tkey={item.id}\r\n\t\t\t\t\t\tselectable={!deleteMode}\r\n\t\t\t\t\t\tremovable={deleteMode}\r\n\t\t\t\t\t\tchecked={item.done}\r\n\t\t\t\t\t\tdisabled={deleteMode ? false : item.done}\r\n\t\t\t\t\t\tonChange={() => {\r\n\t\t\t\t\t\t\tsetShopListItemTitle(shopListFromServer[shopListFromServer.findIndex(i => i.id === item.id)].title);\r\n\t\t\t\t\t\t\tdispatchList({type: 'SET_ID', payload: {id: item.id}});\r\n\t\t\t\t\t\t\tdispatch({type: SET_SUCCESS_MESSAGE, payload: {message: null}});\r\n\t\t\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: 'add-money'}});\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tonRemove={() => {\r\n\t\t\t\t\t\t\tdispatchList({type: 'DELETE_ITEM', payload: {id: item.id}});\r\n\t\t\t\t\t\t\tsetShopList(state.list);\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{item.title}\r\n\t\t\t\t\t</Cell>\r\n\t\t\t\t)\r\n\t\t\t})\r\n\t\t\t:\r\n\t\t\t<Footer>Список покупок пуст</Footer>\r\n\t;\r\n\r\n\tconst toggleContext = () => {\r\n\t\tdispatch({type: SET_TOGGLE_CONTEXT, payload: {context: !isOpened}});\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\t\tsetIsOpened(context);\r\n\t}, [context]);\r\n\r\n\tuseEffect(() => {\r\n\t\tdispatchList({type: 'INITIAL_LIST', payload: {list: shopListFromServer}});\r\n\t}, [shopListFromServer]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (state.list.length === 0) return;\r\n\t\tsetShopList(state.list);\r\n\t}, [state.list, setShopList]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!success) return;\r\n\t\tdispatchList({type: 'SET_DONE', payload: {id: state.id}});\r\n\t}, [success, state.id]);\r\n\r\n\treturn (\r\n\t\t<Panel id={id}>\r\n\t\t\t<PanelHeader\r\n\t\t\t\tleft={\r\n\t\t\t\t\t<PanelHeaderBack onClick={() => {\r\n\t\t\t\t\t\tdispatch({type: SET_HISTORY_BACK});\r\n\t\t\t\t\t}}/>\r\n\t\t\t\t}\r\n\t\t\t>\r\n\t\t\t\t<PanelHeaderContent\r\n\t\t\t\t\taside={<Icon16Dropdown style={{transform: `rotate(${isOpened ? '180deg' : '0'})`}}/>}\r\n\t\t\t\t\tonClick={toggleContext}\r\n\t\t\t\t>\r\n\t\t\t\t\tСписок покупок\r\n\t\t\t\t</PanelHeaderContent>\r\n\t\t\t</PanelHeader>\r\n\t\t\t<PanelHeaderContext opened={isOpened} onClose={toggleContext}>\r\n\t\t\t\t<List>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t!deleteMode\r\n\t\t\t\t\t\t&&\r\n\t\t\t\t\t\t<Cell\r\n\t\t\t\t\t\t\tbefore={<Icon28DeleteOutline />}\r\n\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\ttoggleContext();\r\n\t\t\t\t\t\t\t\tsetDeleteMode(true);\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tРежим удаления\r\n\t\t\t\t\t\t</Cell>\r\n\t\t\t\t\t}\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdeleteMode\r\n\t\t\t\t\t\t&&\r\n\t\t\t\t\t\t\t<Cell\r\n\t\t\t\t\t\t\t\tbefore={<Icon28DoneOutline />}\r\n\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\ttoggleContext();\r\n\t\t\t\t\t\t\t\t\tsetDeleteMode(false);\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tРежим выполнения\r\n\t\t\t\t\t\t\t</Cell>\r\n\t\t\t\t\t}\r\n\t\t\t\t</List>\r\n\t\t\t</PanelHeaderContext>\r\n\t\t\t<FormLayout\r\n\t\t\t\tonSubmit={(e) => {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tdispatchList({type: 'SET_ITEM_TO_LIST'});\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t<Input type={'text'}\r\n\t\t\t\t\t\t\t disabled={deleteMode}\r\n\t\t\t\t\t\t\t placeholder={'Продукт, услуга, товар'}\r\n\t\t\t\t\t\t\t value={state.item.title}\r\n\t\t\t\t\t\t\t top={'Название'}\r\n\t\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t\t maxLength={20}\r\n\t\t\t\t\t\t\t status={state.validate?.title?.status}\r\n\t\t\t\t\t\t\t bottom={state.validate?.title?.message ? state.validate?.title?.message : `${state.item.title.length} из 20`}\r\n\t\t\t\t\t\t\t onChange={(e) => {\r\n\t\t\t\t\t\t\t\t dispatchList({\r\n\t\t\t\t\t\t\t\t\t type: 'SET_TITLE',\r\n\t\t\t\t\t\t\t\t\t payload: {\r\n\t\t\t\t\t\t\t\t\t\t title: regexp(e.currentTarget.value),\r\n\t\t\t\t\t\t\t\t\t\t validateForm: {title: validate(e)}\r\n\t\t\t\t\t\t\t\t\t }\r\n\t\t\t\t\t\t\t\t })\r\n\t\t\t\t\t\t\t }}/>\r\n\t\t\t</FormLayout>\r\n\t\t\t<List>\r\n\t\t\t\t{shopList}\r\n\t\t\t</List>\r\n\t\t\t<InfoSnackbar/>\r\n\t\t</Panel>\r\n\t)\r\n}","import React, {useCallback, useContext, useEffect, useState} from 'react';\r\nimport View from '@vkontakte/vkui/dist/components/View/View';\r\nimport '@vkontakte/vkui/dist/vkui.css';\r\nimport Home from './panels/Home';\r\nimport useApi from \"./handlers/useApi\";\r\nimport {State} from './state';\r\nimport {\r\n\tSET_ACCOUNTS,\r\n\tSET_ACTIVE_VIEW,\r\n\tSET_BUDGETS,\r\n\tSET_COLOR_SCHEME,\r\n\tSET_EDITED_ITEM,\r\n\tSET_HISTORY_BACK,\r\n\tSET_MODAL,\r\n\tSET_POPOUT, SET_SUCCESS_MESSAGE\r\n} from \"./state/actions\";\r\nimport {\r\n\tAlert,\r\n\tANDROID,\r\n\tConfigProvider,\r\n\tEpic,\r\n\tIOS,\r\n\tModalPage,\r\n\tModalPageHeader,\r\n\tModalRoot,\r\n\tPanelHeaderButton,\r\n\tplatform,\r\n\tTabbar,\r\n\tTabbarItem\r\n} from \"@vkontakte/vkui\";\r\nimport bridge from \"@vkontakte/vk-bridge\";\r\nimport Icon24Cancel from '@vkontakte/icons/dist/24/cancel';\r\nimport Icon28HomeOutline from '@vkontakte/icons/dist/28/home_outline';\r\nimport Icon28CoinsOutline from '@vkontakte/icons/dist/28/coins_outline';\r\nimport Icon28StatisticsOutline from '@vkontakte/icons/dist/28/statistics_outline';\r\nimport Icon28More from '@vkontakte/icons/dist/28/more';\r\nimport AddAccount from \"./components/modals/AddAccount\";\r\nimport AddMoney from \"./components/modals/AddMoney\";\r\nimport AccountInfo from \"./panels/AccountInfo\";\r\nimport Budgets from \"./panels/Budgets\";\r\nimport AddBudget from \"./components/modals/AddBudget\";\r\nimport BudgetInfo from \"./panels/BudgetInfo\";\r\nimport Stats from \"./panels/Stats\";\r\nimport InitialScreen from \"./panels/InitialScreen\";\r\n\r\nimport './style.css';\r\nimport More from \"./panels/More\";\r\nimport ShopListPanel from \"./panels/ShopListPanel\";\r\nimport useLocalStorage from \"./handlers/useLocalStorage\";\r\n\r\nconst App = () => {\r\n\tconst os = platform();\r\n\tconst [{response, isLoading}, doApiFetch] = useApi('/state');\r\n\tconst [needFetch, setNeedFetch] = useState(true);\r\n\tconst [state, dispatch] = useContext(State);\r\n\tconst [lastBackAction, setLastBackAction] = useState(0);\r\n\tconst [bannerData, setBannerData] = useState(null);\r\n\tconst [shopListItemTitle, setShopListItemTitle] = useState('');\r\n\tconst [shopList, setShopList] = useLocalStorage('shopList', []);\r\n\tconst [addToHomeScreenSupported, setAddToHomeScreenSupported] = useState(false);\r\n\tconst [addedToHomeScreen, setAddedToHomeScreen] = useState(false);\r\n\r\n\tuseEffect(() => {\r\n\t\tbridge.subscribe(({detail: {type, data}}) => {\r\n\t\t\tif (type === 'VKWebAppUpdateConfig') {\r\n\t\t\t\tdispatch({type: SET_COLOR_SCHEME, payload: {scheme: data.scheme}})\r\n\t\t\t}\r\n\t\t\tif (type === 'VKWebAppGetAdsResult') {\r\n\t\t\t\tsetBannerData(data);\r\n\t\t\t}\r\n\t\t\tif (type === 'VKWebAppAddToHomeScreenInfoResult') {\r\n\t\t\t\tsetAddToHomeScreenSupported(data.is_feature_supported);\r\n\t\t\t\tsetAddedToHomeScreen(data.is_added_to_home_screen);\r\n\t\t\t}\r\n\t\t\tif (type === 'VKWebAppAddToHomeScreenResult') {\r\n\t\t\t\tif (data.result) {\r\n\t\t\t\t\tsetAddedToHomeScreen(data.result);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (type === 'VKWebAppJoinGroupResult') {\r\n\t\t\t\tif (data.result) {\r\n\t\t\t\t\tdispatch({type: SET_SUCCESS_MESSAGE, payload: {message: 'Спасибо, что Вы с нами ❤️'}})\r\n\t\t\t\t}\r\n\t\t\t\t// console.log(data);\r\n\t\t\t}\r\n\t\t\tif (type === 'VKWebAppJoinGroupFailed') {\r\n\t\t\t\t// console.log(data);\r\n\t\t\t}\r\n\t\t});\r\n\r\n// Init VK  Mini App\r\n\t\tbridge.send(\"VKWebAppInit\", {});\r\n\t\t// Native ads on Android/IOS\r\n\t\t// bridge.send(\"VKWebAppShowNativeAds\", {ad_format:\"preloader\"})\r\n\t\t// \t.then(data => console.log(data.result))\r\n\t\t// \t.catch(error => console.log(error));\r\n\t\tbridge.send('VKWebAppGetAds', {});\r\n\t\tbridge.send('VKWebAppAddToHomeScreenInfo');\r\n\t}, [dispatch]);\r\n\r\n\tconst alert = (\r\n\t\t<Alert\r\n\t\t\tactions={[\r\n\t\t\t\t{\r\n\t\t\t\t\ttitle: 'Отмена',\r\n\t\t\t\t\tautoclose: true,\r\n\t\t\t\t\tmode: \"cancel\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttitle: 'Выйти',\r\n\t\t\t\t\tmode: 'destructive',\r\n\t\t\t\t\tautoclose: true,\r\n\t\t\t\t\taction: async () => {\r\n\t\t\t\t\t\tawait bridge.send('VKWebAppClose', {status: 'success'});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]}\r\n\t\t\tonClose={() => {\r\n\t\t\t\tdispatch({type: SET_POPOUT, payload: {popout: null}})\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<h2>Выйти из приложения?</h2>\r\n\t\t\t<p>Вы действительно хотите выйти?</p>\r\n\t\t</Alert>\r\n\t)\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!needFetch) return;\r\n\t\tdoApiFetch({\r\n\t\t\tparams: {\r\n\t\t\t\tdate: new Date(state.currentDate)\r\n\t\t\t}\r\n\t\t});\r\n\t\tsetNeedFetch(false);\r\n\t}, [needFetch, doApiFetch, state.currentDate]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tdispatch({type: SET_ACCOUNTS, payload: {accounts: response?.accounts ? response?.accounts : []}});\r\n\t\tdispatch({type: SET_BUDGETS, payload: {budgets: response?.budgets ? response?.budgets : []}});\r\n\t}, [response, dispatch]);\r\n\r\n\tuseEffect(() => {\r\n\t\t\twindow.onpopstate = () => {\r\n\t\t\t\tlet timeNow = +new Date();\r\n\t\t\t\tif (state.canClose) {\r\n\t\t\t\t\tdispatch({type: SET_POPOUT, payload: {popout: alert, alert: true}});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (timeNow - lastBackAction > 500) {\r\n\t\t\t\t\t\tsetLastBackAction(timeNow);\r\n\t\t\t\t\t\tdispatch({type: SET_HISTORY_BACK});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\twindow.history.pushState(null, null);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, [dispatch, state.history, state.modal, lastBackAction, state.canClose, alert]\r\n\t);\r\n\r\n\tconst onRefresh = useCallback(() => {\r\n\t\tsetNeedFetch(true);\r\n\t}, []);\r\n\r\n\tconst modalBack = (() => {\r\n\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: null}});\r\n\t\tdispatch({type: SET_MODAL, payload: {modal: null}});\r\n\t\tsetShopListItemTitle('');\r\n\t})\r\n\r\n\tconst modal = (\r\n\t\t<ModalRoot\r\n\t\t\tactiveModal={state.modal}\r\n\t\t\tonClose={modalBack}\r\n\t\t>\r\n\t\t\t<ModalPage id={'add-account'} header={\r\n\t\t\t\t<ModalPageHeader\r\n\t\t\t\t\tleft={os === ANDROID && <PanelHeaderButton onClick={modalBack}><Icon24Cancel/></PanelHeaderButton>}\r\n\t\t\t\t\tright={<PanelHeaderButton onClick={modalBack}>{os === IOS ? 'Закрыть' : null}</PanelHeaderButton>}\r\n\t\t\t\t>\r\n\t\t\t\t\tДобавить счет\r\n\t\t\t\t</ModalPageHeader>\r\n\t\t\t}>\r\n\t\t\t\t<AddAccount dispatch={dispatch}/>\r\n\t\t\t</ModalPage>\r\n\r\n\t\t\t<ModalPage id={'add-money'} header={\r\n\t\t\t\t<ModalPageHeader\r\n\t\t\t\t\tleft={os === ANDROID && <PanelHeaderButton onClick={modalBack}><Icon24Cancel/></PanelHeaderButton>}\r\n\t\t\t\t\tright={<PanelHeaderButton onClick={modalBack}>{os === IOS ? 'Закрыть' : null}</PanelHeaderButton>}\r\n\t\t\t\t>\r\n\t\t\t\t\t{state.editedItem ? 'Редактировать' : 'Добавить запись'}\r\n\t\t\t\t</ModalPageHeader>\r\n\t\t\t}>\r\n\t\t\t\t<AddMoney accounts={state.accounts} id={state.account?._id}\r\n\t\t\t\t\t\t\t\t\teditedItem={state.editedItem} dispatch={dispatch} budget={state.budget} panel={state.activePanel}\r\n\t\t\t\t\t\t\t\t\tshopListItemTitle={shopListItemTitle} setShopListItemTitle={setShopListItemTitle} date={state.currentDate}/>\r\n\t\t\t</ModalPage>\r\n\r\n\t\t\t<ModalPage id={'add-budget'} header={\r\n\t\t\t\t<ModalPageHeader\r\n\t\t\t\t\tleft={os === ANDROID && <PanelHeaderButton onClick={modalBack}><Icon24Cancel/></PanelHeaderButton>}\r\n\t\t\t\t\tright={<PanelHeaderButton onClick={modalBack}>{os === IOS ? 'Закрыть' : null}</PanelHeaderButton>}\r\n\t\t\t\t>\r\n\t\t\t\t\t{state.editedItem ? 'Редактировать' : 'Добавить бюджет'}\r\n\t\t\t\t</ModalPageHeader>\r\n\t\t\t}>\r\n\t\t\t\t<AddBudget editedItem={state.editedItem} dispatch={dispatch} date={state.currentDate}/>\r\n\t\t\t</ModalPage>\r\n\t\t</ModalRoot>\r\n\t)\r\n\r\n\tconst onStoryChange = (e) => {\r\n\t\tdispatch({\r\n\t\t\ttype: SET_ACTIVE_VIEW,\r\n\t\t\tpayload: {view: e.currentTarget.dataset.story, panel: e.currentTarget.dataset.panel}\r\n\t\t})\r\n\t}\r\n\r\n\tconst tabBar = (\r\n\t\t<Tabbar itemsLayout={'horizontal'}>\r\n\t\t\t<TabbarItem\r\n\t\t\t\tonClick={onStoryChange}\r\n\t\t\t\tselected={state.activeView === 'home'}\r\n\t\t\t\tdata-story={'home'}\r\n\t\t\t\tdata-panel={'home'}\r\n\t\t\t\ttext={'Баланс'}\r\n\t\t\t>\r\n\t\t\t\t<Icon28HomeOutline/>\r\n\t\t\t</TabbarItem>\r\n\t\t\t<TabbarItem\r\n\t\t\t\tonClick={onStoryChange}\r\n\t\t\t\tselected={state.activeView === 'info' && (state.activePanel === 'budgets' || state.activePanel === 'budget')}\r\n\t\t\t\tdata-story={'info'}\r\n\t\t\t\tdata-panel={'budgets'}\r\n\t\t\t\ttext={'Бюджеты'}\r\n\t\t\t>\r\n\t\t\t\t<Icon28CoinsOutline/>\r\n\t\t\t</TabbarItem>\r\n\t\t\t<TabbarItem\r\n\t\t\t\tonClick={onStoryChange}\r\n\t\t\t\tselected={state.activeView === 'stats' && state.activePanel === 'stats'}\r\n\t\t\t\tdata-story={'stats'}\r\n\t\t\t\tdata-panel={'stats'}\r\n\t\t\t\ttext={'Сводка'}\r\n\t\t\t>\r\n\t\t\t\t<Icon28StatisticsOutline/>\r\n\t\t\t</TabbarItem>\r\n\t\t\t<TabbarItem\r\n\t\t\t\tonClick={onStoryChange}\r\n\t\t\t\tselected={state.activeView === 'more'}\r\n\t\t\t\tdata-story={'more'}\r\n\t\t\t\tdata-panel={'index'}\r\n\t\t\t\ttext={'Ещё'}\r\n\t\t\t>\r\n\t\t\t\t<Icon28More/>\r\n\t\t\t</TabbarItem>\r\n\t\t</Tabbar>\r\n\t)\r\n\r\n\treturn (\r\n\t\t<ConfigProvider scheme={state.scheme}>\r\n\t\t\t<Epic activeStory={state.activeView}\r\n\t\t\t\t\t\ttabbar={state.activeView !== 'init' && state.activePanel !== 'init' && tabBar}>\r\n\t\t\t\t<View id={'init'} activePanel={state.activePanel}>\r\n\t\t\t\t\t<InitialScreen id={'init'} dispatch={dispatch} loading={state.popout} bannerData={bannerData}\r\n\t\t\t\t\t\t\t\t\t\t\t\t setBannerData={setBannerData}/>\r\n\t\t\t\t</View>\r\n\t\t\t\t<View id={'home'} activePanel={state.activePanel} popout={state.popout} modal={modal}>\r\n\t\t\t\t\t<Home id='home' accounts={state.accounts} budgets={state.budgets} dispatch={dispatch} isLoading={isLoading}\r\n\t\t\t\t\t\t\t\tonRefresh={onRefresh} isFetching={isLoading} shopList={shopList}/>\r\n\t\t\t\t</View>\r\n\t\t\t\t<View id={'info'} activePanel={state.activePanel} popout={state.popout} modal={modal}>\r\n\t\t\t\t\t<AccountInfo id={'account'} account={state.accounts.find(item => item._id === state.account?._id)}\r\n\t\t\t\t\t\t\t\t\t\t\t dispatch={dispatch} onRefresh={onRefresh} context={state.contextHistory}\r\n\t\t\t\t\t\t\t\t\t\t\t date={state.currentDate}/>\r\n\t\t\t\t\t<Budgets id={'budgets'} budgets={state.budgets} dispatch={dispatch} onRefresh={onRefresh}\r\n\t\t\t\t\t\t\t\t\t date={state.currentDate} bannerData={bannerData}\r\n\t\t\t\t\t\t\t\t\t setBannerData={setBannerData}/>\r\n\t\t\t\t\t<BudgetInfo id={'budget'} budget={state.budgets.find(item => item._id === state.budget?._id)}\r\n\t\t\t\t\t\t\t\t\t\t\tdispatch={dispatch} context={state.contextHistory} date={state.currentDate}/>\r\n\t\t\t\t</View>\r\n\t\t\t\t<View id={'stats'} activePanel={state.activePanel} popout={state.popout} modal={modal}>\r\n\t\t\t\t\t<Stats id={'stats'} accounts={state.accounts} onRefresh={onRefresh} dispatch={dispatch}/>\r\n\t\t\t\t</View>\r\n\t\t\t\t<View id={'more'} activePanel={state.activePanel} popout={state.popout} modal={modal}>\r\n\t\t\t\t\t<More id={'index'} dispatch={dispatch} addToHomeScreenSupported={addToHomeScreenSupported}\r\n\t\t\t\t\t\t\t\taddedToHomeScreen={addedToHomeScreen} bannerData={bannerData}\r\n\t\t\t\t\t\t\t\tsetBannerData={setBannerData}/>\r\n\t\t\t\t\t<ShopListPanel id={'shop-list'} dispatch={dispatch} shopListFromServer={shopList} setShopListItemTitle={setShopListItemTitle}\r\n\t\t\t\t\t\t\t\t\t\t\t\t setShopList={setShopList} context={state.contextHistory} success={state.successMessage} error={state.error}/>\r\n\t\t\t\t</View>\r\n\t\t\t</Epic>\r\n\t\t</ConfigProvider>\r\n\t);\r\n}\r\n\r\nexport default App;\r\n\r\n","import { useState } from 'react';\r\n\r\nexport default (key, initialValue) => {\r\n\t// State to store our value\r\n\t// Pass initial state function to useState so logic is only executed once\r\n\tconst [storedValue, setStoredValue] = useState(() => {\r\n\t\ttry {\r\n\t\t\t// Get from local storage by key\r\n\t\t\tconst item = window.localStorage.getItem(key);\r\n\t\t\t// Parse stored json or if none return initialValue\r\n\t\t\treturn item ? JSON.parse(item) : initialValue;\r\n\t\t} catch (error) {\r\n\t\t\t// If error also return initialValue\r\n\t\t\tconsole.log(error);\r\n\t\t\treturn initialValue;\r\n\t\t}\r\n\t});\r\n\r\n\t// Return a wrapped version of useState's setter function that ...\r\n\t// ... persists the new value to localStorage.\r\n\tconst setValue = value => {\r\n\t\ttry {\r\n\t\t\t// Allow value to be a function so we have same API as useState\r\n\t\t\tconst valueToStore =\r\n\t\t\t\tvalue instanceof Function ? value(storedValue) : value;\r\n\t\t\t// Save state\r\n\t\t\tsetStoredValue(valueToStore);\r\n\t\t\t// Save to local storage\r\n\t\t\twindow.localStorage.setItem(key, JSON.stringify(valueToStore));\r\n\t\t} catch (error) {\r\n\t\t\t// A more advanced implementation would handle the error case\r\n\t\t\tconsole.log(error);\r\n\t\t}\r\n\t};\r\n\r\n\treturn [storedValue, setValue];\r\n}","import \"core-js/features/map\";\r\nimport \"core-js/features/set\";\r\nimport 'array-flat-polyfill';\r\nimport React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport App from \"./App\";\r\nimport {StateProvider} from \"./state\";\r\n\r\nReactDOM.render(\r\n  <StateProvider>\r\n    <App />\r\n  </StateProvider>, document.getElementById(\"root\"));\r\nif (new URL(window.location.href).searchParams.get('vk_user_id') === process.env.REACT_APP_ID.toString()) {\r\n  import(\"./eruda\").then(() => {}); //runtime download\r\n}\r\n\r\n// console.log(new URL(window.location.href).searchParams.get('vk_user_id'));\r\n//import(\"./eruda\").then(({ default: eruda }) => {}); //runtime download\r\n"],"sourceRoot":""}