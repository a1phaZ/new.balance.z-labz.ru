{"version":3,"sources":["handlers/currency.js","state/actions.js","components/ListOfItems.js","state/index.js","components/InfoSnackbar.js","components/MonthSwitch.js","panels/Home.js","handlers/useApi.js","handlers/validate.js","handlers/regexp.js","components/modals/AddAccount.js","components/AccountsOptionsList.js","components/modals/AddMoney.js","components/Color.js","handlers/mapRichCell.js","handlers/sort.js","components/SearchForm.js","handlers/formatingArrayWithDate.js","panels/AccountInfo.js","panels/Budgets.js","components/modals/AddBudget.js","handlers/reduce.js","panels/BudgetInfo.js","handlers/getTagsListFromAccounts.js","panels/Stats.js","handlers/mapStats.js","panels/InitialScreen.js","panels/More.js","panels/ShopListPanel.js","panels/AppStats.js","components/modals/TransferMoney.js","components/SearchDate.js","panels/StatsDetails.js","App.js","handlers/useLocalStorage.js","index.js"],"names":["number","Intl","NumberFormat","style","currency","format","SET_MODAL","data","showAll","dispatch","itemsName","needHide","useState","isShow","setIsShow","length","list","sort","a","b","sum","map","account","index","key","indicator","expandable","data-id","_id","onClick","e","type","payload","id","currentTarget","dataset","view","panel","title","weight","marginBottom","push","initialState","accounts","budgets","budget","modal","successMessage","error","activeView","activePanel","popout","editedItem","currentDate","Date","history","modalsHistory","popoutHistory","contextHistory","canClose","scheme","modalOpenTime","reducer","state","action","window","pushState","scrollTo","lastHistoryState","backEl","newHistory","pop","accountId","find","item","budgetId","alert","context","message","date","State","createContext","StateProvider","children","value","useReducer","Provider","InfoSnackbar","useContext","snackbar","setSnackbar","useEffect","onClose","before","color","onRefresh","disabledAfter","isAfter","addMonths","disabledBefore","isBefore","clickTime","setClickTime","disabled","timeNow","subMonths","mode","asideContent","textAlign","fontWeight","cursor","locale","ru","toLocaleUpperCase","Home","isFetching","shopList","isOpened","setIsOpened","isAccountTooltipClose","setIsAccountTooltipClose","sumOfAll","el","reduce","acc","cur","shopListDone","curr","done","shopListButton","toggleContext","left","text","opened","MonthSwitch","header","separator","level","ListOfItems","url","isLoading","setLoading","response","setResponse","setError","options","setOptions","doApiFetch","useCallback","method","params","bodyFields","axiosOptions","baseURL","process","headers","queryString","parse","location","search","axios","then","catch","Error","fetchData","validity","valid","status","badInput","valueMissing","tooLong","typeMismatch","stepMismatch","rangeOverflow","rangeUnderflow","str","replace","titleValidation","sumValidation","stateForm","dispatchForm","apiStr","useApi","onSubmit","preventDefault","placeholder","top","required","maxLength","bottom","onChange","regexp","validate","pattern","inputMode","max","min","step","size","income","description","price","quantity","tags","boxPrice","validateForm","shopListItemTitle","setShopListItemTitle","descriptionShow","setDescriptionShow","Number","toFixed","toLowerCase","split","filter","tag","marginRight","maxWidth","overflow","overflowWrap","itemFrom","tzOffset","getTimezoneOffset","defaultValue","AccountsOptionsList","name","defaultChecked","join","display","flexWrap","checked","mapRichCell","tagsShow","caption","caps","ruLocale","outcome","Color","after","marginLeft","multiline","aDate","bDate","compareAsc","onSearch","searchStr","setSearchStr","searchRef","useRef","current","focus","substring","position","height","width","ref","ArrayToObjectWithDate","items","prev","ObjectToArrayWithDate","indexAr","itemsListArray","Object","keys","forEach","splice","accountContext","setAccountContext","operations","setItems","filteredItems","setFilteredItems","accountItemsList","actions","autoclose","accountContextView","itemContextView","contextView","indexOf","incomeSum","outcomeSum","aside","transform","SearchForm","slideWidth","bullets","bannerData","setBannerData","bridge","send","vertical","startSum","isEqual","deletedCount","alertDelete","itemsList","differenceInMonths","getTagsListItemsFromAccount","array","tagsListItems","Array","isArray","operation","setSelectedTagTitle","groupedByStats","setGroupedByStats","setSelectedItemTitle","flat","localeCompare","setOperations","filteredTags","setFilteredTags","tagsListItemView","tagsList","entries","outSum","data-title","getTagsListItemsView","prevItem","slice","mapStats","preparedTagsArray","loading","icon","stretched","addToHomeScreenSupported","addedToHomeScreen","lastClickTime","setLastClickTime","userId","URL","href","searchParams","get","link","group_id","newList","findIndex","localStorage","removeItem","shopListFromServer","setShopList","success","dispatchList","deleteMode","setDeleteMode","selectable","removable","i","onRemove","getUserAgentArray","userAgent","sessionData","ts","setTs","dateRange","opt","beginDay","startOfDay","endDay","endOfDay","beginMonth","startOfMonth","endMonth","endOfMonth","month","begin","end","getDateRange","day","newUsers","user","createdAt","preparedData","timeStamp","newItem","androidUsers","iphoneUsers","mobileWebUsers","desktopUsers","androidMessengerUsers","iphoneMessengerUsers","to","from","accountFrom","accountsFromList","accountsToList","onDateChange","startDate","setStartDate","endDate","setEndDate","minPeriod","maxPeriod","showSearch","category","currentStateDate","searchDate","setSearchDate","accountItemsListArray","itemsListView","SearchDate","App","os","platform","needFetch","setNeedFetch","lastBackAction","setLastBackAction","initialValue","getItem","JSON","console","log","storedValue","setStoredValue","valueToStore","Function","setItem","stringify","useLocalStorage","setAddToHomeScreenSupported","setAddedToHomeScreen","selectedTagTitle","selectedItemTitle","tagsItemsList","setTagsItemsList","itemsFromItemTitle","setItemsFromItemTitle","getItemsFromItemTitle","subscribe","detail","is_feature_supported","is_added_to_home_screen","result","tagsListItem","onpopstate","modalBack","activeModal","ANDROID","right","IOS","AddAccount","AddMoney","AddBudget","TransferMoney","onStoryChange","story","tabBar","itemsLayout","selected","data-story","data-panel","activeStory","tabbar","InitialScreen","AccountInfo","Budgets","BudgetInfo","Stats","StatsDetails","More","ShopListPanel","AppStats","ReactDOM","render","document","getElementById","toString"],"mappings":"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","file":"static/js/main.87ef189a.chunk.js","sourcesContent":["export default (number) => {\r\n\treturn new Intl.NumberFormat('ru-RU', {style: 'currency', currency: 'RUB'}).format(number);\r\n}","export const SET_ACCOUNTS = 'SET_ACCOUNTS';\r\nexport const SET_BUDGETS = 'SET_BUDGETS';\r\nexport const SET_BUDGET = 'SET_BUDGET';\r\nexport const SET_MODAL = 'SET_MODAL';\r\nexport const SET_ERROR = 'SET_ERROR';\r\nexport const SET_SUCCESS_MESSAGE = 'SET_SUCCESS_MESSAGE';\r\nexport const SET_ACTIVE_VIEW = 'SET_ACTIVE_VIEW';\r\nexport const SET_ACCOUNT = 'SET_ACCOUNT';\r\nexport const SET_POPOUT = 'SET_POPOUT';\r\nexport const SET_EDITED_ITEM = 'SET_EDITED_ITEM';\r\nexport const SET_DATE = 'SET_DATE';\r\nexport const SET_HISTORY_BACK = 'SET_HISTORY_BACK';\r\nexport const SET_COLOR_SCHEME = 'SET_COLOR_SCHEME';\r\nexport const SET_TOGGLE_CONTEXT = 'SET_TOGGLE_CONTEXT';","import React, {useState} from 'react';\r\nimport Cell from \"@vkontakte/vkui/dist/components/Cell/Cell\";\r\nimport {Footer, Text} from \"@vkontakte/vkui\";\r\nimport currency from \"../handlers/currency\";\r\nimport {SET_ACCOUNT, SET_ACTIVE_VIEW, SET_BUDGET} from \"../state/actions\";\r\n\r\nexport default ({data, showAll = false, dispatch, itemsName, needHide = true}) => {\r\n\tconst [isShow, setIsShow] = useState(() => {\r\n\t\treturn showAll;\r\n\t});\r\n\r\n\tif (data.length === 0) {\r\n\t\tif (itemsName === 'accounts') {\r\n\t\t\treturn <Footer>Нет счетов для отображения</Footer>\r\n\t\t}\r\n\t\tif (itemsName === 'budgets') {\r\n\t\t\treturn <Footer>Нет бюджетов для отображения</Footer>\r\n\t\t}\r\n\t}\r\n\r\n\tlet list = data\r\n\t\t.sort((a, b) => {\r\n\t\t\treturn b.sum - a.sum;\r\n\t\t})\r\n\t\t.map((account, index) => {\r\n\t\t\tif (index === 3 && !isShow) {\r\n\t\t\t\treturn <Cell\r\n\t\t\t\t\tkey={'showAll'}\r\n\t\t\t\t\texpandable\r\n\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\tsetIsShow(true);\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Text weight=\"semibold\" style={{marginBottom: 16}}>\r\n\t\t\t\t\t\tПоказать все\r\n\t\t\t\t\t</Text>\r\n\t\t\t\t</Cell>\r\n\t\t\t}\r\n\t\t\tif (index > 3 && !isShow) {\r\n\t\t\t\treturn null\r\n\t\t\t}\r\n\t\t\treturn <Cell\r\n\t\t\t\tkey={index}\r\n\t\t\t\tindicator={currency(account.sum)}\r\n\t\t\t\texpandable\r\n\t\t\t\tdata-id={account._id}\r\n\t\t\t\tonClick={async (e) => {\r\n\t\t\t\t\tif (itemsName === 'accounts') {\r\n\t\t\t\t\t\tawait dispatch({type: SET_ACCOUNT, payload: {id: e.currentTarget.dataset.id}});\r\n\t\t\t\t\t\tawait dispatch({type: SET_ACTIVE_VIEW, payload: {view: 'info', panel: 'account'}});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (itemsName === 'budgets') {\r\n\t\t\t\t\t\tawait dispatch({type: SET_BUDGET, payload: {id: e.currentTarget.dataset.id}});\r\n\t\t\t\t\t\tawait dispatch({type: SET_ACTIVE_VIEW, payload: {view: 'info', panel: 'budget'}});\r\n\t\t\t\t\t}\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t{account.title}\r\n\t\t\t</Cell>\r\n\t\t});\r\n\tif (needHide) {\r\n\t\tif (isShow) list.push(<Cell\r\n\t\t\tkey={data.length}\r\n\t\t\texpandable\r\n\t\t\tonClick={() => {\r\n\t\t\t\tsetIsShow(false);\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<Text weight=\"semibold\" style={{marginBottom: 16}}>\r\n\t\t\t\t{itemsName === 'accounts' ? 'Скрыть счета' : 'Скрыть бюджеты'}\r\n\t\t\t</Text>\r\n\t\t</Cell>);\r\n\t}\r\n\r\n\r\n\treturn list;\r\n}","import React, {createContext, useReducer} from 'react';\r\nimport {\r\n\tSET_ACCOUNT,\r\n\tSET_ACCOUNTS,\r\n\tSET_ACTIVE_VIEW,\r\n\tSET_BUDGET,\r\n\tSET_BUDGETS,\r\n\tSET_DATE,\r\n\tSET_EDITED_ITEM,\r\n\tSET_ERROR,\r\n\tSET_HISTORY_BACK,\r\n\tSET_MODAL,\r\n\tSET_POPOUT,\r\n\tSET_SUCCESS_MESSAGE,\r\n\tSET_COLOR_SCHEME, SET_TOGGLE_CONTEXT\r\n} from './actions';\r\n// import {smoothScrollToTop} from \"../handlers/smoothScrollToTop\";\r\n\r\nconst initialState = {\r\n\taccounts: [],\r\n\tbudgets: [],\r\n\taccount: null,\r\n\tbudget: null,\r\n\tmodal: null,\r\n\tsuccessMessage: null,\r\n\terror: null,\r\n\tactiveView: 'init',\r\n\tactivePanel: 'init',\r\n\tpopout: null,\r\n\teditedItem: null,\r\n\tcurrentDate: new Date(),\r\n\thistory: [],\r\n\tmodalsHistory: [],\r\n\tpopoutHistory: [],\r\n\tcontextHistory: false,\r\n\tcanClose: true,\r\n\tscheme: 'client_light',\r\n\tmodalOpenTime: +new Date()\r\n}\r\n\r\nconst reducer = (state, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase SET_COLOR_SCHEME: {\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tscheme: action.payload.scheme\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_ACTIVE_VIEW: {\r\n\t\t\twindow.history.pushState(null, null);\r\n\r\n\t\t\t// console.log(document.documentElement.scrollTop, document.body.scrollTop);\r\n\t\t\twindow.scrollTo(0, 0);\r\n\t\t\t// smoothScrollToTop();\r\n\r\n\t\t\tlet history = state.history;\r\n\t\t\tif (history.length !== 0) {\r\n\t\t\t\tlet lastHistoryState = history[history.length - 1];\r\n\t\t\t\tif (lastHistoryState.view === action.payload.view && lastHistoryState.panel === action.payload.panel) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\t...state\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\t...state,\r\n\t\t\t\t\t\tactiveView: action.payload.view,\r\n\t\t\t\t\t\tactivePanel: action.payload.panel,\r\n\t\t\t\t\t\thistory: [...history, {view: action.payload.view, panel: action.payload.panel}],\r\n\t\t\t\t\t\tcanClose: false,\r\n\t\t\t\t\t\tcontextHistory: false,\r\n\t\t\t\t\t\tsuccessMessage: null,\r\n\t\t\t\t\t\terror: null\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...state,\r\n\t\t\t\t\tactiveView: action.payload.view,\r\n\t\t\t\t\tactivePanel: action.payload.panel,\r\n\t\t\t\t\thistory: [...history, {view: action.payload.view, panel: action.payload.panel}],\r\n\t\t\t\t\tcanClose: true,\r\n\t\t\t\t\tcontextHistory: false,\r\n\t\t\t\t\tsuccessMessage: null,\r\n\t\t\t\t\terror: null\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_HISTORY_BACK: {\r\n\t\t\twindow.history.pushState(null, null);\r\n\r\n\t\t\twindow.scrollTo(0, 0);\r\n\t\t\t// smoothScrollToTop();\r\n\r\n\t\t\tconst backEl = state.history[state.history.length - 2];\r\n\t\t\tlet popoutHistory = state.popoutHistory || [];\r\n\t\t\tlet modalsHistory = state.modalsHistory || [];\r\n\t\t\tlet contextHistory = state.contextHistory || false;\r\n\r\n\t\t\tif (popoutHistory.length !== 0) {\r\n\t\t\t\tconst canClose = state.history.length <= 1;\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...state,\r\n\t\t\t\t\tpopout: null,\r\n\t\t\t\t\tpopoutHistory: [],\r\n\t\t\t\t\tcanClose: canClose,\r\n\t\t\t\t\teditedItem: null\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!!contextHistory) {\r\n\t\t\t\tconst canClose = state.history.length <= 1;\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...state,\r\n\t\t\t\t\tcontextHistory: false,\r\n\t\t\t\t\tcanClose: canClose,\r\n\t\t\t\t\teditedItem: null\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (modalsHistory.length !== 0) {\r\n\t\t\t\tif (+new Date() - state.modalOpenTime < 700) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\t...state\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tconst canClose = state.history.length <= 1;\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...state,\r\n\t\t\t\t\tmodal: null,\r\n\t\t\t\t\tmodalsHistory: [],\r\n\t\t\t\t\tcanClose: canClose,\r\n\t\t\t\t\teditedItem: null\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!backEl) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...state,\r\n\t\t\t\t\tactiveView: 'home',\r\n\t\t\t\t\tactivePanel: 'home',\r\n\t\t\t\t\thistory: [],\r\n\t\t\t\t\tcanClose: true,\r\n\t\t\t\t\teditedItem: null,\r\n\t\t\t\t\tsuccessMessage: null,\r\n\t\t\t\t\terror: null\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst canClose = (backEl.view === 'home' && backEl.panel === 'home');\r\n\t\t\t\tconst newHistory = state.history;\r\n\t\t\t\tnewHistory.pop();\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...state,\r\n\t\t\t\t\tactiveView: backEl.view,\r\n\t\t\t\t\tactivePanel: backEl.panel,\r\n\t\t\t\t\thistory: [...newHistory],\r\n\t\t\t\t\teditedItem: null,\r\n\t\t\t\t\tcanClose: canClose,\r\n\t\t\t\t\tsuccessMessage: null,\r\n\t\t\t\t\terror: null\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tcase SET_ACCOUNTS: {\r\n\t\t\tconst accountId = state.account?._id;\r\n\t\t\tconst account = !accountId ? accountId : action.payload.accounts.find(item => {\r\n\t\t\t\treturn item._id === accountId;\r\n\t\t\t})\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\taccounts: action.payload.accounts,\r\n\t\t\t\taccount: account\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_BUDGETS: {\r\n\t\t\tconst budgetId = state.budget?._id;\r\n\t\t\tconst budget = !budgetId ? budgetId : action.payload.budgets.find(item => item._id === budgetId)\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tbudgets: action.payload.budgets,\r\n\t\t\t\tbudget: budget\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_ACCOUNT: {\r\n\t\t\tconst {payload: {id}} = action;\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\taccount: state.accounts.find(item => {\r\n\t\t\t\t\treturn item._id === id;\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_BUDGET: {\r\n\t\t\tconst {payload: {id}} = action;\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tbudget: !id ? id : state.budgets.find(item => item._id === id)\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_EDITED_ITEM: {\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\teditedItem: action.payload.item\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_POPOUT: {\r\n\t\t\tif (action.payload.alert) {\r\n\t\t\t\twindow.history.pushState(null, null);\r\n\t\t\t}\r\n\t\t\tlet history = state.history;\r\n\t\t\tlet canClose = state.canClose;\r\n\t\t\tif (history.length !== 0 || action.payload.popout) {\r\n\t\t\t\tcanClose = history.length === 1 && !action.payload.popout;\r\n\t\t\t} else {\r\n\t\t\t\tif (history.length === 0 && !action.payload.popout) {\r\n\t\t\t\t\tcanClose = true\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tpopout: action.payload.popout,\r\n\t\t\t\tpopoutHistory: action.payload.popout ? [action.payload.popout] : [],\r\n\t\t\t\tcanClose: canClose\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_MODAL: {\r\n\t\t\t// window.history.pushState(null, null);\r\n\t\t\tlet history = state.history;\r\n\t\t\tlet canClose = state.canClose;\r\n\t\t\tif (history.length !== 0 || action.payload.modal) {\r\n\t\t\t\tcanClose = history.length === 1 && !action.payload.modal;\r\n\t\t\t} else {\r\n\t\t\t\tif (history.length === 0 && !action.payload.modal) {\r\n\t\t\t\t\tcanClose = true\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tmodal: action.payload.modal,\r\n\t\t\t\tmodalsHistory: action.payload.modal ? [action.payload.modal] : [],\r\n\t\t\t\tcanClose: canClose,\r\n\t\t\t\tmodalOpenTime: +new Date()\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_TOGGLE_CONTEXT: {\r\n\t\t\tlet history = state.history;\r\n\t\t\tlet canClose = state.canClose;\r\n\t\t\tif (history.length !== 0 || action.payload.context) {\r\n\t\t\t\tcanClose = history.length === 1 && !action.payload.context;\r\n\t\t\t} else {\r\n\t\t\t\tif (history.length === 0 && !action.payload.context) {\r\n\t\t\t\t\tcanClose = true\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\t// modal: action.payload.modal,\r\n\t\t\t\tcontextHistory: action.payload.context,\r\n\t\t\t\tcanClose: canClose\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_SUCCESS_MESSAGE: {\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tsuccessMessage: action.payload.message\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_ERROR: {\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\terror: action.payload.error\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_DATE: {\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tcurrentDate: new Date(action.payload.date)\r\n\t\t\t}\r\n\t\t}\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n}\r\n\r\nexport const State = createContext();\r\n\r\nexport const StateProvider = ({children}) => {\r\n\tconst value = useReducer(reducer, initialState);\r\n\treturn (\r\n\t\t<State.Provider value={value}>\r\n\t\t\t{children}\r\n\t\t</State.Provider>\r\n\t)\r\n}","import React, {useContext, useEffect, useState} from 'react';\r\nimport {Snackbar} from \"@vkontakte/vkui\";\r\nimport {State} from \"../state\";\r\nimport {SET_ERROR, SET_SUCCESS_MESSAGE} from \"../state/actions\";\r\nimport Icon24ErrorCircle from '@vkontakte/icons/dist/24/error_circle';\r\nimport Icon24CheckCircleOn from '@vkontakte/icons/dist/24/check_circle_on';\r\n\r\nconst InfoSnackbar = () => {\r\n\tconst [state, dispatch] = useContext(State);\r\n\tconst [snackbar, setSnackbar] = useState(null);\r\n\tuseEffect(() => {\r\n\t\tif (!state.error) return;\r\n\t\tsetSnackbar(<Snackbar\r\n\t\t\tonClose={\r\n\t\t\t\t() => {\r\n\t\t\t\t\tdispatch({type: SET_ERROR, payload: {error: null}});\r\n\t\t\t\t\tsetSnackbar(null);\r\n\t\t\t\t}}\r\n\t\t\tbefore={<Icon24ErrorCircle style={{color: 'var(--destructive)'}}/>}\r\n\t\t>\r\n\t\t\t{state.error.message}\r\n\t\t</Snackbar>)\r\n\t}, [setSnackbar, dispatch, state.error]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!state.successMessage) return;\r\n\t\tsetSnackbar(<Snackbar\r\n\t\t\tonClose={\r\n\t\t\t\t() => {\r\n\t\t\t\t\tdispatch({type: SET_SUCCESS_MESSAGE, payload: {message: null}});\r\n\t\t\t\t\tsetSnackbar(null);\r\n\t\t\t\t}}\r\n\t\t\tbefore={<Icon24CheckCircleOn style={{color: 'var(--accent)'}}/>}\r\n\t\t>\r\n\t\t\t{state.successMessage}\r\n\t\t</Snackbar>)\r\n\t}, [setSnackbar, dispatch, state.successMessage]);\r\n\treturn (\r\n\t\t<>\r\n\t\t\t{snackbar}\r\n\t\t</>\r\n\t)\r\n}\r\n\r\nexport default InfoSnackbar;","import React, {useContext, useState} from 'react';\r\nimport {addMonths, format, subMonths, isAfter, isBefore} from 'date-fns';\r\nimport {ru} from 'date-fns/locale';\r\nimport Icon24BrowserBack from '@vkontakte/icons/dist/24/browser_back';\r\nimport Icon24BrowserForward from '@vkontakte/icons/dist/24/browser_forward';\r\nimport {State} from \"../state\";\r\nimport {Button, Cell, Group} from \"@vkontakte/vkui\";\r\n\r\nexport default ({onRefresh}) => {\r\n\tconst [state, dispatch] = useContext(State);\r\n\tconst dateFormat = 'LLLL yyyy';\r\n\tconst disabledAfter = isAfter(addMonths(state.currentDate, 1), new Date());\r\n\tconst disabledBefore = isBefore(new Date(state.currentDate), new Date(2015, 0, 1));\r\n\tconst [clickTime, setClickTime] = useState(0);\r\n\t\r\n\tconst nextMonth = () => {\r\n\t\tlet timeNow = +new Date();\r\n\t\tif (timeNow - clickTime > 500) {\r\n\t\t\tdispatch({type: 'SET_DATE', payload: {date: (addMonths(state.currentDate, 1))}});\r\n\t\t\tonRefresh();\r\n\t\t\tsetClickTime(timeNow);\r\n\t\t}\r\n\t};\r\n\r\n\tconst prevMonth = () => {\r\n\t\tlet timeNow = +new Date();\r\n\t\tif (timeNow - clickTime > 500) {\r\n\t\t\tdispatch({type: 'SET_DATE', payload: {date: (subMonths(state.currentDate, 1))}});\r\n\t\t\tonRefresh();\r\n\t\t\tsetClickTime(timeNow);\r\n\t\t}\r\n\t};\r\n\r\n\treturn (\r\n\t\t<Group>\r\n\t\t\t<Cell\r\n\t\t\t\tbefore={<Button disabled={disabledBefore} onClick={prevMonth} mode={'secondary'}><Icon24BrowserBack/></Button>}\r\n\t\t\t\tasideContent={<Button disabled={disabledAfter} onClick={nextMonth}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmode={'secondary'}><Icon24BrowserForward/></Button>}\r\n\t\t\t\tstyle={{textAlign: 'center', fontWeight: 'bold'}}\r\n\t\t\t>\r\n\t\t\t\t<div style={{cursor: 'auto'}}>\r\n\t\t\t\t\t{format(state.currentDate, dateFormat, {locale: ru}).toLocaleUpperCase()}\r\n\t\t\t\t</div>\r\n\t\t\t</Cell>\r\n\t\t</Group>\r\n\t)\r\n}","import React, {useEffect, useState} from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Panel from '@vkontakte/vkui/dist/components/Panel/Panel';\r\nimport PanelHeader from '@vkontakte/vkui/dist/components/PanelHeader/PanelHeader';\r\nimport Group from '@vkontakte/vkui/dist/components/Group/Group';\r\nimport Div from '@vkontakte/vkui/dist/components/Div/Div';\r\nimport {\r\n\tButton,\r\n\tCell,\r\n\tFooter,\r\n\tHeader,\r\n\tList,\r\n\tPanelHeaderButton,\r\n\tPanelHeaderContext,\r\n\tPullToRefresh,\r\n\tTitle,\r\n\tTooltip\r\n} from \"@vkontakte/vkui\";\r\nimport currency from \"../handlers/currency\";\r\nimport ListOfItems from \"../components/ListOfItems\";\r\nimport {SET_ACCOUNT, SET_ACTIVE_VIEW, SET_MODAL, SET_TOGGLE_CONTEXT} from \"../state/actions\";\r\nimport Icon28MarketAddBadgeOutline from '@vkontakte/icons/dist/28/market_add_badge_outline';\r\nimport Icon28ListAddOutline from '@vkontakte/icons/dist/28/list_add_outline';\r\nimport Icon28MoneyTransfer from '@vkontakte/icons/dist/28/money_transfer';\r\nimport InfoSnackbar from \"../components/InfoSnackbar\";\r\nimport MonthSwitch from \"../components/MonthSwitch\";\r\n\r\nconst Home = ({id, accounts, budgets, dispatch, onRefresh, isFetching, shopList, context}) => {\r\n\tconst [isOpened, setIsOpened] = useState(() => context);\r\n\tconst [isAccountTooltipClose, setIsAccountTooltipClose] = useState(false);\r\n\tconst sumOfAll = accounts.map(el => el.sum).reduce((acc, cur) => acc + cur, 0);\r\n\tconst shopListDone = shopList.reduce((acc, curr) => curr.done ? acc + 1 : acc, 0);\r\n\tconst shopListButton = (\r\n\t\t<Button\r\n\t\t\tmode={'tertiary'}\r\n\t\t\tonClick={() => {\r\n\t\t\t\tdispatch({type: SET_ACTIVE_VIEW, payload: {view: 'more', panel: 'shop-list'}})\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t{shopList.length === 0 ? 'Сформировать список покупок' : 'Перейти к списку покупок'}\r\n\t\t</Button>\r\n\t)\r\n\r\n\tuseEffect(() => {\r\n\t\tsetIsOpened(context);\r\n\t}, [context]);\r\n\r\n\tconst toggleContext = () => {\r\n\t\tdispatch({type: SET_TOGGLE_CONTEXT, payload: {context: !isOpened}});\r\n\t}\r\n\treturn (\r\n\t\t<Panel id={id}>\r\n\t\t\t<PanelHeader\r\n\t\t\t\tleft={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\taccounts.length !== 0 || isAccountTooltipClose ?\r\n\t\t\t\t\t\t\t\t<PanelHeaderButton\r\n\t\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\t\tif (isOpened) {\r\n\t\t\t\t\t\t\t\t\t\t\ttoggleContext();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: 'add-account'}});\r\n\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t<Icon28ListAddOutline/>\r\n\t\t\t\t\t\t\t\t</PanelHeaderButton> :\r\n\t\t\t\t\t\t\t\t<Tooltip\r\n\t\t\t\t\t\t\t\t\ttext={'Начните учет финансов с добавления счета'}\r\n\t\t\t\t\t\t\t\t\tonClose={\r\n\t\t\t\t\t\t\t\t\t\t() => {\r\n\t\t\t\t\t\t\t\t\t\t\tsetIsAccountTooltipClose(true);\r\n\t\t\t\t\t\t\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: 'add-account'}});\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t<PanelHeaderButton\r\n\t\t\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\t\t\ttoggleContext();\r\n\t\t\t\t\t\t\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: 'add-account'}});\r\n\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<Icon28ListAddOutline/>\r\n\t\t\t\t\t\t\t\t\t</PanelHeaderButton>\r\n\t\t\t\t\t\t\t\t</Tooltip>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{accounts.length !== 0 && <PanelHeaderButton\r\n\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\ttoggleContext();\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<Icon28MarketAddBadgeOutline/>\r\n\t\t\t\t\t\t</PanelHeaderButton>}\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t>\r\n\t\t\t\tБаланс\r\n\t\t\t</PanelHeader>\r\n\t\t\t<PanelHeaderContext opened={isOpened} onClose={toggleContext}>\r\n\t\t\t\t<List>\r\n\t\t\t\t\t<Cell\r\n\t\t\t\t\t\tbefore={<Icon28MarketAddBadgeOutline/>}\r\n\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\tdispatch({type: SET_ACCOUNT, payload: {id: null}});\r\n\t\t\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: 'add-money'}});\r\n\t\t\t\t\t\t\ttoggleContext();\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\tДобавить\r\n\t\t\t\t\t</Cell>\r\n\t\t\t\t\t<Cell\r\n\t\t\t\t\t\tbefore={<Icon28MoneyTransfer/>}\r\n\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: 'transfer-money'}});\r\n\t\t\t\t\t\t\ttoggleContext();\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\tПеревести\r\n\t\t\t\t\t</Cell>\r\n\t\t\t\t</List>\r\n\t\t\t</PanelHeaderContext>\r\n\t\t\t<MonthSwitch onRefresh={onRefresh}/>\r\n\t\t\t<PullToRefresh onRefresh={onRefresh} isFetching={isFetching}>\r\n\t\t\t\t<List>\r\n\t\t\t\t\t<Group\r\n\t\t\t\t\t\theader={<Header mode=\"secondary\">Ваши счета</Header>}\r\n\t\t\t\t\t\tseparator=\"show\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Div>\r\n\t\t\t\t\t\t\t<Title level=\"1\" weight=\"semibold\" style={{marginBottom: 16}}>{currency(sumOfAll)}</Title>\r\n\t\t\t\t\t\t\t<ListOfItems data={accounts} dispatch={dispatch} showAll={false} itemsName={'accounts'}/>\r\n\t\t\t\t\t\t</Div>\r\n\t\t\t\t\t</Group>\r\n\t\t\t\t\t<Group\r\n\t\t\t\t\t\theader={<Header mode={'secondary'}>Ваши бюджеты</Header>}\r\n\t\t\t\t\t\tseparator={'show'}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Div>\r\n\t\t\t\t\t\t\t<ListOfItems data={budgets} dispatch={dispatch} showAll={false} itemsName={'budgets'}/>\r\n\t\t\t\t\t\t</Div>\r\n\t\t\t\t\t</Group>\r\n\t\t\t\t\t<Group\r\n\t\t\t\t\t\theader={<Header mode={'secondary'}>Список покупок</Header>}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{/*<ShopList list={shopList} dispatch={dispatch}/>*/}\r\n\t\t\t\t\t\t<Footer>\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tshopList.length === 0 ?\r\n\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t`Ваш список покупок пуст`\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t</> :\r\n\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t{`В Вашем списке покупок ${shopList.length} элементов. ${shopListDone} выполнено.`}\r\n\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t<br/>\r\n\t\t\t\t\t\t\t{shopListButton}\r\n\t\t\t\t\t\t</Footer>\r\n\t\t\t\t\t</Group>\r\n\t\t\t\t</List>\r\n\t\t\t</PullToRefresh>\r\n\t\t\t<InfoSnackbar/>\r\n\t\t</Panel>\r\n\t)\r\n};\r\n\r\nHome.propTypes = {\r\n\tid: PropTypes.string.isRequired,\r\n};\r\n\r\nexport default Home;\r\n","import React, {useState, useEffect, useCallback, useContext} from 'react';\r\nimport queryString from 'query-string';\r\nimport axios from 'axios';\r\nimport {SET_ERROR, SET_MODAL, SET_POPOUT, SET_SUCCESS_MESSAGE} from \"../state/actions\";\r\nimport {State} from \"../state\";\r\nimport {PopoutWrapper, ScreenSpinner} from \"@vkontakte/vkui\";\r\n\r\nexport default url => {\r\n\tconst [isLoading, setLoading] = useState(false);\r\n\tconst [response, setResponse] = useState(null);\r\n\tconst [error, setError] = useState(null);\r\n\tconst [options, setOptions] = useState({});\r\n\tconst [, dispatch] = useContext(State);\r\n\r\n\tconst apiBase = process.env.NODE_ENV !== 'development' ? process.env.REACT_APP_BASEURL : process.env.REACT_APP_BASEURL_DEV;\r\n\r\n\tconst doApiFetch = useCallback((options = {}) => {\r\n\t\tsetOptions(options);\r\n\t\tsetResponse(null);\r\n\t\tsetError(null);\r\n\t\tsetLoading(true);\r\n\t\tdispatch({type: SET_POPOUT, payload: {popout: (<PopoutWrapper><ScreenSpinner /></PopoutWrapper>)}});\r\n\t}, [dispatch]);\r\n\r\n\tconst {method = 'GET', params, ...bodyFields} = options;\r\n\tconst headers = {\r\n\t\t'Content-Type': 'application/json',\r\n\t}\r\n\tconst axiosOptions = {\r\n\t\tmethod: method,\r\n\t\tbaseURL: apiBase,\r\n\t\turl,\r\n\t\theaders,\r\n\t\tparams: params ? {...params, ...queryString.parse(window.location.search)} : {...queryString.parse(window.location.search)},\r\n\t\tdata: method !== 'GET' ? bodyFields : null,\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\r\n\t\tif (!isLoading) return;\r\n\r\n\t\tconst fetchData = async () => {\r\n\t\t\tsetLoading(false);\r\n\t\t\treturn await axios(axiosOptions)\r\n\t\t\t\t.then(async (response) => {\r\n\t\t\t\t\tsetResponse(response.data.data);\r\n\t\t\t\t\tdispatch({type: SET_POPOUT, payload: {popout: null}});\r\n\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: null}});\r\n\t\t\t\t\tdispatch({type: SET_SUCCESS_MESSAGE, payload: {message: response.data.message}});\r\n\t\t\t\t})\r\n\t\t\t\t.catch((error) => {\r\n\t\t\t\t\tlet e = error?.response ? error.response.data.error : new Error('Проблемы с подключением к API');\r\n\t\t\t\t\tsetError(e);\r\n\t\t\t\t\tsetLoading(false);\r\n\t\t\t\t\tdispatch({type: SET_POPOUT, payload: {popout: null}});\r\n\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: null}});\r\n\t\t\t\t\tdispatch({type: SET_ERROR, payload: {error: e}});\r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t\tfetchData();\r\n\r\n\t}, [isLoading, axiosOptions, dispatch]);\r\n\treturn [{isLoading, response, error}, doApiFetch];\r\n}","export default (e) => {\r\n\tconst validity = e.currentTarget.validity;\r\n\tif (validity.valid && e.currentTarget.value !== ' ') {\r\n\t\treturn {status: 'valid', message: null}\r\n\t} else {\r\n\t\tif (validity.badInput || validity.valueMissing || e.currentTarget.value === ' ') {\r\n\t\t\treturn {status: 'error', message: 'Неверный формат ввода | Отсутствует значение'}\r\n\t\t}\r\n\t\tif (validity.tooLong) {\r\n\t\t\treturn {status: 'error', message: 'Превышена максимальная длина'}\r\n\t\t}\r\n\t\tif (validity.typeMismatch) {\r\n\t\t\treturn {status: 'error', message: 'Несоответствие типа'}\r\n\t\t}\r\n\t\tif (validity.stepMismatch) {\r\n\t\t\treturn {status: 'error', message: 'Слишком большая дробная часть'}\r\n\t\t}\r\n\t\tif (validity.rangeOverflow) {\r\n\t\t\tif (e.currentTarget.type === 'date') return {status: 'error', message: 'Нельзя ввести будущую дату'}\r\n\t\t\treturn {status: 'error', message: 'Слишком большое число'}\r\n\t\t}\r\n\t\tif (validity.rangeUnderflow) {\r\n\t\t\tif (e.currentTarget.type === 'date') return {status: 'error', message: 'Нельзя ввести дату раньше 1 января 2015'}\r\n\t\t\treturn {status: 'error', message: 'Нельзя вводить отрицательные числа'}\r\n\t\t}\r\n\r\n\t\treturn {status: 'default', message: null}\r\n\t}\r\n}","// const ranges = [\r\n// \t'\\ud83c[\\udf00-\\udfff]', // U+1F300 to U+1F3FF\r\n// \t'\\ud83d[\\udc00-\\ude4f]', // U+1F400 to U+1F64F\r\n// \t'\\ud83d[\\ude80-\\udeff]'  // U+1F680 to U+1F6FF\r\n// ]\r\n//\r\n// const regexp = new RegExp(ranges.join('|'), 'g');\r\nexport default (str) => {\r\n\treturn str.replace(/^\\s*/g, '').replace(/\\s{2,}/g, ' ').replace(/<% RGI_Emoji %>|\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F|\\p{Emoji_Modifier_Base}/gu, '');\r\n}","import React, {useEffect, useReducer, useState} from 'react';\r\nimport {Button, FormLayout, Input} from \"@vkontakte/vkui\";\r\nimport currency from \"../../handlers/currency\";\r\nimport useApi from \"../../handlers/useApi\";\r\nimport validate from \"../../handlers/validate\";\r\nimport regexp from \"../../handlers/regexp\";\r\nimport {SET_ACCOUNTS, SET_BUDGETS, SET_EDITED_ITEM} from \"../../state/actions\";\r\n\r\nconst initialState = {\r\n\ttitle: '',\r\n\tsum: '',\r\n\ttitleValidation: {},\r\n\tsumValidation: {}\r\n}\r\n\r\nconst reducer = (state, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'CHANGE_STATE':\r\n\t\t\tconst {payload} = action;\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\t...payload\r\n\t\t\t}\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n}\r\n\r\nexport default ({dispatch, editedItem}) => {\r\n\tconst [stateForm, dispatchForm] = useReducer(reducer, initialState);\r\n\tconst [apiStr] = useState(() => !editedItem ? '/money-box' : `/money-box/${editedItem._id}`);\r\n\tconst [{response}, doApiFetch] = useApi(apiStr);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tdispatch({type: SET_ACCOUNTS, payload: {accounts: response?.accounts ? response?.accounts : []}});\r\n\t\tdispatch({type: SET_BUDGETS, payload: {budgets: response?.budgets ? response?.budgets : []}});\r\n\t}, [response, dispatch]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!editedItem) return;\r\n\t\tdispatchForm({type: 'CHANGE_STATE', payload: {...editedItem}});\r\n\t}, [editedItem]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: null}});\r\n\t}, [response, dispatch]);\r\n\r\n\treturn (\r\n\t\t<FormLayout\r\n\t\t\tonSubmit={async e => {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tawait doApiFetch({\r\n\t\t\t\t\tmethod: !editedItem ? 'POST' : 'PATCH',\r\n\t\t\t\t\ttitle: stateForm.title,\r\n\t\t\t\t\tsum: stateForm.sum\r\n\t\t\t\t});\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<Input type={'text'} placeholder={'Карта, наличные, счет в банке'} top={'Название'} value={stateForm.title}\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t maxLength={'20'}\r\n\t\t\t\t\t\t status={stateForm.titleValidation.status}\r\n\t\t\t\t\t\t bottom={stateForm.titleValidation.message ? stateForm.titleValidation.message : `${stateForm.title.length} из 20`}\r\n\t\t\t\t\t\t onChange={e => dispatchForm({type: 'CHANGE_STATE', payload: {title: regexp(e.currentTarget.value), titleValidation: validate(e)}})}/>\r\n\t\t\t<Input type={'number'} placeholder={currency(0)} top={'Баланс счета'} value={stateForm.sum}\r\n\t\t\t\t\t\t pattern={'[0-9]+([,\\\\.][0-9]+)?'}\r\n\t\t\t\t   disabled={!!editedItem}\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t status={stateForm.sumValidation.status}\r\n\t\t\t\t\t\t inputMode=\"decimal\"\r\n\t\t\t\t\t\t max={999999999}\r\n\t\t\t\t\t\t min={0}\r\n\t\t\t\t\t\t step={0.01}\r\n\t\t\t\t\t\t bottom={stateForm.sumValidation.message ? stateForm.sumValidation.message : 'Денежные средства, находящиеся на счете в данный момент'}\r\n\t\t\t\t\t\t onChange={e => dispatchForm({type: 'CHANGE_STATE', payload: {sum: e.currentTarget.value.replace(/[^\\d.]*/, ''), sumValidation: validate(e)}})}/>\r\n\t\t\t<Button size={'xl'}>Сохранить</Button>\r\n\t\t</FormLayout>\r\n\t)\r\n}","import currency from \"../handlers/currency\";\r\nimport React from \"react\";\r\n\r\nexport default ({accounts}) => {\r\n    return accounts.map(item => {\r\n        return (<option key={item._id} value={item._id}>{item.title} ({currency(item.sum)})</option>)\r\n    });\r\n}","import React, {useEffect, useReducer, useState} from 'react';\r\nimport {format} from 'date-fns';\r\nimport {\r\n\tButton,\r\n\tCheckbox,\r\n\tCounter,\r\n\tDiv,\r\n\tFormLayout,\r\n\tFormLayoutGroup,\r\n\tInput,\r\n\tRadio,\r\n\tSelect,\r\n\tTextarea\r\n} from \"@vkontakte/vkui\";\r\nimport currency from \"../../handlers/currency\";\r\nimport useApi from \"../../handlers/useApi\";\r\nimport validate from \"../../handlers/validate\";\r\nimport regexp from \"../../handlers/regexp\";\r\nimport {SET_ACCOUNTS, SET_BUDGETS, SET_EDITED_ITEM} from \"../../state/actions\";\r\nimport Icon24AddSquareOutline from '@vkontakte/icons/dist/24/add_square_outline';\r\nimport AccountsOptionsList from \"../AccountsOptionsList\";\r\n\r\nconst initialState = {\r\n\taccount: '',\r\n\ttitle: '',\r\n\tdate: format(new Date(), 'yyyy-MM-dd'),\r\n\tincome: false,\r\n\tdescription: '',\r\n\tprice: '',\r\n\tquantity: '',\r\n\ttags: [],\r\n\tboxPrice: false,\r\n\tvalidate: {\r\n\t\taccount: {},\r\n\t\ttitle: {},\r\n\t\tdescription: {},\r\n\t\tprice: {},\r\n\t\tquantity: {},\r\n\t\ttags: {},\r\n\t}\r\n}\r\n\r\nconst reducer = (state, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'CHANGE_STATE':\r\n\t\t\tconst {payload: {validateForm, ...payload}} = action;\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\t...payload,\r\n\t\t\t\tvalidate: {...state.validate, ...validateForm}\r\n\t\t\t}\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n}\r\n\r\nexport default ({accounts, id = null, editedItem = null, dispatch, budget, panel = '', shopListItemTitle, setShopListItemTitle, date}) => {\r\n\tconst [apiStr] = useState(() => {\r\n\t\treturn !editedItem ? '/item' : `/item/${editedItem._id}`;\r\n\t})\r\n\tconst [{response}, doApiFetch] = useApi(apiStr);\r\n\tconst [state, dispatchForm] = useReducer(reducer, initialState);\r\n\tconst [descriptionShow, setDescriptionShow] = useState(() => !!state.description);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (descriptionShow) return;\r\n\t\tsetDescriptionShow(!!state.description);\r\n\t}, [state.description, descriptionShow]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!shopListItemTitle) return;\r\n\t\tdispatchForm({type: 'CHANGE_STATE', payload: {title: shopListItemTitle}})\r\n\t}, [shopListItemTitle]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!editedItem) return;\r\n\t\teditedItem.date = format(new Date(editedItem.date), 'yyyy-MM-dd');\r\n\t\tif (editedItem.boxPrice) {\r\n\t\t\teditedItem.price = Number(editedItem.sum).toFixed(2);\r\n\t\t}\r\n\t\tdispatchForm({type: 'CHANGE_STATE', payload: {...editedItem}});\r\n\t}, [editedItem]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!budget?.title) return;\r\n\t\tif (panel === 'home') return;\r\n\t\tdispatchForm({\r\n\t\t\ttype: 'CHANGE_STATE',\r\n\t\t\tpayload: {\r\n\t\t\t\ttags: editedItem?.tags || budget?.title.toLowerCase().split(' ')\r\n\t\t\t}\r\n\t\t})\r\n\t}, [budget, panel, editedItem]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tdispatch({type: SET_ACCOUNTS, payload: {accounts: response?.accounts ? response?.accounts : []}});\r\n\t\tdispatch({type: SET_BUDGETS, payload: {budgets: response?.budgets ? response?.budgets : []}});\r\n\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: null}});\r\n\t}, [response, dispatch]);\r\n\r\n\tconst tags = state.tags.filter(tag => !!tag.length).map(\r\n\t\t(tag, index) =>\r\n\t\t\t<Counter\r\n\t\t\t\tstyle={{\r\n\t\t\t\t\tmarginRight: '5px',\r\n\t\t\t\t\tmarginBottom: '5px',\r\n\t\t\t\t\tmaxWidth: '100%',\r\n\t\t\t\t\toverflow: 'hidden',\r\n\t\t\t\t\toverflowWrap: 'normal'\r\n\t\t\t\t}}\r\n\t\t\t\tkey={index}\r\n\t\t\t>\r\n\t\t\t\t{tag}\r\n\t\t\t</Counter>\r\n\t);\r\n\r\n\treturn (\r\n\t\t<FormLayout\r\n\t\t\tonSubmit={e => {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tdoApiFetch({\r\n\t\t\t\t\tmethod: !editedItem ? 'POST' : 'PATCH',\r\n\t\t\t\t\tdate: state.date,\r\n\t\t\t\t\ttitle: state.title,\r\n\t\t\t\t\tdescription: state.income ? '' : state.description,\r\n\t\t\t\t\tprice: state.boxPrice ? (state.price / state.quantity).toFixed(4) : Number(state.price).toFixed(2),\r\n\t\t\t\t\tquantity: state.quantity,\r\n\t\t\t\t\tincome: state.income,\r\n\t\t\t\t\ttags: state.tags.filter(tag => !!tag.length),\r\n\t\t\t\t\titemFrom: state.account || editedItem?.itemFrom || id,\r\n\t\t\t\t\tboxPrice: state.boxPrice,\r\n\t\t\t\t\tparams: {\r\n\t\t\t\t\t\tdate: new Date(date),\r\n\t\t\t\t\t\ttzOffset: new Date().getTimezoneOffset()\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tsetShopListItemTitle('');\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<Select top={'Счет'}\r\n\t\t\t\t\t\t\tplaceholder={'Выберите счет'}\r\n\t\t\t\t\t\t\tonChange={(e) => {\r\n\t\t\t\t\t\t\t\tdispatchForm({\r\n\t\t\t\t\t\t\t\t\ttype: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t\t\tpayload: {account: e.currentTarget.value, validateForm: {account: validate(e)}}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\tdefaultValue={state.account || editedItem?.itemFrom || id} required={true}\r\n\t\t\t\t\t\t\tstatus={state.validate?.account?.status}\r\n\t\t\t\t\t\t\tbottom={state.validate?.account?.message}\r\n\t\t\t>\r\n\t\t\t\t<AccountsOptionsList accounts={accounts} />\r\n\t\t\t</Select>\r\n\t\t\t<Input type={'date'}\r\n\t\t\t\t\t\t top={'Дата'}\r\n\t\t\t\t\t\t value={state.date}\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t min={'2015-01-01'}\r\n\t\t\t\t\t\t max={format(new Date(), 'yyyy-MM-dd')}\r\n\t\t\t\t\t\t onChange={(e) => {\r\n\t\t\t\t\t\t\t dispatchForm({\r\n\t\t\t\t\t\t\t\t type: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t\t payload: {date: e.currentTarget.value, validateForm: {date: validate(e)}}\r\n\t\t\t\t\t\t\t })\r\n\t\t\t\t\t\t }}\r\n\t\t\t\t\t\t status={state.validate?.date?.status}\r\n\t\t\t\t\t\t bottom={state.validate?.date?.message}\r\n\t\t\t/>\r\n\t\t\t<Input type={'text'}\r\n\t\t\t\t\t\t placeholder={'Продукт, услуга, товар'}\r\n\t\t\t\t\t\t value={state.title}\r\n\t\t\t\t\t\t top={'Название'}\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t maxLength={20}\r\n\t\t\t\t\t\t status={state.validate?.title?.status}\r\n\t\t\t\t\t\t bottom={state.validate?.title?.message ? state.validate?.title?.message : `${state.title.length} из 20`}\r\n\t\t\t\t\t\t onChange={(e) => {\r\n\t\t\t\t\t\t\t dispatchForm({\r\n\t\t\t\t\t\t\t\t type: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t\t payload: {\r\n\t\t\t\t\t\t\t\t\t title: regexp(e.currentTarget.value),\r\n\t\t\t\t\t\t\t\t\t validateForm: {title: validate(e)}\r\n\t\t\t\t\t\t\t\t }\r\n\t\t\t\t\t\t\t })\r\n\t\t\t\t\t\t }}/>\r\n\t\t\t<Radio name={'income'}\r\n\t\t\t\t\t\t value={false}\r\n\t\t\t\t\t\t defaultChecked={state.income ? null : true}\r\n\t\t\t\t\t\t onClick={() => {\r\n\t\t\t\t\t\t\t dispatchForm({type: 'CHANGE_STATE', payload: {income: false}})\r\n\t\t\t\t\t\t }}\r\n\t\t\t>\r\n\t\t\t\tРасход\r\n\t\t\t</Radio>\r\n\t\t\t<Radio name={'income'}\r\n\t\t\t\t\t\t value={true}\r\n\t\t\t\t\t\t defaultChecked={state.income ? true : null}\r\n\t\t\t\t\t\t onClick={() => {\r\n\t\t\t\t\t\t\t dispatchForm({type: 'CHANGE_STATE', payload: {income: true}})\r\n\t\t\t\t\t\t\t setDescriptionShow(false);\r\n\t\t\t\t\t\t }}\r\n\t\t\t\t\t\t disabled={!!shopListItemTitle}\r\n\t\t\t>\r\n\t\t\t\tДоход\r\n\t\t\t</Radio>\r\n\t\t\t{!state.income\r\n\t\t\t&&\r\n\t\t\t\t<FormLayoutGroup top={'Описание'}>\r\n\t\t\t\t\t<Button\r\n\t\t\t\t\t\ttype={'button'}\r\n\t\t\t\t\t\tmode=\"secondary\"\r\n\t\t\t\t\t\tbefore={<Icon24AddSquareOutline/>}\r\n\t\t\t\t\t\tsize=\"l\"\r\n\t\t\t\t\t\tdisabled={state.description || descriptionShow}\r\n\t\t\t\t\t\t// style={state.description ? {display: 'none'} : {}}\r\n\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\tsetDescriptionShow(true);\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\tДобавить описание\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t(descriptionShow || state.description) &&\r\n\t\t\t\t\t\t<Textarea top={'Описание'}\r\n\t\t\t\t\t\t\t\t\t\t\tplaceholder={'Описание товара(продукта, услуги)'}\r\n\t\t\t\t\t\t\t\t\t\t\tvalue={state.description}\r\n\t\t\t\t\t\t\t\t\t\t\tmaxLength={70}\r\n\t\t\t\t\t\t\t\t\t\t\tstatus={state.validate?.description?.status}\r\n\t\t\t\t\t\t\t\t\t\t\tbottom={state.validate?.description?.message ? state.validate?.description?.message : `${state.description.length} из 70`}\r\n\t\t\t\t\t\t\t\t\t\t\tonChange={(e) => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tdispatchForm({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tpayload: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: regexp(e.currentTarget.value),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalidateForm: {description: validate(e)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t}\r\n\t\t\t\t</FormLayoutGroup>\r\n\t\t\t\t}\r\n\t\t\t<Input type={'text'}\r\n\t\t\t\t\t\t top={'Теги'}\r\n\t\t\t\t\t\t value={state.tags.join(' ')}\r\n\t\t\t\t\t\t placeholder={'Теги через пробел'}\r\n\t\t\t\t\t\t status={state.validate?.tags?.status}\r\n\t\t\t\t\t\t maxLength={50}\r\n\t\t\t\t\t\t bottom={state.validate?.tags?.message ? state.validate?.tags?.message : `${state.tags.join(' ').length} из 50 символов`}\r\n\t\t\t\t\t\t onChange={(e) => {\r\n\t\t\t\t\t\t\t dispatchForm({\r\n\t\t\t\t\t\t\t\t type: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t\t payload: {\r\n\t\t\t\t\t\t\t\t\t tags: e.currentTarget.value !== '' ? regexp(e.currentTarget.value).toLowerCase().split(' ') : [],\r\n\t\t\t\t\t\t\t\t\t validateForm: {tags: validate(e)}\r\n\t\t\t\t\t\t\t\t }\r\n\t\t\t\t\t\t\t })\r\n\t\t\t\t\t\t }}\r\n\t\t\t/>\r\n\t\t\t{\r\n\t\t\t\t!!tags.length &&\r\n\t\t\t\tstate.tags.length !== 0\r\n\t\t\t\t&&\r\n\t\t\t\t<Div style={{display: 'flex', flexWrap: 'wrap'}}>\r\n\t\t\t\t\t{tags}\r\n\t\t\t\t</Div>\r\n\t\t\t}\r\n\t\t\t<Input type={'number'}\r\n\t\t\t\t\t\t placeholder={currency(0)}\r\n\t\t\t\t\t\t pattern={'[0-9]+([,\\\\.][0-9]+)?'}\r\n\t\t\t\t\t\t top={'Цена'}\r\n\t\t\t\t\t\t inputMode=\"decimal\"\r\n\t\t\t\t\t\t max={99999999}\r\n\t\t\t\t\t\t min={0}\r\n\t\t\t\t\t\t step={0.0001}\r\n\t\t\t\t\t\t status={state.validate?.price?.status}\r\n\t\t\t\t\t\t bottom={state.validate?.price?.message}\r\n\t\t\t\t\t\t value={state.price}\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t onChange={(e) => {\r\n\t\t\t\t\t\t\t dispatchForm({\r\n\t\t\t\t\t\t\t\t type: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t\t payload: {price: e.currentTarget.value.replace(/[^\\d.]*/, ''), validateForm: {price: validate(e)}}\r\n\t\t\t\t\t\t\t })\r\n\t\t\t\t\t\t }}\r\n\t\t\t/>\r\n\t\t\t{\r\n\t\t\t\t!state.income\r\n\t\t\t\t&&\r\n\t\t\t\t<Checkbox checked={state.boxPrice}\r\n\t\t\t\t\t\t\t\t\tonChange={() => {\r\n\t\t\t\t\t\t\t\t\t\tdispatchForm({type: 'CHANGE_STATE', payload: {boxPrice: !state.boxPrice}})\r\n\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\tЦена за упаковку\r\n\t\t\t\t</Checkbox>\r\n\t\t\t}\r\n\t\t\t<Input type={'number'}\r\n\t\t\t\t\t\t placeholder={'0'}\r\n\t\t\t\t\t\t pattern={'[0-9]+([,\\\\.][0-9]+)?'}\r\n\t\t\t\t\t\t top={'Кол-во'}\r\n\t\t\t\t\t\t inputMode=\"decimal\"\r\n\t\t\t\t\t\t max={9999999}\r\n\t\t\t\t\t\t min={0}\r\n\t\t\t\t\t\t step={0.001}\r\n\t\t\t\t\t\t status={state.validate?.quantity?.status}\r\n\t\t\t\t\t\t bottom={state.validate?.quantity?.message}\r\n\t\t\t\t\t\t value={state.quantity}\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t onChange={(e) => {\r\n\t\t\t\t\t\t\t dispatchForm({\r\n\t\t\t\t\t\t\t\t type: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t\t payload: {\r\n\t\t\t\t\t\t\t\t\t quantity: e.currentTarget.value.replace(/[^\\d.]*/, ''),\r\n\t\t\t\t\t\t\t\t\t validateForm: {quantity: validate(e)}\r\n\t\t\t\t\t\t\t\t }\r\n\t\t\t\t\t\t\t })\r\n\t\t\t\t\t\t }}\r\n\t\t\t/>\r\n\t\t\t<Button size={'xl'}>\r\n\t\t\t\t{`Сохранить ${state.boxPrice ? currency(state.price) : currency(state.price * state.quantity)}`}\r\n\t\t\t</Button>\r\n\t\t</FormLayout>\r\n\t)\r\n}","import React from 'react';\r\nimport currency from \"../handlers/currency\";\r\n\r\nexport default ({color = 'black', value}) => {\r\n\tif (!value) return null;\r\n\treturn (\r\n\t\t<span style={{color: color}}>\r\n\t\t\t{currency(value)}\r\n\t\t</span>\r\n\t)\r\n}","import React from 'react';\r\nimport {Caption, RichCell} from \"@vkontakte/vkui\";\r\nimport {format} from \"date-fns\";\r\nimport ruLocale from \"date-fns/locale/ru\";\r\nimport currency from \"./currency\";\r\nimport {SET_EDITED_ITEM, SET_MODAL} from \"../state/actions\";\r\nimport Color from \"../components/Color\";\r\n\r\nexport default function mapRichCell({dispatch, tagsShow = true}) {\r\n\treturn (item, index) => {\r\n\t\tif (item?.caption) {\r\n\t\t\treturn (\r\n\t\t\t\t<Caption level=\"2\" weight=\"semibold\" caps\r\n\t\t\t\t\t\t\t\t key={index}>\r\n\t\t\t\t\t{format(new Date(item?.date), 'dd MMMM yyyy ', {locale: ruLocale})}\r\n\t\t\t\t\t<br/>\r\n\t\t\t\t\t{item?.income && item?.outcome ? ' [ ' : null}\r\n\t\t\t\t\t<Color value={item?.income} color={'green'}/>\r\n\t\t\t\t\t{item?.income && item?.outcome ? ' | ' : null}\r\n\t\t\t\t\t<Color value={item?.outcome} color={'red'}/>\r\n\t\t\t\t\t{item?.income && item?.outcome ? ' ]' : null}\r\n\t\t\t\t</Caption>\r\n\t\t\t)\r\n\t\t}\r\n\r\n\t\tconst tags = item?.tags.filter(tag => !!tag.length).map(\r\n\t\t\t(tag, index) =>\r\n\t\t\t\t<span key={index} style={{\r\n\t\t\t\t\tmarginLeft: '5px',\r\n\t\t\t\t\tmarginRight: '5px',\r\n\t\t\t\t\tmarginBottom: '5px',\r\n\t\t\t\t\tmaxWidth: '100%',\r\n\t\t\t\t\toverflow: 'hidden',\r\n\t\t\t\t\toverflowWrap: 'normal',\r\n\t\t\t\t\t// background: 'var(--counter_secondary_background)',\r\n\t\t\t\t\t// color: 'var(--counter_secondary_text)',\r\n\t\t\t\t\t// padding: '5px'\r\n\t\t\t\t}}><b>{tag}</b></span>\r\n\t\t);\r\n\t\tlet caption;\r\n\t\tlet after;\r\n\t\tif (tagsShow) {\r\n\t\t\tcaption = item?.tags.length !== 0 && <div style={{display: 'flex', flexWrap: 'wrap'}}><span>Теги:</span> {tags}</div>\r\n\t\t\tafter = item?.income ? currency(item?.sum) : currency(-1 * item?.sum)\r\n\t\t} else {\r\n\t\t\tcaption = <div style={{display: 'flex', flexWrap: 'wrap'}}>{format(new Date(item?.date), 'dd MMMM yyyy ', {locale: ruLocale})}</div>\r\n\t\t\tafter = item?.income ? currency(item?.sum) : currency(-1 * item?.sum);\r\n\t\t}\r\n\t\treturn (\r\n\t\t\t<RichCell\r\n\t\t\t\tkey={index}\r\n\t\t\t\tmultiline\r\n\t\t\t\tcaption={caption}\r\n\t\t\t\tafter={after}\r\n\t\t\t\tdata-id={item?._id}\r\n\t\t\t\tonClick={() => {\r\n\t\t\t\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: item}});\r\n\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: 'add-money'}});\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t{item?.title}\r\n\t\t\t</RichCell>\r\n\t\t)\r\n\t};\r\n}","import compareAsc from \"date-fns/compareAsc\";\r\n\r\nexport default function (a, b){\r\n\tconst aDate = new Date(a.date);\r\n\tconst bDate = new Date(b.date);\r\n\treturn compareAsc(bDate, aDate);\r\n}","import React, {useRef, useState, useEffect} from 'react';\r\nimport {FormLayout, Search} from \"@vkontakte/vkui\";\r\n\r\nexport default ({onSearch}) => {\r\n\r\n\tconst [searchStr, setSearchStr] = useState('');\r\n\tconst searchRef = useRef(null);\r\n\r\n\tuseEffect(() => {\r\n\t\tonSearch(searchStr);\r\n\t}, [searchStr, onSearch])\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t<FormLayout\r\n\t\t\tonSubmit={(e) => {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tsearchRef.current.focus();\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<Search\r\n\t\t\t\tvalue={searchStr}\r\n\t\t\t\tonChange={(e) => {\r\n\t\t\t\t\tsetSearchStr(e.currentTarget.value.substring(0, 20))\r\n\t\t\t\t}}\r\n\t\t\t/>\r\n\t\t</FormLayout>\r\n\t\t<input type={'radio'} style={{position: 'absolute', height: '0', width: '0', top: '0', left: '0'}} ref={searchRef}/>\r\n\t\t</>\r\n\t)\r\n}\r\n","import sort from \"./sort\";\r\n\r\nexport const ArrayToObjectWithDate = (items) => {\r\n\treturn items.sort(sort).reduce((prev, curr) => {\r\n\t\tconst index = +new Date(curr.date);\r\n\t\tif (prev[index]) {\r\n\t\t\tprev[index] = [...prev[index], curr];\r\n\t\t} else {\r\n\t\t\tprev[index] = [curr];\r\n\t\t}\r\n\t\treturn prev;\r\n\t}, {});\r\n}\r\n\r\nexport const ObjectToArrayWithDate = (indexAr) => {\r\n\tlet itemsListArray = [];\r\n\tObject.keys(indexAr).forEach(key => {\r\n\t\tconst items = indexAr[key];\r\n\t\tlet date = '';\r\n\t\tindexAr[key].income = 0;\r\n\t\tindexAr[key].outcome = 0;\r\n\t\titems.forEach(item => {\r\n\t\t\tdate = item.date;\r\n\t\t\titemsListArray.splice(0,0, item);\r\n\t\t\tif (item.income) {\r\n\t\t\t\tindexAr[key].income += item.sum;\r\n\t\t\t} else {\r\n\t\t\t\tindexAr[key].outcome += item.sum;\r\n\t\t\t}\r\n\t\t})\r\n\t\tindexAr[key].income = indexAr[key].income.toFixed(2);\r\n\t\tindexAr[key].outcome = indexAr[key].outcome.toFixed(2);\r\n\t\titemsListArray.splice(0,0,{date: date, income: indexAr[key].income, outcome: indexAr[key].outcome, caption: true})\r\n\t});\r\n\treturn itemsListArray;\r\n}","import React, {useEffect, useState} from 'react';\r\nimport useApi from \"../handlers/useApi\";\r\nimport {\r\n\tAlert,\r\n\tCell,\r\n\tDiv,\r\n\tFooter, Gallery,\r\n\tHeader,\r\n\tList,\r\n\tPanel,\r\n\tPanelHeader,\r\n\tPanelHeaderBack,\r\n\tPanelHeaderButton,\r\n\tPanelHeaderContent,\r\n\tPanelHeaderContext,\r\n\tTitle\r\n} from \"@vkontakte/vkui\";\r\nimport currency from \"../handlers/currency\";\r\nimport Group from \"@vkontakte/vkui/dist/components/Group/Group\";\r\nimport {\r\n\tSET_ACCOUNTS,\r\n\tSET_BUDGETS,\r\n\tSET_EDITED_ITEM,\r\n\tSET_HISTORY_BACK,\r\n\tSET_MODAL,\r\n\tSET_POPOUT,\r\n\tSET_TOGGLE_CONTEXT\r\n} from \"../state/actions\";\r\nimport Icon28MarketAddBadgeOutline from \"@vkontakte/icons/dist/28/market_add_badge_outline\";\r\nimport Icon16Dropdown from '@vkontakte/icons/dist/16/dropdown';\r\nimport Icon28DeleteOutline from '@vkontakte/icons/dist/28/delete_outline';\r\nimport Icon28EditOutline from \"@vkontakte/icons/dist/28/edit_outline\";\r\nimport mapRichCell from \"../handlers/mapRichCell\";\r\nimport InfoSnackbar from \"../components/InfoSnackbar\";\r\nimport sort from \"../handlers/sort\";\r\nimport MonthSwitch from \"../components/MonthSwitch\";\r\nimport SearchForm from \"../components/SearchForm\";\r\nimport Icon28MoneyTransfer from \"@vkontakte/icons/dist/28/money_transfer\";\r\nimport {ArrayToObjectWithDate, ObjectToArrayWithDate} from \"../handlers/formatingArrayWithDate\";\r\n\r\nexport default ({id, account, dispatch, onRefresh, context, date, scheme}) => {\r\n\tconst [isOpened, setIsOpened] = useState(() => context);\r\n\tconst [{response}, doApiFetch] = useApi(`/money-box/${account?._id}`);\r\n\tconst [accountContext, setAccountContext] = useState(true);\r\n\tconst [items, setItems] = useState(() => {\r\n\t\tif (!account) return [];\r\n\t\treturn account?.operations;\r\n\t});\r\n\tconst [searchStr, setSearchStr] = useState('');\r\n\tconst [filteredItems, setFilteredItems] = useState(() => items || []);\r\n\r\n\tconst indexAr = ArrayToObjectWithDate(filteredItems);\r\n\r\n\tconst accountItemsListArray = ObjectToArrayWithDate(indexAr);\r\n\r\n\tconst accountItemsList = accountItemsListArray.sort(sort).map(mapRichCell({dispatch}));\r\n\r\n\tconst toggleContext = () => {\r\n\t\tdispatch({type: SET_TOGGLE_CONTEXT, payload: {context: !isOpened}});\r\n\t}\r\n\tconst alert = (\r\n\t\t<Alert\r\n\t\t\tactions={[\r\n\t\t\t\t{\r\n\t\t\t\t\ttitle: 'Отмена',\r\n\t\t\t\t\tautoclose: true,\r\n\t\t\t\t\tmode: \"cancel\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttitle: 'Удалить',\r\n\t\t\t\t\tmode: 'destructive',\r\n\t\t\t\t\tautoclose: true,\r\n\t\t\t\t\taction: async () => {\r\n\t\t\t\t\t\ttoggleContext();\r\n\t\t\t\t\t\tawait doApiFetch({\r\n\t\t\t\t\t\t\tmethod: 'DELETE',\r\n\t\t\t\t\t\t\tparams: {\r\n\t\t\t\t\t\t\t\tdate: date\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]}\r\n\t\t\tonClose={() => {\r\n\t\t\t\ttoggleContext();\r\n\t\t\t\tdispatch({type: SET_POPOUT, payload: {popout: null}})\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<h2>Удалить счет?</h2>\r\n\t\t\t<p>Удаление счета приведет к удалению всех данных по доходам и расходам, привязанным к данному счету. Суммы\r\n\t\t\t\tбюджетов могут отображаться некорректно.</p>\r\n\t\t</Alert>\r\n\t)\r\n\r\n\tconst accountContextView = (\r\n\t\t<PanelHeaderContext opened={isOpened} onClose={toggleContext}>\r\n\t\t\t<List>\r\n\t\t\t\t<Cell\r\n\t\t\t\t\tbefore={<Icon28EditOutline/>}\r\n\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: account}});\r\n\t\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: 'add-account'}});\r\n\t\t\t\t\t\ttoggleContext();\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\tРедактировать счет\r\n\t\t\t\t</Cell>\r\n\t\t\t\t<Cell\r\n\t\t\t\t\tbefore={<Icon28DeleteOutline/>}\r\n\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\tdispatch({type: SET_POPOUT, payload: {popout: alert, alert: true}})\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\tУдалить счет {account?.title}\r\n\t\t\t\t</Cell>\r\n\t\t\t</List>\r\n\t\t</PanelHeaderContext>\r\n\t);\r\n\tconst itemContextView = (\r\n\t\t<PanelHeaderContext opened={isOpened} onClose={toggleContext}>\r\n\t\t\t<List>\r\n\t\t\t\t<Cell\r\n\t\t\t\t\tbefore={<Icon28MarketAddBadgeOutline/>}\r\n\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: null}});\r\n\t\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: 'add-money'}});\r\n\t\t\t\t\t\ttoggleContext();\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\tДобавить\r\n\t\t\t\t</Cell>\r\n\t\t\t\t<Cell\r\n\t\t\t\t\tbefore={<Icon28MoneyTransfer/>}\r\n\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: 'transfer-money'}});\r\n\t\t\t\t\t\ttoggleContext();\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\tПеревести\r\n\t\t\t\t</Cell>\r\n\t\t\t</List>\r\n\t\t</PanelHeaderContext>\r\n\t)\r\n\r\n\tconst contextView = accountContext ? accountContextView : itemContextView;\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!account) return;\r\n\t\tsetItems(account?.operations);\r\n\t\tsetFilteredItems(account?.operations);\r\n\t}, [account]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tdispatch({type: SET_POPOUT, payload: {popout: null}});\r\n\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: null}});\r\n\t\tdispatch({type: SET_ACCOUNTS, payload: {accounts: response?.accounts ? response?.accounts : []}});\r\n\t\tdispatch({type: SET_BUDGETS, payload: {budgets: response?.budgets ? response?.budgets : []}});\r\n\t\tdispatch({type: SET_HISTORY_BACK});\r\n\t}, [dispatch, response]);\r\n\r\n\tuseEffect(() => {\r\n\t\tsetIsOpened(context);\r\n\t}, [context]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (searchStr === '') {\r\n\t\t\tsetFilteredItems(items);\r\n\t\t} else {\r\n\t\t\tsetFilteredItems(account?.operations.filter(({title}) => title.toLowerCase().indexOf(searchStr.toLowerCase()) > -1));\r\n\t\t}\r\n\t}, [searchStr, account, items]);\r\n\r\n\tconst onSearch = (str) => {\r\n\t\tsetSearchStr(str);\r\n\t}\r\n\r\n\tconst incomeSum = account?.operations?.filter(item => !!item.income).reduce((acc, cur) => acc + cur.sum, 0);\r\n\tconst outcomeSum = account?.operations?.filter(item => !item.income).reduce((acc, cur) => acc + cur.sum, 0);\r\n\r\n\treturn (\r\n\t\t<Panel id={id}>\r\n\t\t\t<PanelHeader left={\r\n\t\t\t\t<>\r\n\t\t\t\t\t<PanelHeaderBack onClick={() => {\r\n\t\t\t\t\t\tdispatch({type: SET_HISTORY_BACK})\r\n\t\t\t\t\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: null}});\r\n\t\t\t\t\t}}/>\r\n\t\t\t\t\t<PanelHeaderButton\r\n\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\tsetAccountContext(false);\r\n\t\t\t\t\t\t\ttoggleContext();\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Icon28MarketAddBadgeOutline/>\r\n\t\t\t\t\t</PanelHeaderButton>\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\t\t\t>\r\n\t\t\t\t<PanelHeaderContent\r\n\t\t\t\t\taside={account && <Icon16Dropdown style={{transform: `rotate(${isOpened ? '180deg' : '0'})`}}/>}\r\n\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\tsetAccountContext(true);\r\n\t\t\t\t\t\ttoggleContext();\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t{account ? account?.title : 'Счет удалён'}\r\n\t\t\t\t</PanelHeaderContent>\r\n\t\t\t</PanelHeader>\r\n\t\t\t{\r\n\t\t\t\taccount\r\n\t\t\t\t&&\r\n\t\t\t\t<>\r\n\t\t\t\t\t{contextView}\r\n\t\t\t\t\t<MonthSwitch onRefresh={onRefresh}/>\r\n\r\n\t\t\t\t\t<SearchForm onSearch={onSearch}/>\r\n\r\n\t\t\t\t\t<Group\r\n\t\t\t\t\t\theader={<Header mode=\"secondary\">Информация по счету</Header>}\r\n\t\t\t\t\t\tseparator=\"show\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Gallery\r\n\t\t\t\t\t\t\tslideWidth={'100%'}\r\n\t\t\t\t\t\t\tbullets={scheme === 'client_light' || scheme === 'bright_light' ? 'dark' : 'light'}\r\n\t\t\t\t\t\t\tstyle={{height: 'auto'}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<Div>\r\n\t\t\t\t\t\t\t\t<Title level={'3'} weight={'semibold'}>Остаток по счету</Title>\r\n\t\t\t\t\t\t\t\t<Title level=\"1\" weight=\"bold\" style={{marginBottom: 16}}>{currency(account?.sum)}</Title>\r\n\r\n\t\t\t\t\t\t\t</Div>\r\n\t\t\t\t\t\t\t<Div>\r\n\t\t\t\t\t\t\t\t<Title level=\"3\" weight=\"semibold\" style={{marginBottom: 16}}>Доход: {currency(incomeSum || 0)}</Title>\r\n\t\t\t\t\t\t\t\t<Title level=\"3\" weight=\"semibold\" style={{marginBottom: 16}}>Расход: {currency(-1*outcomeSum || 0)}</Title>\r\n\t\t\t\t\t\t\t\t<Title level=\"3\" weight=\"semibold\" style={{marginBottom: 16}}>Баланс: {currency(incomeSum - outcomeSum)}</Title>\r\n\t\t\t\t\t\t\t</Div>\r\n\t\t\t\t\t\t</Gallery>\r\n\r\n\r\n\t\t\t\t\t\t{account?.operations.length === 0 && <Footer>Операций по счету еще не было</Footer>}\r\n\t\t\t\t\t\t<Div>\r\n\t\t\t\t\t\t\t{accountItemsList}\r\n\t\t\t\t\t\t\t{accountItemsList.length === 0 && <Footer>Нет данных для отображения</Footer>}\r\n\t\t\t\t\t\t</Div>\r\n\t\t\t\t\t</Group>\r\n\t\t\t\t\t<InfoSnackbar/>\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\r\n\t\t</Panel>\r\n\t)\r\n}","import React, {useEffect} from 'react';\r\nimport {format} from 'date-fns';\r\nimport ruLocale from 'date-fns/locale/ru';\r\nimport {FixedLayout, Footer, Group, Header, Panel, PanelHeader, PanelHeaderButton, PromoBanner} from \"@vkontakte/vkui\";\r\nimport ListOfItems from \"../components/ListOfItems\";\r\nimport {SET_MODAL} from \"../state/actions\";\r\nimport Icon28ListAddOutline from \"@vkontakte/icons/dist/28/list_add_outline\";\r\nimport InfoSnackbar from \"../components/InfoSnackbar\";\r\nimport MonthSwitch from \"../components/MonthSwitch\";\r\nimport bridge from \"@vkontakte/vk-bridge\";\r\n\r\nexport default ({id, budgets, dispatch, date = new Date(), onRefresh, bannerData, setBannerData}) => {\r\n\t// let budgetsStartSum = budgets.map(el => el.startSum).reduce((acc, cur) => acc + cur, 0);\r\n\t// let incomeBudgetSum = budgets.map(el => el.items).flat().map(item => item.income ? item.sum : 0).reduce((acc, cur) => acc + cur, 0);\r\n\t// let outcomeBudgetsSum = budgets.map(el => el.items).flat().map(item => !item.income ? item.sum : 0).reduce((acc, cur) => acc + cur, 0);\r\n\r\n\tuseEffect(() => {\r\n\t\tbridge.send('VKWebAppGetAds', {});\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<Panel id={id}>\r\n\t\t\t<PanelHeader\r\n\t\t\t\tleft={\r\n\t\t\t\t\t<PanelHeaderButton onClick={() => dispatch({type: SET_MODAL, payload: {modal: 'add-budget'}})}>\r\n\t\t\t\t\t\t<Icon28ListAddOutline/>\r\n\t\t\t\t\t</PanelHeaderButton>\r\n\t\t\t\t}\r\n\t\t\t>\r\n\t\t\t\tБюджеты\r\n\t\t\t</PanelHeader>\r\n\t\t\t<MonthSwitch onRefresh={onRefresh} />\r\n\t\t\t<Group\r\n\t\t\t\theader={<Header mode=\"secondary\">Ваши бюджеты\r\n\t\t\t\t\tна {format(new Date(date), 'dd MMMM yyyy', {locale: ruLocale})}</Header>}\r\n\t\t\t\t// separator=\"show\"\r\n\t\t\t>\r\n\t\t\t\t<ListOfItems data={budgets} dispatch={dispatch} showAll={true} itemsName={'budgets'} needHide={false}/>\r\n\t\t\t\t<Footer>Цифры напротив бюджета отображают сколько Вы можете еще потратить, но помните, что могут быть смежные траты, которые относятся к нескольким бюджетам. Проверяйте внимательно.</Footer>\r\n\t\t\t</Group>\r\n\t\t\t<FixedLayout vertical={\"bottom\"}>\r\n\t\t\t\t{bannerData && <PromoBanner bannerData={bannerData} onClose={() => setBannerData(null)}/>}\r\n\t\t\t</FixedLayout>\r\n\t\t\t<InfoSnackbar/>\r\n\t\t</Panel>\r\n\t)\r\n}","import React, {useEffect, useReducer, useState} from 'react';\r\nimport {Button, FormLayout, Input} from \"@vkontakte/vkui\";\r\nimport useApi from \"../../handlers/useApi\";\r\nimport validate from \"../../handlers/validate\";\r\nimport currency from \"../../handlers/currency\";\r\nimport regexp from \"../../handlers/regexp\";\r\nimport {SET_ACCOUNTS, SET_BUDGETS, SET_EDITED_ITEM} from \"../../state/actions\";\r\n\r\nconst initialState = {\r\n\ttitle: '',\r\n\tstartSum: '',\r\n\tvalidate: {\r\n\t\ttitle: {},\r\n\t\tstartSum: {}\r\n\t}\r\n}\r\n\r\nconst reducer = (state, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'CHANGE_STATE':\r\n\t\t\tconst {payload: {validateForm, ...payload}} = action;\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\t...payload,\r\n\t\t\t\tvalidate: {...state.validate, ...validateForm}\r\n\t\t\t}\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n}\r\n\r\nexport default ({dispatch, editedItem = null, date}) => {\r\n\tconst [stateForm, dispatchForm] = useReducer(reducer, initialState);\r\n\tconst [apiStr] = useState(() => {\r\n\t\treturn !editedItem ? '/budget' : `/budget/${editedItem._id}`;\r\n\t})\r\n\tconst [{response}, doApiFetch] = useApi(apiStr);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!editedItem) return;\r\n\t\tif (!response) dispatchForm({type: 'CHANGE_STATE', payload: {...editedItem}});\r\n\t}, [editedItem, dispatchForm, response]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tdispatch({type: SET_ACCOUNTS, payload: {accounts: response?.accounts ? response?.accounts : []}});\r\n\t\tdispatch({type: SET_BUDGETS, payload: {budgets: response?.budgets ? response?.budgets : []}});\r\n\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: null}});\r\n\t}, [response, dispatch]);\r\n\r\n\treturn (\r\n\t\t<FormLayout\r\n\t\t\tonSubmit={async e => {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tawait doApiFetch({\r\n\t\t\t\t\tmethod: !editedItem ? 'POST' : 'PATCH',\r\n\t\t\t\t\ttitle: stateForm.title,\r\n\t\t\t\t\tsum: stateForm.startSum,\r\n\t\t\t\t\tparams: {\r\n\t\t\t\t\t\tdate: new Date(date)\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<Input type={'text'} placeholder={'Название бюджета'} top={'Название'} value={stateForm.title}\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t maxLength={'20'}\r\n\t\t\t\t\t\t status={stateForm.validate?.title?.status}\r\n\t\t\t\t\t\t bottom={stateForm.validate?.title?.message ? stateForm.validate?.title?.message : `${stateForm.title.length} из 20`}\r\n\t\t\t\t\t\t onChange={e => dispatchForm({\r\n\t\t\t\t\t\t\t type: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t payload: {title: regexp(e.currentTarget.value), validateForm: {title: validate(e)}}\r\n\t\t\t\t\t\t })}/>\r\n\t\t\t<Input type={'number'} placeholder={currency(0)} top={'Бюджет в рублях'} value={stateForm.startSum}\r\n\t\t\t\t\t\t pattern={'[0-9]+([,\\\\.][0-9]+)?'}\r\n\t\t\t\t\t\t inputMode=\"decimal\"\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t status={stateForm.validate?.startSum?.status}\r\n\t\t\t\t\t\t min={0}\r\n\t\t\t\t\t\t max={999999999}\r\n\t\t\t\t\t\t step={0.01}\r\n\t\t\t\t\t\t bottom={stateForm.validate?.startSum?.message ? stateForm.validate?.startSum?.message : 'Сколько вы готовы на это потратить?'}\r\n\t\t\t\t\t\t onChange={e => dispatchForm({\r\n\t\t\t\t\t\t\t type: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t payload: {startSum: e.currentTarget.value, validateForm: {startSum: validate(e)}}\r\n\t\t\t\t\t\t })}/>\r\n\t\t\t<Button size={'xl'}>Сохранить</Button>\r\n\t\t</FormLayout>\r\n\t)\r\n}","import isEqual from \"date-fns/isEqual\";\r\n\r\nexport default function (prev, curr) {\r\n\tif (isEqual(new Date(prev[prev.length-1]?.date), new Date(curr.date))) {\r\n\t\treturn [...prev, curr];\r\n\t} else {\r\n\t\treturn [...prev, {date: curr.date, caption: true}, curr];\r\n\t}\r\n}","import React, {useEffect, useState} from 'react';\r\nimport {\r\n\tAlert,\r\n\tCell,\r\n\tDiv,\r\n\tFooter,\r\n\tGroup,\r\n\tList,\r\n\tMiniInfoCell,\r\n\tPanel,\r\n\tPanelHeader,\r\n\tPanelHeaderBack,\r\n\tPanelHeaderButton,\r\n\tPanelHeaderContent,\r\n\tPanelHeaderContext\r\n} from \"@vkontakte/vkui\";\r\nimport {\r\n\tSET_ACCOUNTS, SET_BUDGETS,\r\n\tSET_EDITED_ITEM,\r\n\tSET_HISTORY_BACK,\r\n\tSET_MODAL,\r\n\tSET_POPOUT,\r\n\tSET_TOGGLE_CONTEXT\r\n} from \"../state/actions\";\r\nimport Icon28MarketAddBadgeOutline from \"@vkontakte/icons/dist/28/market_add_badge_outline\";\r\nimport useApi from \"../handlers/useApi\";\r\nimport Icon16Dropdown from \"@vkontakte/icons/dist/16/dropdown\";\r\nimport Icon28DeleteOutline from '@vkontakte/icons/dist/28/delete_outline';\r\nimport Icon28EditOutline from '@vkontakte/icons/dist/28/edit_outline';\r\nimport Icon20PinOutline from '@vkontakte/icons/dist/20/pin_outline';\r\nimport Icon20Add from '@vkontakte/icons/dist/20/add';\r\nimport Icon20BombOutline from '@vkontakte/icons/dist/20/bomb_outline';\r\nimport mapRichCell from \"../handlers/mapRichCell\";\r\nimport InfoSnackbar from \"../components/InfoSnackbar\";\r\nimport sort from \"../handlers/sort\";\r\nimport reduce from \"../handlers/reduce\";\r\nimport currency from \"../handlers/currency\";\r\nimport SearchForm from \"../components/SearchForm\";\r\nimport {differenceInMonths} from 'date-fns';\r\n\r\nexport default ({id, budget, dispatch, context, date}) => {\r\n\tconst [isOpened, setIsOpened] = useState(() => context);\r\n\tconst [{response}, doApiFetch] = useApi(`/budget/${budget?._id}`);\r\n\tconst [items, setItems] = useState(() => budget?.items);\r\n\tconst [filteredItems, setFilteredItems] = useState(() => items);\r\n\tconst [searchStr, setSearchStr] = useState('');\r\n\r\n\tuseEffect(() => {\r\n\t\tsetItems(budget?.items);\r\n\t\tsetFilteredItems(budget?.items);\r\n\t}, [budget])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tif (response?.deletedCount) {\r\n\t\t\tdispatch({type: SET_HISTORY_BACK});\r\n\t\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: null}});\r\n\t\t}\r\n\t\tdispatch({type: SET_ACCOUNTS, payload: {accounts: response?.accounts ? response?.accounts : []}});\r\n\t\tdispatch({type: SET_BUDGETS, payload: {budgets: response?.budgets ? response?.budgets : []}});\r\n\t}, [response, dispatch]);\r\n\r\n\tuseEffect(() => {\r\n\t\tsetIsOpened(context);\r\n\t}, [context]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (searchStr === '') {\r\n\t\t\tsetFilteredItems(items);\r\n\t\t} else {\r\n\t\t\tsetFilteredItems(budget.items.filter(({title}) => title.toLowerCase().indexOf(searchStr.toLowerCase()) > -1));\r\n\t\t}\r\n\t}, [searchStr, budget, items]);\r\n\r\n\tconst toggleContext = () => {\r\n\t\tdispatch({type: SET_TOGGLE_CONTEXT, payload: {context: !isOpened}});\r\n\t}\r\n\r\n\tconst alertDelete = (\r\n\t\t<Alert\r\n\t\t\tactions={[\r\n\t\t\t\t{\r\n\t\t\t\t\ttitle: 'Отмена',\r\n\t\t\t\t\tautoclose: true,\r\n\t\t\t\t\tmode: \"cancel\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttitle: 'Удалить',\r\n\t\t\t\t\tmode: 'destructive',\r\n\t\t\t\t\tautoclose: true,\r\n\t\t\t\t\taction: async () => {\r\n\t\t\t\t\t\ttoggleContext();\r\n\t\t\t\t\t\tawait doApiFetch({\r\n\t\t\t\t\t\t\tmethod: 'DELETE',\r\n\t\t\t\t\t\t\tparams: {\r\n\t\t\t\t\t\t\t\tdate: date\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]}\r\n\t\t\tonClose={() => {\r\n\t\t\t\ttoggleContext();\r\n\t\t\t\tdispatch({type: SET_POPOUT, payload: {popout: null}})\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<h2>Удалить бюджет?</h2>\r\n\t\t\t<p>Вы действительно хотите удалить бюджет?</p>\r\n\t\t</Alert>\r\n\t)\r\n\r\n\tconst itemsList = filteredItems && filteredItems.sort(sort).reduce(reduce, []).map(mapRichCell({dispatch}));\r\n\r\n\tconst onSearch = (str) => {\r\n\t\tsetSearchStr(str);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Panel id={id}>\r\n\t\t\t<PanelHeader left={\r\n\t\t\t\t<>\r\n\t\t\t\t\t<PanelHeaderBack onClick={() => {\r\n\t\t\t\t\t\tdispatch({type: SET_HISTORY_BACK});\r\n\t\t\t\t\t}}/>\r\n\t\t\t\t\t{differenceInMonths(new Date(), new Date(date)) === 0 &&\r\n\t\t\t\t\t\t<PanelHeaderButton\r\n\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: null}});\r\n\t\t\t\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: 'add-money'}});\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<Icon28MarketAddBadgeOutline/>\r\n\t\t\t\t\t\t</PanelHeaderButton>\r\n\t\t\t\t\t}\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\t\t\t>\r\n\t\t\t\t<PanelHeaderContent\r\n\t\t\t\t\taside={budget && <Icon16Dropdown style={{transform: `rotate(${isOpened ? '180deg' : '0'})`}}/>}\r\n\t\t\t\t\tonClick={toggleContext}\r\n\t\t\t\t>\r\n\t\t\t\t\t{budget ? budget?.title : 'Бюджет удалён'}\r\n\t\t\t\t</PanelHeaderContent>\r\n\t\t\t</PanelHeader>\r\n\t\t\t{\r\n\t\t\t\tbudget &&\r\n\t\t\t\t<>\r\n\t\t\t\t\t<PanelHeaderContext opened={isOpened} onClose={toggleContext}>\r\n\t\t\t\t\t\t<List>\r\n\t\t\t\t\t\t\t<Cell\r\n\t\t\t\t\t\t\t\tbefore={<Icon28EditOutline/>}\r\n\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: budget}})\r\n\t\t\t\t\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: 'add-budget'}})\r\n\t\t\t\t\t\t\t\t\ttoggleContext();\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tИзменить бюджет {budget?.title}\r\n\t\t\t\t\t\t\t</Cell>\r\n\t\t\t\t\t\t\t<Cell\r\n\t\t\t\t\t\t\t\tbefore={<Icon28DeleteOutline/>}\r\n\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\tdispatch({type: SET_POPOUT, payload: {popout: alertDelete, alert: true}})\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tУдалить бюджет {budget?.title}\r\n\t\t\t\t\t\t\t</Cell>\r\n\t\t\t\t\t\t</List>\r\n\t\t\t\t\t</PanelHeaderContext>\r\n\t\t\t\t\t<SearchForm onSearch={onSearch}/>\r\n\t\t\t\t\t<Group>\r\n\t\t\t\t\t\t<MiniInfoCell\r\n\t\t\t\t\t\t\tbefore={<Icon20PinOutline/>}\r\n\t\t\t\t\t\t\tmode={'base'}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tПервоначальная сумма {currency(budget.startSum)}\r\n\t\t\t\t\t\t</MiniInfoCell>\r\n\t\t\t\t\t\t<MiniInfoCell\r\n\t\t\t\t\t\t\tbefore={<Icon20Add/>}\r\n\t\t\t\t\t\t\tmode={'base'}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tДобавлено в\r\n\t\t\t\t\t\t\tбюджет {currency(budget.items.map(item => item.income ? item.sum : 0).reduce((acc, cur) => acc + cur, 0))}\r\n\t\t\t\t\t\t</MiniInfoCell>\r\n\t\t\t\t\t\t<MiniInfoCell\r\n\t\t\t\t\t\t\tbefore={<Icon20BombOutline/>}\r\n\t\t\t\t\t\t\tmode={'base'}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tПотрачено {currency(budget.items.map(item => !item.income ? item.sum : 0).reduce((acc, cur) => acc + cur, 0))}\r\n\t\t\t\t\t\t</MiniInfoCell>\r\n\t\t\t\t\t</Group>\r\n\t\t\t\t\t<Div>\r\n\t\t\t\t\t\t{itemsList}\r\n\t\t\t\t\t\t{itemsList?.length === 0 && <Footer>Нет данных для отображения</Footer>}\r\n\t\t\t\t\t</Div>\r\n\t\t\t\t\t<InfoSnackbar/>\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\t\t</Panel>\r\n\t)\r\n}","import React from 'react';\r\nimport {RichCell} from \"@vkontakte/vkui\";\r\nimport currency from \"./currency\";\r\nimport {SET_ACTIVE_VIEW} from \"../state/actions\";\r\n\r\nexport const getAllTags = (array) => {\r\n    return array\r\n        .map(item => {\r\n            return item.operations\r\n        })\r\n        .flat()\r\n        .map(operation => {\r\n            return operation.tags\r\n        })\r\n        .flat()\r\n        .sort((a, b) => a.localeCompare(b))\r\n        .reduce((prev, curr) => {\r\n            if (prev[prev.length - 1] === curr) {\r\n                return [...prev]\r\n            } else {\r\n                return [...prev, curr]\r\n            }\r\n        }, [])\r\n}\r\n\r\nexport const getTagsListItemsFromAccount = (array) => {\r\n    const tagsListItems = {};\r\n\r\n    if (!Array.isArray(array)) {\r\n        return array\r\n    }\r\n\r\n    array.forEach((account) => {\r\n        const {operations} = account;\r\n        operations.forEach(operation => {\r\n            const {tags} = operation;\r\n            // if (operation.income) return;\r\n            if (tags.length === 0) {\r\n                if (!tagsListItems['Без тега']) {\r\n                    tagsListItems['Без тега'] = [operation]\r\n                } else {\r\n                    tagsListItems['Без тега'] = [...tagsListItems['Без тега'], operation];\r\n                }\r\n            } else {\r\n                tags.forEach(tag => {\r\n                    if (!tagsListItems[tag]) {\r\n                        tagsListItems[tag] = [operation];\r\n                    } else {\r\n                        tagsListItems[tag] = [...tagsListItems[tag], operation];\r\n                    }\r\n                })\r\n            }\r\n        })\r\n    });\r\n    return tagsListItems\r\n}\r\n\r\nexport const getTagsListItemsView = (array, dispatch, setSelectedTagTitle) => {\r\n    let tagsListItemView = [];\r\n\r\n    const tagsList = getTagsListItemsFromAccount(array);\r\n\r\n    for (const [key, value] of Object.entries(tagsList)) {\r\n        const outSum = value.reduce((prev, curr) => {\r\n            if (!curr.income) {\r\n                return prev + curr.sum\r\n            } else {\r\n                return prev\r\n            }\r\n        }, 0);\r\n        const view = (\r\n          <RichCell\r\n            key={key}\r\n            multiline\r\n            caption={`Кол-во: ${(value.length)}`}\r\n            after={currency(outSum)}\r\n            data-title={key}\r\n            onClick={(e) => {\r\n                setSelectedTagTitle(e.currentTarget.dataset.title);\r\n                dispatch({type: SET_ACTIVE_VIEW, payload: {view: 'stats', panel: 'details-tags'}});\r\n            }}\r\n          >\r\n              {key !== 'empty' ? key : 'Без тега'}\r\n          </RichCell>\r\n        )\r\n        tagsListItemView = [...tagsListItemView, view]\r\n    }\r\n    return tagsListItemView;\r\n}","import React, {useEffect, useState} from 'react';\r\nimport {\r\n    Cell,\r\n    Footer,\r\n    Group, Header,\r\n    List,\r\n    Panel,\r\n    PanelHeader,\r\n    PanelHeaderContent,\r\n    PanelHeaderContext\r\n} from \"@vkontakte/vkui\";\r\nimport MonthSwitch from \"../components/MonthSwitch\";\r\nimport mapStats from \"../handlers/mapStats\";\r\nimport SearchForm from \"../components/SearchForm\";\r\nimport Icon16Dropdown from \"@vkontakte/icons/dist/16/dropdown\";\r\nimport {SET_TOGGLE_CONTEXT} from \"../state/actions\";\r\nimport Icon28MarketAddBadgeOutline from \"@vkontakte/icons/dist/28/market_add_badge_outline\";\r\nimport Icon28MoneyTransfer from \"@vkontakte/icons/dist/28/money_transfer\";\r\nimport {getTagsListItemsFromAccount, getTagsListItemsView} from \"../handlers/getTagsListFromAccounts\";\r\n\r\nexport default ({id, accounts, context, onRefresh, dispatch, setSelectedTagTitle, groupedByStats, setGroupedByStats, setSelectedItemTitle}) => {\r\n    const [operations, setOperations] = useState(() => {\r\n        return accounts\r\n            .map(item => item.operations)\r\n            .flat()\r\n            .filter(({income}) => !income)\r\n            .sort((a, b) => a.title.localeCompare(b.title))\r\n    });\r\n    const [isOpened, setIsOpened] = useState(false);\r\n    const [searchStr, setSearchStr] = useState('');\r\n    const [filteredItems, setFilteredItems] = useState(() => operations);\r\n    const [filteredTags, setFilteredTags] = useState([]);\r\n    const reducer = (prev, curr) => {\r\n        if (prev[prev.length - 1]?.title === curr.title) {\r\n            const prevItem = prev[prev.length - 1];\r\n            prevItem.sum = prevItem.sum + curr.sum;\r\n            prevItem.quantity += curr.quantity;\r\n            const array = [...prev.slice(0, prev.length - 1), prevItem];\r\n            return [...array];\r\n        } else {\r\n            return [...prev, {title: curr.title, sum: curr.sum, quantity: curr.quantity}];\r\n        }\r\n    }\r\n\r\n    const tagsListItemView = getTagsListItemsView(filteredTags, dispatch, setSelectedTagTitle);\r\n\r\n    const accountItemsList = filteredItems\r\n        .reduce(reducer, [])\r\n        .map(mapStats({dispatch, setSelectedItemTitle}));\r\n\r\n    useEffect(() => {\r\n        setIsOpened(context);\r\n    }, [context]);\r\n\r\n    useEffect(() => {\r\n        if (groupedByStats === 'title') {\r\n            const items = accounts\r\n              .map(item => item.operations)\r\n              .flat()\r\n              .filter(({income}) => !income)\r\n              .sort((a, b) => a.title.localeCompare(b.title));\r\n            setOperations(items);\r\n            setFilteredItems(items);\r\n        }\r\n\r\n        if (groupedByStats === 'tags') {\r\n            setFilteredTags(getTagsListItemsFromAccount(accounts));\r\n        }\r\n    }, [accounts, groupedByStats]);\r\n\r\n    useEffect(() => {\r\n        if (searchStr === '') {\r\n            if (groupedByStats === 'title') {\r\n                setFilteredItems(accounts\r\n                  .map(item => item.operations)\r\n                  .flat()\r\n                  .filter(({income}) => !income)\r\n                  .sort((a, b) => a.title.localeCompare(b.title))\r\n                );\r\n            }\r\n            if (groupedByStats === 'tags') {\r\n                setFilteredTags(getTagsListItemsFromAccount(accounts));\r\n            }\r\n        } else {\r\n            if (groupedByStats === 'title') {\r\n                setFilteredItems(accounts\r\n                  .map(item => item.operations)\r\n                  .flat()\r\n                  .filter(({income}) => !income)\r\n                  .sort((a, b) => a.title.localeCompare(b.title))\r\n                  .filter(({title}) => title.toLowerCase().indexOf(searchStr.toLowerCase()) > -1));\r\n            }\r\n            if (groupedByStats === 'tags') {\r\n                const preparedTagsArray = getTagsListItemsFromAccount(accounts);\r\n                let filteredTags = {};\r\n                const keys = Object.keys(preparedTagsArray);\r\n                keys.forEach(key => {\r\n                    if (key.toLowerCase().indexOf(searchStr.toLowerCase()) > -1) {\r\n                        filteredTags[key] = preparedTagsArray[key];\r\n                    }\r\n                });\r\n                setFilteredTags(filteredTags);\r\n            }\r\n        }\r\n    }, [searchStr, accounts, groupedByStats]);\r\n\r\n    const onSearch = (str) => {\r\n        setSearchStr(str);\r\n    }\r\n\r\n    const toggleContext = () => {\r\n        dispatch({type: SET_TOGGLE_CONTEXT, payload: {context: !isOpened}});\r\n    }\r\n\r\n    return (\r\n        <Panel id={id}>\r\n            <PanelHeader>\r\n                <PanelHeaderContent\r\n                    aside={<Icon16Dropdown style={{transform: `rotate(${isOpened ? '180deg' : '0'})`}}/>}\r\n                    onClick={() => {\r\n                        toggleContext();\r\n                    }}\r\n                >\r\n                    Сводка\r\n                </PanelHeaderContent>\r\n            </PanelHeader>\r\n            <PanelHeaderContext opened={isOpened} onClose={toggleContext}>\r\n                <List>\r\n                    <Header mode=\"secondary\">Сгруппировано по {groupedByStats === 'title' ? 'названию' : 'тэгам'}</Header>\r\n                    <Cell\r\n                        before={<Icon28MarketAddBadgeOutline/>}\r\n                        onClick={() => {\r\n                            setGroupedByStats('title')\r\n                            toggleContext();\r\n                        }}\r\n                    >\r\n                        По названию\r\n                    </Cell>\r\n                    <Cell\r\n                        before={<Icon28MoneyTransfer/>}\r\n                        onClick={() => {\r\n                            setGroupedByStats('tags')\r\n                            toggleContext();\r\n                        }}\r\n                    >\r\n                        По тэгам\r\n                    </Cell>\r\n                </List>\r\n            </PanelHeaderContext>\r\n            <MonthSwitch onRefresh={onRefresh}/>\r\n            <SearchForm onSearch={onSearch}/>\r\n            <Group\r\n              header={<Header mode=\"secondary\">Сгруппировано по {groupedByStats === 'title' ? 'названию' : 'тэгам'}</Header>}\r\n              separator=\"show\"\r\n            >\r\n                {groupedByStats === 'title' ? accountItemsList : tagsListItemView}\r\n                {accountItemsList.length === 0 && <Footer>Нет данных для отображения</Footer>}\r\n            </Group>\r\n        </Panel>\r\n    )\r\n}","import React from 'react';\r\nimport {RichCell} from \"@vkontakte/vkui\";\r\nimport currency from \"./currency\";\r\nimport {SET_ACTIVE_VIEW} from \"../state/actions\";\r\n\r\nexport default ({dispatch, setSelectedItemTitle}) => {\r\n\treturn (item, index) => {\r\n\t\treturn (\r\n\t\t\t<RichCell\r\n\t\t\t\tdisabled\r\n\t\t\t\tkey={index}\r\n\t\t\t\tmultiline\r\n\t\t\t\tcaption={`Кол-во: ${(item?.quantity).toFixed(3)} | Ср. цена: ${currency((item?.sum/item?.quantity).toFixed(2))}`}\r\n\t\t\t\tafter={currency(item?.sum)}\r\n\t\t\t\tdata-title={item?.title}\r\n\t\t\t\tonClick={\r\n\t\t\t\t\t() => {\r\n\t\t\t\t\t\tsetSelectedItemTitle(item?.title);\r\n\t\t\t\t\t\tdispatch({type: SET_ACTIVE_VIEW, payload: {view: 'stats', panel: 'details-items'}});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t>\r\n\t\t\t\t{item?.title}\r\n\t\t\t</RichCell>\r\n\t\t)\r\n\t}\r\n}","import React from 'react';\r\nimport {Button, FixedLayout, Panel, Placeholder, PromoBanner, Spinner} from \"@vkontakte/vkui\";\r\nimport {SET_ACTIVE_VIEW} from \"../state/actions\";\r\nimport Icon36Done from '@vkontakte/icons/dist/36/done';\r\n\r\nexport default ({id, dispatch, loading, bannerData, setBannerData}) => {\r\n\treturn (\r\n\t\t<Panel id={id}>\r\n\t\t\t<Placeholder\r\n\t\t\t\ticon={loading ? <Spinner size=\"large\"/> : <Icon36Done/>}\r\n\t\t\t\taction={\r\n\t\t\t\t\t!loading && <Button\r\n\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\tdispatch({type: SET_ACTIVE_VIEW, payload: {view: 'home', panel: 'home'}});\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tid={'initial-button'}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\tЗапустить\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t}\r\n\t\t\t\tstretched\r\n\t\t\t>\r\n\t\t\t\t{loading ? 'Подготавливаем приложение к запуску' : 'Приложение готово'}\r\n\t\t\t</Placeholder>\r\n\t\t\t<FixedLayout vertical={\"bottom\"}>\r\n\t\t\t\t{bannerData && <PromoBanner bannerData={bannerData} onClose={() => setBannerData(null)}/>}\r\n\t\t\t</FixedLayout>\r\n\t\t</Panel>\r\n\t)\r\n}\r\n","import React, {useEffect, useState} from 'react';\r\nimport bridge from '@vkontakte/vk-bridge';\r\nimport {Cell, FixedLayout, Group, Header, Panel, PanelHeader, PromoBanner} from \"@vkontakte/vkui\";\r\nimport Icon28ShareExternalOutline from '@vkontakte/icons/dist/28/share_external_outline';\r\nimport Icon28Users3Outline from '@vkontakte/icons/dist/28/users_3_outline';\r\nimport Icon28AddCircleOutline from '@vkontakte/icons/dist/28/add_circle_outline';\r\nimport Icon28ListCheckOutline from '@vkontakte/icons/dist/28/list_check_outline';\r\nimport {SET_ACTIVE_VIEW} from \"../state/actions\";\r\nimport InfoSnackbar from \"../components/InfoSnackbar\";\r\n\r\nexport default ({id, dispatch, bannerData, setBannerData, addToHomeScreenSupported, addedToHomeScreen}) => {\r\n    const [lastClickTime, setLastClickTime] = useState(0);\r\n    const userId = new URL(window.location.href).searchParams.get('vk_user_id');\r\n\r\n    useEffect(() => {\r\n        bridge.send('VKWebAppGetAds', {});\r\n    }, []);\r\n\r\n    return (\r\n        <Panel id={id}>\r\n            <PanelHeader>Ещё</PanelHeader>\r\n            <Group>\r\n                <Cell\r\n                    expandable\r\n                    before={<Icon28ListCheckOutline/>}\r\n                    onClick={() => {\r\n                        dispatch({type: SET_ACTIVE_VIEW, payload: {view: 'more', panel: 'shop-list'}})\r\n                    }}\r\n                >Список покупок</Cell>\r\n            </Group>\r\n            <Group\r\n                header={\r\n                    <Header\r\n                        mode=\"secondary\"\r\n                    >\r\n                        Дополнительно\r\n                    </Header>\r\n                }\r\n            >\r\n                <Cell\r\n                    expandable\r\n                    before={\r\n                        <Icon28ShareExternalOutline/>\r\n                    }\r\n                    onClick={() => {\r\n                        if (+new Date() - lastClickTime > 1000) {\r\n                            bridge.send(\"VKWebAppShare\", {link: `https://vk.com/zlabz_balance#ref=${userId}`})\r\n                            setLastClickTime(+new Date())\r\n                        }\r\n                    }}\r\n                >\r\n                    Поделиться\r\n                </Cell>\r\n                <Cell\r\n                    expandable\r\n                    before={<Icon28Users3Outline/>}\r\n                    onClick={() => {\r\n                        if (+new Date() - lastClickTime > 1000) {\r\n                            bridge.send('VKWebAppJoinGroup', {group_id: 195358095})\r\n                            setLastClickTime(+new Date())\r\n                        }\r\n                    }}\r\n                >\r\n                    Присоединиться к Балансу\r\n                </Cell>\r\n\r\n                {addToHomeScreenSupported && !addedToHomeScreen && <Cell\r\n                    expandable\r\n                    before={<Icon28AddCircleOutline/>}\r\n                    onClick={() => {\r\n                        bridge.send('VKWebAppAddToHomeScreen');\r\n                    }}\r\n                >\r\n                    Добавить на главный экран\r\n                </Cell>}\r\n            </Group>\r\n            {\r\n                userId === process.env.REACT_APP_ID &&\r\n                <Group\r\n                    header={\r\n                        <Header\r\n                            mode={'secondary'}\r\n                        >\r\n                            Admin Mode\r\n                        </Header>\r\n                    }\r\n                >\r\n                    <Cell\r\n                        expandable\r\n                        onClick={() => {\r\n                            dispatch({type: SET_ACTIVE_VIEW, payload: {view: 'more', panel: 'stats'}})\r\n                        }}\r\n                    >\r\n                        Статистика\r\n                    </Cell>\r\n                </Group>\r\n            }\r\n            <FixedLayout vertical={\"bottom\"}>\r\n                <InfoSnackbar/>\r\n                {bannerData && <PromoBanner bannerData={bannerData} onClose={() => setBannerData(null)}/>}\r\n            </FixedLayout>\r\n        </Panel>\r\n    )\r\n}","import React, {useEffect, useReducer, useState} from 'react';\r\nimport {\r\n\tCell,\r\n\tFooter,\r\n\tFormLayout,\r\n\tInput,\r\n\tList,\r\n\tPanel,\r\n\tPanelHeader,\r\n\tPanelHeaderBack,\r\n\tPanelHeaderContent, PanelHeaderContext\r\n} from \"@vkontakte/vkui\";\r\nimport {SET_HISTORY_BACK, SET_MODAL, SET_SUCCESS_MESSAGE, SET_TOGGLE_CONTEXT} from \"../state/actions\";\r\nimport InfoSnackbar from \"../components/InfoSnackbar\";\r\nimport regexp from \"../handlers/regexp\";\r\nimport validate from \"../handlers/validate\";\r\nimport Icon16Dropdown from \"@vkontakte/icons/dist/16/dropdown\";\r\nimport Icon28DeleteOutline from '@vkontakte/icons/dist/28/delete_outline';\r\nimport Icon28DoneOutline from '@vkontakte/icons/dist/28/done_outline';\r\n\r\nconst initialState = {\r\n\tlist: [],\r\n\titem: {\r\n\t\tid: 1,\r\n\t\ttitle: '',\r\n\t\tdone: false\r\n\t},\r\n\tid: null,\r\n\tvalidate: {\r\n\t\ttitle: {}\r\n\t}\r\n}\r\n\r\nconst reducer = (state, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'INITIAL_LIST': {\r\n\t\t\tconst index = action.payload.list[action.payload.list.length - 1] ? action.payload.list[action.payload.list.length - 1].id : 1;\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tlist: action.payload.list,\r\n\t\t\t\titem: {\r\n\t\t\t\t\tid: index + 1,\r\n\t\t\t\t\ttitle: '',\r\n\t\t\t\t\tdone: false\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase 'SET_TITLE': {\r\n\t\t\tconst {payload: {validateForm, title}} = action;\r\n\t\t\tconst item = {\r\n\t\t\t\tid: state.item.id,\r\n\t\t\t\ttitle: title,\r\n\t\t\t\tdone: false\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\titem,\r\n\t\t\t\tvalidate: {...state.validate, ...validateForm}\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase 'SET_ID': {\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tid: action.payload.id\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase 'SET_ITEM_TO_LIST': {\r\n\t\t\tconst newList = [...state.list, state.item];\r\n\t\t\tconst index = newList[newList.length - 1] ? newList[newList.length - 1].id : 1;\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tlist: newList,\r\n\t\t\t\titem: {title: '', done: false, id: index + 1},\r\n\t\t\t\tvalidate: {\r\n\t\t\t\t\ttitle: {}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase 'SET_DONE': {\r\n\t\t\tconst {list} = state;\r\n\t\t\tconst {id} = action.payload;\r\n\t\t\tconst index = list.findIndex((item) => item.id === id);\r\n\t\t\tif (index !== -1) {\r\n\t\t\t\tlist[index].done = !list[index].done;\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tlist\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase 'DELETE_ITEM': {\r\n\t\t\tconst {list} = state;\r\n\t\t\tconst {id} = action.payload;\r\n\t\t\tconst index = list.findIndex((item) => item.id === id);\r\n\t\t\tlist.splice(index, 1);\r\n\t\t\tif (list.length === 0) {\r\n\t\t\t\tlocalStorage.removeItem('shopList');\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tlist\r\n\t\t\t}\r\n\t\t}\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n}\r\n\r\nexport default ({id, dispatch, shopListFromServer, setShopListItemTitle, setShopList, context, success}) => {\r\n\r\n\tconst [state, dispatchList] = useReducer(reducer, initialState);\r\n\tconst [isOpened, setIsOpened] = useState(() => context);\r\n\tconst [deleteMode, setDeleteMode] = useState(false);\r\n\tconst shopList =\r\n\t\tshopListFromServer.length\r\n\t\t\t?\r\n\t\t\tstate.list.map((item) => {\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<Cell\r\n\t\t\t\t\t\tkey={item.id}\r\n\t\t\t\t\t\tselectable={!deleteMode}\r\n\t\t\t\t\t\tremovable={deleteMode}\r\n\t\t\t\t\t\tchecked={item.done}\r\n\t\t\t\t\t\tdisabled={deleteMode ? false : item.done}\r\n\t\t\t\t\t\tonChange={() => {\r\n\t\t\t\t\t\t\tsetShopListItemTitle(shopListFromServer[shopListFromServer.findIndex(i => i.id === item.id)].title);\r\n\t\t\t\t\t\t\tdispatchList({type: 'SET_ID', payload: {id: item.id}});\r\n\t\t\t\t\t\t\tdispatch({type: SET_SUCCESS_MESSAGE, payload: {message: null}});\r\n\t\t\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: 'add-money'}});\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tonRemove={() => {\r\n\t\t\t\t\t\t\tdispatchList({type: 'DELETE_ITEM', payload: {id: item.id}});\r\n\t\t\t\t\t\t\tsetShopList(state.list);\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{item.title}\r\n\t\t\t\t\t</Cell>\r\n\t\t\t\t)\r\n\t\t\t})\r\n\t\t\t:\r\n\t\t\t<Footer>Список покупок пуст</Footer>\r\n\t;\r\n\r\n\tconst toggleContext = () => {\r\n\t\tdispatch({type: SET_TOGGLE_CONTEXT, payload: {context: !isOpened}});\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\t\tsetIsOpened(context);\r\n\t}, [context]);\r\n\r\n\tuseEffect(() => {\r\n\t\tdispatchList({type: 'INITIAL_LIST', payload: {list: shopListFromServer}});\r\n\t}, [shopListFromServer]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (state.list.length === 0) return;\r\n\t\tsetShopList(state.list);\r\n\t}, [state.list, setShopList]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!success) return;\r\n\t\tdispatchList({type: 'SET_DONE', payload: {id: state.id}});\r\n\t}, [success, state.id]);\r\n\r\n\treturn (\r\n\t\t<Panel id={id}>\r\n\t\t\t<PanelHeader\r\n\t\t\t\tleft={\r\n\t\t\t\t\t<PanelHeaderBack onClick={() => {\r\n\t\t\t\t\t\tdispatch({type: SET_HISTORY_BACK});\r\n\t\t\t\t\t}}/>\r\n\t\t\t\t}\r\n\t\t\t>\r\n\t\t\t\t<PanelHeaderContent\r\n\t\t\t\t\taside={<Icon16Dropdown style={{transform: `rotate(${isOpened ? '180deg' : '0'})`}}/>}\r\n\t\t\t\t\tonClick={toggleContext}\r\n\t\t\t\t>\r\n\t\t\t\t\tСписок покупок\r\n\t\t\t\t</PanelHeaderContent>\r\n\t\t\t</PanelHeader>\r\n\t\t\t<PanelHeaderContext opened={isOpened} onClose={toggleContext}>\r\n\t\t\t\t<List>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t!deleteMode\r\n\t\t\t\t\t\t&&\r\n\t\t\t\t\t\t<Cell\r\n\t\t\t\t\t\t\tbefore={<Icon28DeleteOutline />}\r\n\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\ttoggleContext();\r\n\t\t\t\t\t\t\t\tsetDeleteMode(true);\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tРежим удаления\r\n\t\t\t\t\t\t</Cell>\r\n\t\t\t\t\t}\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdeleteMode\r\n\t\t\t\t\t\t&&\r\n\t\t\t\t\t\t\t<Cell\r\n\t\t\t\t\t\t\t\tbefore={<Icon28DoneOutline />}\r\n\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\ttoggleContext();\r\n\t\t\t\t\t\t\t\t\tsetDeleteMode(false);\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tРежим выполнения\r\n\t\t\t\t\t\t\t</Cell>\r\n\t\t\t\t\t}\r\n\t\t\t\t</List>\r\n\t\t\t</PanelHeaderContext>\r\n\t\t\t<FormLayout\r\n\t\t\t\tonSubmit={(e) => {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tdispatchList({type: 'SET_ITEM_TO_LIST'});\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t<Input type={'text'}\r\n\t\t\t\t\t\t\t disabled={deleteMode}\r\n\t\t\t\t\t\t\t placeholder={'Продукт, услуга, товар'}\r\n\t\t\t\t\t\t\t value={state.item.title}\r\n\t\t\t\t\t\t\t top={'Название'}\r\n\t\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t\t maxLength={20}\r\n\t\t\t\t\t\t\t status={state.validate?.title?.status}\r\n\t\t\t\t\t\t\t bottom={state.validate?.title?.message ? state.validate?.title?.message : `${state.item.title.length} из 20`}\r\n\t\t\t\t\t\t\t onChange={(e) => {\r\n\t\t\t\t\t\t\t\t dispatchList({\r\n\t\t\t\t\t\t\t\t\t type: 'SET_TITLE',\r\n\t\t\t\t\t\t\t\t\t payload: {\r\n\t\t\t\t\t\t\t\t\t\t title: regexp(e.currentTarget.value),\r\n\t\t\t\t\t\t\t\t\t\t validateForm: {title: validate(e)}\r\n\t\t\t\t\t\t\t\t\t }\r\n\t\t\t\t\t\t\t\t })\r\n\t\t\t\t\t\t\t }}/>\r\n\t\t\t</FormLayout>\r\n\t\t\t<List>\r\n\t\t\t\t{shopList}\r\n\t\t\t</List>\r\n\t\t\t<InfoSnackbar/>\r\n\t\t</Panel>\r\n\t)\r\n}","import React, {useState} from 'react';\r\nimport {Button, FormLayout, Group, Header, InfoRow, Input, Panel, PanelHeader, SimpleCell} from \"@vkontakte/vkui\";\r\nimport useApi from \"../handlers/useApi\";\r\nimport {format, startOfDay, endOfDay, startOfMonth, endOfMonth} from \"date-fns\";\r\n\r\n/**\r\n * Получение временного периода\r\n * @param ts: Number - timestamp для получения периода\r\n * @param opt {{ts: Boolean, month: Boolean, day: Boolean}}\r\n * @returns {{end: Number | Date, begin: Number | Date}}\r\n */\r\nconst getDateRange = (ts, opt) => {\r\n    const beginDay = !opt.ts ? startOfDay(new Date(ts)) : startOfDay(+new Date(ts));\r\n    const endDay = !opt.ts ? endOfDay(new Date(ts)) : endOfDay(+new Date(ts));\r\n    const beginMonth = !opt.ts ? startOfMonth(new Date(ts)) : startOfMonth(+new Date(ts));\r\n    const endMonth = !opt.ts ? endOfMonth(new Date(ts)) : endOfMonth(+new Date(ts));\r\n\r\n    if (opt.month) {\r\n        return {\r\n            begin: beginMonth,\r\n            end: endMonth\r\n        }\r\n    }\r\n    return {\r\n        begin: beginDay,\r\n        end: endDay\r\n    }\r\n}\r\n\r\nconst getUserAgentArray = (array, userAgent) => {\r\n    return array?.map(item => {\r\n        return item.sessionData.filter(item => {\r\n            return (item.userAgent === userAgent);\r\n        });\r\n    }).flat();\r\n}\r\n\r\nexport default ({id}) => {\r\n    const [ts, setTs] = useState(() => {\r\n        return format(new Date(), 'yyyy-MM-dd');\r\n    });\r\n    const [{response}, doApiFetch] = useApi('/user-session-data-ts');\r\n\r\n    const dateRange = getDateRange(+new Date(ts), {ts: true, day: true, month: false});\r\n    const newUsers = response && response.filter(user => +new Date(user.createdAt) > dateRange.begin && dateRange.end > +new Date(user.createdAt));\r\n    const preparedData = response?.map(item => {\r\n        const filter = item.sessionData.filter(item => {\r\n            return (item.timeStamp > dateRange.begin && item.timeStamp < dateRange.end);\r\n        });\r\n        const newItem = item;\r\n        newItem.sessionData = filter;\r\n        return newItem;\r\n    });\r\n\r\n    const androidUsers = getUserAgentArray(preparedData, 'mobile_android');\r\n    const iphoneUsers = getUserAgentArray(preparedData, 'mobile_iphone');\r\n    const mobileWebUsers = getUserAgentArray(preparedData, 'mobile_web');\r\n    const desktopUsers = getUserAgentArray(preparedData, 'desktop_web');\r\n    const androidMessengerUsers = getUserAgentArray(preparedData, 'mobile_android_messenger');\r\n    const iphoneMessengerUsers = getUserAgentArray(preparedData, 'mobile_iphone_messenger');\r\n\r\n    return (\r\n        <Panel id={id}>\r\n            <PanelHeader>\r\n                Статистика\r\n            </PanelHeader>\r\n            <FormLayout\r\n                onSubmit={(e) => {\r\n                    e.preventDefault();\r\n                    doApiFetch({\r\n                        method: 'GET',\r\n                        params: {\r\n                            ts: +new Date(ts)\r\n                        }\r\n                    })\r\n                }}\r\n            >\r\n                <Input\r\n                    type={'date'}\r\n                    value={ts}\r\n                    onChange={(e) => {\r\n                        setTs(e.currentTarget.value);\r\n                    }}\r\n                />\r\n                <Button>Получить данные</Button>\r\n            </FormLayout>\r\n            <Group>\r\n                <Header mode={'secondary'}>\r\n                    Статистика за {ts}\r\n                </Header>\r\n                <SimpleCell multiline>\r\n                    <InfoRow header={'Новые пользователи за период'}>\r\n                        {newUsers?.length}\r\n                    </InfoRow>\r\n                </SimpleCell>\r\n                <SimpleCell multiline>\r\n                    <InfoRow header={'Пользователей за период'}>\r\n                        {response?.length}\r\n                    </InfoRow>\r\n                </SimpleCell>\r\n                <SimpleCell multiline>\r\n                    <InfoRow header={'Просмотров Android за период'}>\r\n                        {androidUsers?.length}\r\n                    </InfoRow>\r\n                </SimpleCell>\r\n                <SimpleCell multiline>\r\n                    <InfoRow header={'Просмотров Iphone за период'}>\r\n                        {iphoneUsers?.length}\r\n                    </InfoRow>\r\n                </SimpleCell>\r\n                <SimpleCell multiline>\r\n                    <InfoRow header={'Просмотров Desktop за период'}>\r\n                        {desktopUsers?.length}\r\n                    </InfoRow>\r\n                </SimpleCell>\r\n                <SimpleCell multiline>\r\n                    <InfoRow header={'Просмотров Mobile Web за период'}>\r\n                        {mobileWebUsers?.length}\r\n                    </InfoRow>\r\n                </SimpleCell>\r\n                <SimpleCell multiline>\r\n                    <InfoRow header={'Просмотров Android Messenger за период'}>\r\n                        {androidMessengerUsers?.length}\r\n                    </InfoRow>\r\n                </SimpleCell>\r\n                <SimpleCell multiline>\r\n                    <InfoRow header={'Просмотров Iphone Messenger за период'}>\r\n                        {iphoneMessengerUsers?.length}\r\n                    </InfoRow>\r\n                </SimpleCell>\r\n\r\n            </Group>\r\n        </Panel>\r\n    )\r\n}","import React, {useEffect, useReducer} from 'react';\r\nimport useApi from \"../../handlers/useApi\";\r\nimport {Button, FormLayout, Input, Select} from \"@vkontakte/vkui\";\r\nimport validate from \"../../handlers/validate\";\r\nimport AccountsOptionsList from \"../AccountsOptionsList\";\r\nimport {format} from \"date-fns\";\r\nimport currency from \"../../handlers/currency\";\r\nimport regexp from \"../../handlers/regexp\";\r\nimport {SET_ACCOUNTS, SET_BUDGETS} from \"../../state/actions\";\r\n\r\nconst initialState = {\r\n    to: '',\r\n    from: '',\r\n    date: format(new Date(), 'yyyy-MM-dd'),\r\n    title: '',\r\n    price: ''\r\n}\r\n\r\nconst reducer = (state, action) => {\r\n    switch (action.type) {\r\n        case 'CHANGE_STATE':\r\n            const {payload: {validateForm, ...payload}} = action;\r\n            return {\r\n                ...state,\r\n                ...payload,\r\n                validate: {...state.validate, ...validateForm}\r\n            }\r\n        default:\r\n            return state;\r\n    }\r\n}\r\n\r\nexport default ({accounts, dispatch}) => {\r\n    const [{response}, doApiFetch] = useApi('/money-box/transfer');\r\n\r\n    const [state, dispatchForm] = useReducer(reducer, initialState);\r\n\r\n    useEffect(() => {\r\n        if (!response) return;\r\n        dispatch({type: SET_ACCOUNTS, payload: {accounts: response?.accounts ? response?.accounts : []}});\r\n        dispatch({type: SET_BUDGETS, payload: {budgets: response?.budgets ? response?.budgets : []}});\r\n    }, [response, dispatch]);\r\n\r\n    const accountFrom = accounts.find((item) => item._id === state.from);\r\n    const accountsFromList = accounts.filter(item => item._id !== state.to);\r\n    const accountsToList = accounts.filter(item => item._id !== state.from);\r\n\r\n    return (\r\n        <FormLayout\r\n            onSubmit={(e) => {\r\n               e.preventDefault();\r\n               doApiFetch({\r\n                   method: 'POST',\r\n                   date: state.date,\r\n                   title: state.title,\r\n                   to: state.to,\r\n                   from: state.from,\r\n                   price: state.price\r\n               })\r\n            }}\r\n        >\r\n            <Input type={'date'}\r\n                   top={'Дата'}\r\n                   value={state.date}\r\n                   required={true}\r\n                   min={'2015-01-01'}\r\n                   max={format(new Date(), 'yyyy-MM-dd')}\r\n                   onChange={(e) => {\r\n                       dispatchForm({\r\n                           type: 'CHANGE_STATE',\r\n                           payload: {date: e.currentTarget.value, validateForm: {date: validate(e)}}\r\n                       })\r\n                   }}\r\n                   status={state.validate?.date?.status}\r\n                   bottom={state.validate?.date?.message}\r\n            />\r\n\r\n            <Select top={'Счет списания'}\r\n                    placeholder={'Выберите счет'}\r\n                    onChange={(e) => {\r\n                        dispatchForm({\r\n                            type: 'CHANGE_STATE',\r\n                            payload: {from: e.currentTarget.value, validateForm: {from: validate(e)}}\r\n                        })\r\n                    }}\r\n                    defaultValue={state.from} required={true}\r\n                    status={state.validate?.from?.status}\r\n                    bottom={state.validate?.from?.message}\r\n            >\r\n                <AccountsOptionsList accounts={accountsFromList} />\r\n            </Select>\r\n            <Select top={'Счет зачисления'}\r\n                    placeholder={'Выберите счет'}\r\n                    onChange={(e) => {\r\n                        dispatchForm({\r\n                            type: 'CHANGE_STATE',\r\n                            payload: {to: e.currentTarget.value, validateForm: {to: validate(e)}}\r\n                        })\r\n                    }}\r\n                    defaultValue={state.to} required={true}\r\n                    status={state.validate?.to?.status}\r\n                    bottom={state.validate?.to?.message}\r\n            >\r\n                <AccountsOptionsList accounts={accountsToList} />\r\n            </Select>\r\n            <Input type={'text'}\r\n                   placeholder={'Название перевода'}\r\n                   value={state.title}\r\n                   top={'Название'}\r\n                   required={true}\r\n                   maxLength={20}\r\n                   status={state.validate?.title?.status}\r\n                   bottom={state.validate?.title?.message ? state.validate?.title?.message : `${state.title.length} из 20`}\r\n                   onChange={(e) => {\r\n                       dispatchForm({\r\n                           type: 'CHANGE_STATE',\r\n                           payload: {\r\n                               title: regexp(e.currentTarget.value),\r\n                               validateForm: {title: validate(e)}\r\n                           }\r\n                       })\r\n                   }}/>\r\n            <Input type={'number'}\r\n                   placeholder={currency(0)}\r\n                   pattern={'[0-9]+([,\\\\.][0-9]+)?'}\r\n                   top={'Цена'}\r\n                   inputMode=\"decimal\"\r\n                   max={accountFrom?.sum || 99999999}\r\n                   min={0}\r\n                   step={0.0001}\r\n                   status={state.validate?.price?.status}\r\n                   bottom={state.validate?.price?.message}\r\n                   value={state.price}\r\n                   required={true}\r\n                   onChange={(e) => {\r\n                       dispatchForm({\r\n                           type: 'CHANGE_STATE',\r\n                           payload: {price: e.currentTarget.value.replace(/[^\\d.]*/, ''), validateForm: {price: validate(e)}}\r\n                       })\r\n                   }}\r\n            />\r\n            <Button size={'xl'}>\r\n                {`Перевести ${currency(state.price)}`}\r\n            </Button>\r\n        </FormLayout>\r\n    )\r\n}","import React, {useState} from 'react';\r\nimport format from \"date-fns/format\";\r\nimport startOfMonth from 'date-fns/startOfMonth';\r\nimport endOfMonth from 'date-fns/endOfMonth';\r\nimport {FormLayout, Input} from \"@vkontakte/vkui\";\r\n\r\nexport default ({onDateChange, date}) => {\r\n\tconst [startDate, setStartDate] = useState(() => format(startOfMonth(new Date(date)), 'yyyy-MM-dd'));\r\n\tconst [endDate, setEndDate] = useState(() => format(endOfMonth(new Date(date)), 'yyyy-MM-dd'));\r\n\t\r\n\tconst minPeriod = format(startOfMonth(new Date(date)), 'yyyy-MM-dd');\r\n\tconst maxPeriod = format(endOfMonth(new Date(date)), 'yyyy-MM-dd');\r\n\t\r\n\treturn (\r\n\t\t<FormLayout>\r\n\t\t\t<Input type={'date'}\r\n\t\t\t\t\t\t top={'Дата начала периода'}\r\n\t\t\t\t\t\t value={startDate}\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t min={minPeriod}\r\n\t\t\t\t\t\t max={maxPeriod}\r\n\t\t\t\t\t\t onChange={\r\n\t\t\t\t\t\t\t (e) => {\r\n\t\t\t\t\t\t\t\t setStartDate(e.currentTarget.value);\r\n\t\t\t\t\t\t\t\t onDateChange({\r\n\t\t\t\t\t\t\t\t\t startDate: e.currentTarget.value,\r\n\t\t\t\t\t\t\t\t\t endDate\r\n\t\t\t\t\t\t\t\t });\r\n\t\t\t\t\t\t\t }\r\n\t\t\t\t\t\t }\r\n\t\t\t/>\r\n\t\t\t<Input type={'date'}\r\n\t\t\t\t\t\t top={'Дата конца периода'}\r\n\t\t\t\t\t\t value={endDate}\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t min={minPeriod}\r\n\t\t\t\t\t\t max={maxPeriod}\r\n\t\t\t\t\t\t onChange={(e) => {\r\n\t\t\t\t\t\t\t setEndDate(e.currentTarget.value)\r\n\t\t\t\t\t\t\t onDateChange({\r\n\t\t\t\t\t\t\t\t startDate,\r\n\t\t\t\t\t\t\t\t endDate: e.currentTarget.value\r\n\t\t\t\t\t\t\t });\r\n\t\t\t\t\t\t }}\r\n\t\t\t/>\r\n\t\t</FormLayout>\r\n\t)\r\n}","import React, {useState, useEffect} from 'react';\r\nimport {Div, Footer, Panel, PanelHeader, PanelHeaderBack} from \"@vkontakte/vkui\";\r\nimport sort from \"../handlers/sort\";\r\nimport mapRichCell from \"../handlers/mapRichCell\";\r\nimport InfoSnackbar from \"../components/InfoSnackbar\";\r\nimport {SET_HISTORY_BACK} from \"../state/actions\";\r\nimport SearchForm from \"../components/SearchForm\";\r\nimport {ArrayToObjectWithDate, ObjectToArrayWithDate} from \"../handlers/formatingArrayWithDate\";\r\nimport startOfMonth from 'date-fns/startOfMonth';\r\nimport endOfMonth from 'date-fns/endOfMonth';\r\nimport SearchDate from \"../components/SearchDate\";\r\n\r\nexport default ({id, itemsList = [], dispatch, title, showSearch = true, category, currentStateDate}) => {\r\n    const [filteredItems, setFilteredItems] = useState(() => itemsList);\r\n    const [searchStr, setSearchStr] = useState('');\r\n    const [searchDate, setSearchDate] = useState(() => {\r\n      return {\r\n        startDate: startOfMonth(new Date(currentStateDate)),\r\n        endDate: endOfMonth(new Date(currentStateDate))\r\n      }\r\n    });\r\n    const onSearch = (searchStr) => {\r\n        setSearchStr(searchStr);\r\n    }\r\n    const onDateChange = (date) => {\r\n      const {startDate, endDate} = date;\r\n      setSearchDate({\r\n        startDate: new Date(startDate),\r\n        endDate: new Date(endDate)\r\n      });\r\n    }\r\n    \r\n  const indexAr = ArrayToObjectWithDate(filteredItems);\r\n\r\n  const accountItemsListArray = ObjectToArrayWithDate(indexAr);\r\n\r\n    let itemsListView = [];\r\n    if (category === 'tags') {\r\n        itemsListView = accountItemsListArray.sort(sort).map(mapRichCell({dispatch, tagsShow: false}));\r\n    }\r\n    if (category === 'items') {\r\n      itemsListView = accountItemsListArray.sort(sort).map(mapRichCell({dispatch}));\r\n    }\r\n    \r\n    useEffect(() => {\r\n      setFilteredItems(itemsList.filter(({date}) => {\r\n        return (+new Date(date) >= +new Date(searchDate.startDate) && +new Date(date) <= +new Date(searchDate.endDate));\r\n      }))\r\n    }, [searchDate, itemsList])\r\n\r\n    useEffect(() => {\r\n        if (searchStr === '') {\r\n            setFilteredItems(itemsList);\r\n        } else {\r\n            setFilteredItems(itemsList.filter(({title}) => title.toLowerCase().indexOf(searchStr.toLowerCase()) > -1));\r\n        }\r\n    }, [itemsList, searchStr]);\r\n\r\n    return (\r\n        <Panel id={id}>\r\n            <PanelHeader\r\n                left={\r\n                    <PanelHeaderBack onClick={() => {\r\n                        dispatch({type: SET_HISTORY_BACK});\r\n                    }}/>\r\n                }\r\n            >\r\n                {title}\r\n            </PanelHeader>\r\n            {showSearch && <SearchForm onSearch={onSearch}/>}\r\n          {!showSearch && <SearchDate onDateChange={onDateChange} date={currentStateDate}/>}\r\n            <Div>\r\n              {itemsListView}\r\n              {+new Date(searchDate.startDate) > + new Date(searchDate.endDate) && <Footer>Дата начала периода больше даты конца периода.</Footer>}\r\n              {itemsListView.length === 0 && <Footer>Нет данных для отображения</Footer>}\r\n            </Div>\r\n          <InfoSnackbar/>\r\n        </Panel>\r\n    )\r\n}","import React, {useCallback, useContext, useEffect, useState} from 'react';\r\nimport View from '@vkontakte/vkui/dist/components/View/View';\r\nimport '@vkontakte/vkui/dist/vkui.css';\r\nimport Home from './panels/Home';\r\nimport useApi from \"./handlers/useApi\";\r\nimport {State} from './state';\r\nimport {\r\n\tSET_ACCOUNTS,\r\n\tSET_ACTIVE_VIEW,\r\n\tSET_BUDGETS,\r\n\tSET_COLOR_SCHEME,\r\n\tSET_EDITED_ITEM,\r\n\tSET_HISTORY_BACK,\r\n\tSET_MODAL,\r\n\tSET_POPOUT, SET_SUCCESS_MESSAGE\r\n} from \"./state/actions\";\r\nimport {\r\n\tAlert,\r\n\tANDROID,\r\n\tConfigProvider,\r\n\tEpic,\r\n\tIOS,\r\n\tModalPage,\r\n\tModalPageHeader,\r\n\tModalRoot,\r\n\tPanelHeaderButton,\r\n\tplatform,\r\n\tTabbar,\r\n\tTabbarItem\r\n} from \"@vkontakte/vkui\";\r\nimport bridge from \"@vkontakte/vk-bridge\";\r\nimport Icon24Cancel from '@vkontakte/icons/dist/24/cancel';\r\nimport Icon28HomeOutline from '@vkontakte/icons/dist/28/home_outline';\r\nimport Icon28CoinsOutline from '@vkontakte/icons/dist/28/coins_outline';\r\nimport Icon28StatisticsOutline from '@vkontakte/icons/dist/28/statistics_outline';\r\nimport Icon28More from '@vkontakte/icons/dist/28/more';\r\nimport AddAccount from \"./components/modals/AddAccount\";\r\nimport AddMoney from \"./components/modals/AddMoney\";\r\nimport AccountInfo from \"./panels/AccountInfo\";\r\nimport Budgets from \"./panels/Budgets\";\r\nimport AddBudget from \"./components/modals/AddBudget\";\r\nimport BudgetInfo from \"./panels/BudgetInfo\";\r\nimport Stats from \"./panels/Stats\";\r\nimport InitialScreen from \"./panels/InitialScreen\";\r\n\r\nimport './style.css';\r\nimport More from \"./panels/More\";\r\nimport ShopListPanel from \"./panels/ShopListPanel\";\r\nimport useLocalStorage from \"./handlers/useLocalStorage\";\r\nimport AppStats from \"./panels/AppStats\";\r\nimport TransferMoney from \"./components/modals/TransferMoney\";\r\nimport StatsDetails from \"./panels/StatsDetails\";\r\nimport {getTagsListItemsFromAccount} from \"./handlers/getTagsListFromAccounts\";\r\n\r\nconst App = () => {\r\n\tconst os = platform();\r\n\tconst [{response, isLoading}, doApiFetch] = useApi('/state');\r\n\tconst [needFetch, setNeedFetch] = useState(true);\r\n\tconst [state, dispatch] = useContext(State);\r\n\tconst [lastBackAction, setLastBackAction] = useState(0);\r\n\tconst [bannerData, setBannerData] = useState(null);\r\n\tconst [shopListItemTitle, setShopListItemTitle] = useState('');\r\n\tconst [shopList, setShopList] = useLocalStorage('shopList', []);\r\n\tconst [addToHomeScreenSupported, setAddToHomeScreenSupported] = useState(false);\r\n\tconst [addedToHomeScreen, setAddedToHomeScreen] = useState(false);\r\n\tconst [selectedTagTitle, setSelectedTagTitle] = useState('');\r\n\tconst [selectedItemTitle, setSelectedItemTitle] = useState('');\r\n\tconst [tagsItemsList, setTagsItemsList] = useState([]);\r\n\tconst [groupedByStats, setGroupedByStats] = useState('title');\r\n\tconst [itemsFromItemTitle, setItemsFromItemTitle] = useState([]);\r\n\t\r\n\tconst getItemsFromItemTitle = useCallback((accounts) => {\r\n\t\treturn accounts.map(({operations}) => operations).flat().filter(({title, income}) => title === selectedItemTitle && !income);\r\n\t}, [selectedItemTitle]);\r\n\t\r\n\tuseEffect(() => {\r\n\t\tbridge.subscribe(({detail: {type, data}}) => {\r\n\t\t\tif (type === 'VKWebAppUpdateConfig') {\r\n\t\t\t\tdispatch({type: SET_COLOR_SCHEME, payload: {scheme: data.scheme}})\r\n\t\t\t}\r\n\t\t\tif (type === 'VKWebAppGetAdsResult') {\r\n\t\t\t\tsetBannerData(data);\r\n\t\t\t}\r\n\t\t\tif (type === 'VKWebAppAddToHomeScreenInfoResult') {\r\n\t\t\t\tsetAddToHomeScreenSupported(data.is_feature_supported);\r\n\t\t\t\tsetAddedToHomeScreen(data.is_added_to_home_screen);\r\n\t\t\t}\r\n\t\t\tif (type === 'VKWebAppAddToHomeScreenResult') {\r\n\t\t\t\tif (data.result) {\r\n\t\t\t\t\tsetAddedToHomeScreen(data.result);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (type === 'VKWebAppJoinGroupResult') {\r\n\t\t\t\tif (data.result) {\r\n\t\t\t\t\tdispatch({type: SET_SUCCESS_MESSAGE, payload: {message: 'Спасибо, что Вы с нами ❤️'}})\r\n\t\t\t\t}\r\n\t\t\t\t// console.log(data);\r\n\t\t\t}\r\n\t\t\tif (type === 'VKWebAppJoinGroupFailed') {\r\n\t\t\t\t// console.log(data);\r\n\t\t\t}\r\n\t\t});\r\n\r\n// Init VK  Mini App\r\n\t\tbridge.send(\"VKWebAppInit\", {});\r\n\t\t// Native ads on Android/IOS\r\n\t\t// bridge.send(\"VKWebAppShowNativeAds\", {ad_format:\"preloader\"})\r\n\t\t// \t.then(data => console.log(data.result))\r\n\t\t// \t.catch(error => console.log(error));\r\n\t\tbridge.send('VKWebAppGetAds', {});\r\n\t\tbridge.send('VKWebAppAddToHomeScreenInfo');\r\n\t}, [dispatch]);\r\n\t\r\n\tuseEffect(() => {\r\n\t\tconst tagsListItem = getTagsListItemsFromAccount(state.accounts);\r\n\t\tsetTagsItemsList(tagsListItem[selectedTagTitle]);\r\n\t}, [state.accounts, selectedTagTitle]);\r\n\t\r\n\tuseEffect(() => {\r\n\t\tif (!selectedItemTitle) return;\r\n\t\tsetItemsFromItemTitle(getItemsFromItemTitle(state.accounts));\r\n\t}, [selectedItemTitle, state.accounts, getItemsFromItemTitle]);\r\n\t\r\n\tconst alert = (\r\n\t\t<Alert\r\n\t\t\tactions={[\r\n\t\t\t\t{\r\n\t\t\t\t\ttitle: 'Отмена',\r\n\t\t\t\t\tautoclose: true,\r\n\t\t\t\t\tmode: \"cancel\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttitle: 'Выйти',\r\n\t\t\t\t\tmode: 'destructive',\r\n\t\t\t\t\tautoclose: true,\r\n\t\t\t\t\taction: async () => {\r\n\t\t\t\t\t\tawait bridge.send('VKWebAppClose', {status: 'success'});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]}\r\n\t\t\tonClose={() => {\r\n\t\t\t\tdispatch({type: SET_POPOUT, payload: {popout: null}})\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<h2>Выйти из приложения?</h2>\r\n\t\t\t<p>Вы действительно хотите выйти?</p>\r\n\t\t</Alert>\r\n\t)\r\n\t\r\n\tuseEffect(() => {\r\n\t\tif (!needFetch) return;\r\n\t\tdoApiFetch({\r\n\t\t\tparams: {\r\n\t\t\t\tdate: new Date(state.currentDate)\r\n\t\t\t}\r\n\t\t});\r\n\t\tsetNeedFetch(false);\r\n\t}, [needFetch, doApiFetch, state.currentDate]);\r\n\t\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tdispatch({type: SET_ACCOUNTS, payload: {accounts: response?.accounts ? response?.accounts : []}});\r\n\t\tdispatch({type: SET_BUDGETS, payload: {budgets: response?.budgets ? response?.budgets : []}});\r\n\t}, [response, dispatch]);\r\n\t\r\n\tuseEffect(() => {\r\n\t\t\twindow.onpopstate = () => {\r\n\t\t\t\tlet timeNow = +new Date();\r\n\t\t\t\tif (state.canClose) {\r\n\t\t\t\t\tdispatch({type: SET_POPOUT, payload: {popout: alert, alert: true}});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (timeNow - lastBackAction > 500) {\r\n\t\t\t\t\t\tsetLastBackAction(timeNow);\r\n\t\t\t\t\t\tdispatch({type: SET_HISTORY_BACK});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\twindow.history.pushState(null, null);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, [dispatch, state.history, state.modal, lastBackAction, state.canClose, alert]\r\n\t);\r\n\t\r\n\tconst onRefresh = useCallback(() => {\r\n\t\tsetNeedFetch(true);\r\n\t}, []);\r\n\t\r\n\tconst modalBack = (() => {\r\n\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: null}});\r\n\t\tdispatch({type: SET_MODAL, payload: {modal: null}});\r\n\t\tsetShopListItemTitle('');\r\n\t})\r\n\t\r\n\tconst modal = (\r\n\t\t<ModalRoot\r\n\t\t\tactiveModal={state.modal}\r\n\t\t\tonClose={modalBack}\r\n\t\t>\r\n\t\t\t<ModalPage id={'add-account'} header={\r\n\t\t\t\t<ModalPageHeader\r\n\t\t\t\t\tleft={os === ANDROID && <PanelHeaderButton onClick={modalBack}><Icon24Cancel/></PanelHeaderButton>}\r\n\t\t\t\t\tright={<PanelHeaderButton onClick={modalBack}>{os === IOS ? 'Закрыть' : null}</PanelHeaderButton>}\r\n\t\t\t\t>\r\n\t\t\t\t\tДобавить счет\r\n\t\t\t\t</ModalPageHeader>\r\n\t\t\t}>\r\n\t\t\t\t<AddAccount dispatch={dispatch} editedItem={state.editedItem}/>\r\n\t\t\t</ModalPage>\r\n\t\t\t\r\n\t\t\t<ModalPage id={'add-money'} header={\r\n\t\t\t\t<ModalPageHeader\r\n\t\t\t\t\tleft={os === ANDROID && <PanelHeaderButton onClick={modalBack}><Icon24Cancel/></PanelHeaderButton>}\r\n\t\t\t\t\tright={<PanelHeaderButton onClick={modalBack}>{os === IOS ? 'Закрыть' : null}</PanelHeaderButton>}\r\n\t\t\t\t>\r\n\t\t\t\t\t{state.editedItem ? 'Редактировать' : 'Добавить запись'}\r\n\t\t\t\t</ModalPageHeader>\r\n\t\t\t}>\r\n\t\t\t\t<AddMoney accounts={state.accounts} id={state.account?._id}\r\n\t\t\t\t          editedItem={state.editedItem} dispatch={dispatch} budget={state.budget}\r\n\t\t\t\t          panel={state.activePanel}\r\n\t\t\t\t          shopListItemTitle={shopListItemTitle} setShopListItemTitle={setShopListItemTitle}\r\n\t\t\t\t          date={state.currentDate}/>\r\n\t\t\t</ModalPage>\r\n\t\t\t\r\n\t\t\t<ModalPage id={'add-budget'} header={\r\n\t\t\t\t<ModalPageHeader\r\n\t\t\t\t\tleft={os === ANDROID && <PanelHeaderButton onClick={modalBack}><Icon24Cancel/></PanelHeaderButton>}\r\n\t\t\t\t\tright={<PanelHeaderButton onClick={modalBack}>{os === IOS ? 'Закрыть' : null}</PanelHeaderButton>}\r\n\t\t\t\t>\r\n\t\t\t\t\t{state.editedItem ? 'Редактировать' : 'Добавить бюджет'}\r\n\t\t\t\t</ModalPageHeader>\r\n\t\t\t}>\r\n\t\t\t\t<AddBudget editedItem={state.editedItem} dispatch={dispatch} date={state.currentDate}/>\r\n\t\t\t</ModalPage>\r\n\t\t\t<ModalPage id={'transfer-money'} header={\r\n\t\t\t\t<ModalPageHeader\r\n\t\t\t\t\tleft={os === ANDROID && <PanelHeaderButton onClick={modalBack}><Icon24Cancel/></PanelHeaderButton>}\r\n\t\t\t\t\tright={<PanelHeaderButton onClick={modalBack}>{os === IOS ? 'Закрыть' : null}</PanelHeaderButton>}\r\n\t\t\t\t>\r\n\t\t\t\t\tПеревести\r\n\t\t\t\t</ModalPageHeader>\r\n\t\t\t}>\r\n\t\t\t\t<TransferMoney accounts={state.accounts} dispatch={dispatch}/>\r\n\t\t\t</ModalPage>\r\n\t\t</ModalRoot>\r\n\t)\r\n\t\r\n\tconst onStoryChange = (e) => {\r\n\t\tdispatch({\r\n\t\t\ttype: SET_ACTIVE_VIEW,\r\n\t\t\tpayload: {view: e.currentTarget.dataset.story, panel: e.currentTarget.dataset.panel}\r\n\t\t})\r\n\t}\r\n\t\r\n\tconst tabBar = (\r\n\t\t<Tabbar itemsLayout={'horizontal'}>\r\n\t\t\t<TabbarItem\r\n\t\t\t\tonClick={onStoryChange}\r\n\t\t\t\tselected={state.activeView === 'home'}\r\n\t\t\t\tdata-story={'home'}\r\n\t\t\t\tdata-panel={'home'}\r\n\t\t\t\ttext={'Баланс'}\r\n\t\t\t>\r\n\t\t\t\t<Icon28HomeOutline/>\r\n\t\t\t</TabbarItem>\r\n\t\t\t<TabbarItem\r\n\t\t\t\tonClick={onStoryChange}\r\n\t\t\t\tselected={state.activeView === 'info' && (state.activePanel === 'budgets' || state.activePanel === 'budget')}\r\n\t\t\t\tdata-story={'info'}\r\n\t\t\t\tdata-panel={'budgets'}\r\n\t\t\t\ttext={'Бюджеты'}\r\n\t\t\t>\r\n\t\t\t\t<Icon28CoinsOutline/>\r\n\t\t\t</TabbarItem>\r\n\t\t\t<TabbarItem\r\n\t\t\t\tonClick={onStoryChange}\r\n\t\t\t\tselected={state.activeView === 'stats'}\r\n\t\t\t\tdata-story={'stats'}\r\n\t\t\t\tdata-panel={'stats'}\r\n\t\t\t\ttext={'Сводка'}\r\n\t\t\t>\r\n\t\t\t\t<Icon28StatisticsOutline/>\r\n\t\t\t</TabbarItem>\r\n\t\t\t<TabbarItem\r\n\t\t\t\tonClick={onStoryChange}\r\n\t\t\t\tselected={state.activeView === 'more'}\r\n\t\t\t\tdata-story={'more'}\r\n\t\t\t\tdata-panel={'index'}\r\n\t\t\t\ttext={'Ещё'}\r\n\t\t\t>\r\n\t\t\t\t<Icon28More/>\r\n\t\t\t</TabbarItem>\r\n\t\t</Tabbar>\r\n\t)\r\n\t\r\n\treturn (\r\n\t\t<ConfigProvider scheme={state.scheme}>\r\n\t\t\t<Epic activeStory={state.activeView}\r\n\t\t\t      tabbar={state.activeView !== 'init' && state.activePanel !== 'init' && tabBar}>\r\n\t\t\t\t<View id={'init'} activePanel={state.activePanel}>\r\n\t\t\t\t\t<InitialScreen id={'init'} dispatch={dispatch} loading={state.popout} bannerData={bannerData}\r\n\t\t\t\t\t               setBannerData={setBannerData}/>\r\n\t\t\t\t</View>\r\n\t\t\t\t<View id={'home'} activePanel={state.activePanel} popout={state.popout} modal={modal}>\r\n\t\t\t\t\t<Home id='home' accounts={state.accounts} budgets={state.budgets} dispatch={dispatch}\r\n\t\t\t\t\t      isLoading={isLoading} context={state.contextHistory}\r\n\t\t\t\t\t      onRefresh={onRefresh} isFetching={isLoading} shopList={shopList}/>\r\n\t\t\t\t</View>\r\n\t\t\t\t<View id={'info'} activePanel={state.activePanel} popout={state.popout} modal={modal}>\r\n\t\t\t\t\t<AccountInfo id={'account'} account={state.accounts.find(item => item._id === state.account?._id)}\r\n\t\t\t\t\t             dispatch={dispatch} onRefresh={onRefresh} context={state.contextHistory}\r\n\t\t\t\t\t             date={state.currentDate} scheme={state.scheme}/>\r\n\t\t\t\t\t<Budgets id={'budgets'} budgets={state.budgets} dispatch={dispatch} onRefresh={onRefresh}\r\n\t\t\t\t\t         date={state.currentDate} bannerData={bannerData}\r\n\t\t\t\t\t         setBannerData={setBannerData}/>\r\n\t\t\t\t\t<BudgetInfo id={'budget'} budget={state.budgets.find(item => item._id === state.budget?._id)}\r\n\t\t\t\t\t            dispatch={dispatch} context={state.contextHistory} date={state.currentDate}/>\r\n\t\t\t\t</View>\r\n\t\t\t\t<View id={'stats'} activePanel={state.activePanel} popout={state.popout} modal={modal}>\r\n\t\t\t\t\t<Stats id={'stats'} accounts={state.accounts} onRefresh={onRefresh} dispatch={dispatch}\r\n\t\t\t\t\t       context={state.contextHistory} setSelectedTagTitle={setSelectedTagTitle}\r\n\t\t\t\t\t       groupedByStats={groupedByStats} setGroupedByStats={setGroupedByStats}\r\n\t\t\t\t\t       setSelectedItemTitle={setSelectedItemTitle}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<StatsDetails id={'details-tags'} category={'tags'} itemsList={tagsItemsList} dispatch={dispatch}\r\n\t\t\t\t\t              title={selectedTagTitle} showSearch={true}/>\r\n\t\t\t\t\t<StatsDetails id={'details-items'} category={'items'} itemsList={itemsFromItemTitle}\r\n\t\t\t\t\t              dispatch={dispatch} title={selectedItemTitle} showSearch={false} currentStateDate={state.currentDate}/>\r\n\t\t\t\t</View>\r\n\t\t\t\t<View id={'more'} activePanel={state.activePanel} popout={state.popout} modal={modal}>\r\n\t\t\t\t\t<More id={'index'} dispatch={dispatch} addToHomeScreenSupported={addToHomeScreenSupported}\r\n\t\t\t\t\t      addedToHomeScreen={addedToHomeScreen} bannerData={bannerData}\r\n\t\t\t\t\t      setBannerData={setBannerData}/>\r\n\t\t\t\t\t<ShopListPanel id={'shop-list'} dispatch={dispatch} shopListFromServer={shopList}\r\n\t\t\t\t\t               setShopListItemTitle={setShopListItemTitle}\r\n\t\t\t\t\t               setShopList={setShopList} context={state.contextHistory}\r\n\t\t\t\t\t               success={state.successMessage} error={state.error}/>\r\n\t\t\t\t\t<AppStats id={'stats'}/>\r\n\t\t\t\t</View>\r\n\t\t\t</Epic>\r\n\t\t</ConfigProvider>\r\n\t);\r\n}\r\n\r\nexport default App;\r\n\r\n","import { useState } from 'react';\r\n\r\nexport default (key, initialValue) => {\r\n\t// State to store our value\r\n\t// Pass initial state function to useState so logic is only executed once\r\n\tconst [storedValue, setStoredValue] = useState(() => {\r\n\t\ttry {\r\n\t\t\t// Get from local storage by key\r\n\t\t\tconst item = window.localStorage.getItem(key);\r\n\t\t\t// Parse stored json or if none return initialValue\r\n\t\t\treturn item ? JSON.parse(item) : initialValue;\r\n\t\t} catch (error) {\r\n\t\t\t// If error also return initialValue\r\n\t\t\tconsole.log(error);\r\n\t\t\treturn initialValue;\r\n\t\t}\r\n\t});\r\n\r\n\t// Return a wrapped version of useState's setter function that ...\r\n\t// ... persists the new value to localStorage.\r\n\tconst setValue = value => {\r\n\t\ttry {\r\n\t\t\t// Allow value to be a function so we have same API as useState\r\n\t\t\tconst valueToStore =\r\n\t\t\t\tvalue instanceof Function ? value(storedValue) : value;\r\n\t\t\t// Save state\r\n\t\t\tsetStoredValue(valueToStore);\r\n\t\t\t// Save to local storage\r\n\t\t\twindow.localStorage.setItem(key, JSON.stringify(valueToStore));\r\n\t\t} catch (error) {\r\n\t\t\t// A more advanced implementation would handle the error case\r\n\t\t\tconsole.log(error);\r\n\t\t}\r\n\t};\r\n\r\n\treturn [storedValue, setValue];\r\n}","import \"core-js/features/map\";\r\nimport \"core-js/features/set\";\r\nimport 'array-flat-polyfill';\r\nimport React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport App from \"./App\";\r\nimport {StateProvider} from \"./state\";\r\n\r\nReactDOM.render(\r\n  <StateProvider>\r\n    <App />\r\n  </StateProvider>, document.getElementById(\"root\"));\r\nif (new URL(window.location.href).searchParams.get('vk_user_id') === process.env.REACT_APP_ID.toString()) {\r\n  import(\"./eruda\").then(() => {}); //runtime download\r\n}\r\n\r\n// console.log(new URL(window.location.href).searchParams.get('vk_user_id'));\r\n//import(\"./eruda\").then(({ default: eruda }) => {}); //runtime download\r\n"],"sourceRoot":""}