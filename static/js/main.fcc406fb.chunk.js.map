{"version":3,"sources":["handlers/currency.js","components/ListOfItems.js","state/actions.js","state/index.js","components/InfoSnackbar.js","components/MonthSwitch.js","panels/Home.js","handlers/useApi.js","handlers/validate.js","components/modals/AddAccount.js","components/modals/AddMoney.js","handlers/mapRichCell.js","handlers/sort.js","handlers/reduce.js","panels/AccountInfo.js","panels/Budgets.js","components/modals/AddBudget.js","panels/BudgetInfo.js","panels/Stats.js","handlers/mapStats.js","App.js","index.js"],"names":["number","Intl","NumberFormat","style","currency","format","data","showAll","dispatch","itemsName","needHide","useState","isShow","setIsShow","length","list","sort","a","b","sum","map","account","index","key","indicator","expandable","data-id","_id","onClick","e","type","payload","id","currentTarget","dataset","view","panel","title","weight","marginBottom","push","initialState","accounts","budgets","budget","modal","successMessage","error","activeView","activePanel","popout","editedItem","currentDate","Date","history","reducer","state","action","window","pushState","location","search","backEl","historyState","newHistory","pop","accountId","find","item","budgetId","message","date","State","createContext","StateProvider","children","value","useReducer","Provider","InfoSnackbar","useContext","snackbar","setSnackbar","useEffect","onClose","before","color","onRefresh","disabled","subMonths","mode","asideContent","addMonths","textAlign","fontWeight","locale","ru","toLocaleUpperCase","Home","isFetching","sumOfAll","el","reduce","acc","cur","left","MonthSwitch","header","separator","level","ListOfItems","url","isLoading","setLoading","response","setResponse","setError","options","setOptions","doApiFetch","useCallback","method","params","bodyFields","axiosOptions","baseURL","process","headers","queryString","parse","axios","then","catch","Error","fetchData","validity","valid","status","badInput","tooLong","typeMismatch","rangeOverflow","titleValidation","sumValidation","stateForm","dispatchForm","useApi","onSubmit","preventDefault","placeholder","top","required","maxLength","bottom","onChange","validate","max","step","size","income","description","price","quantity","tags","validateForm","apiStr","accountList","tag","marginRight","itemFrom","defaultValue","name","defaultChecked","join","toLowerCase","split","display","mapRichCell","console","log","titleDate","replace","getFullYear","getMonth","getDate","caps","ruLocale","multiline","caption","after","aDate","bDate","compareAsc","prev","curr","isEqual","isOpened","setIsOpened","operations","items","setItems","filteredItems","setFilteredItems","accountItemsList","toggleContext","alert","actions","autoclose","aside","transform","opened","str","filter","indexOf","budgetsStartSum","startSum","budgetsSum","deletedCount","alertDelete","itemsList","flat","localeCompare","setOperations","prevItem","array","slice","data-title","App","os","platform","needFetch","setNeedFetch","onpopstate","modalBack","activeModal","ANDROID","right","IOS","AddAccount","AddMoney","AddBudget","onStoryChange","story","tabBar","selected","data-story","data-panel","text","activeStory","tabbar","AccountInfo","BudgetInfo","Budgets","Stats","bridge","subscribe","detail","schemeAttribute","document","createAttribute","scheme","body","attributes","setNamedItem","send","ReactDOM","render","getElementById","default"],"mappings":"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","file":"static/js/main.fcc406fb.chunk.js","sourcesContent":["export default (number) => {\r\n\treturn new Intl.NumberFormat('ru-RU', {style: 'currency', currency: 'RUB'}).format(number);\r\n}","import React, {useState} from 'react';\r\nimport Cell from \"@vkontakte/vkui/dist/components/Cell/Cell\";\r\nimport {Footer, Text} from \"@vkontakte/vkui\";\r\nimport currency from \"../handlers/currency\";\r\nimport {SET_ACCOUNT, SET_ACTIVE_VIEW, SET_BUDGET} from \"../state/actions\";\r\n\r\nexport default ({data, showAll = false, dispatch, itemsName, needHide = true}) => {\r\n\tconst [isShow, setIsShow] = useState(() => {\r\n\t\treturn showAll;\r\n\t});\r\n\r\n\tif (data.length === 0) {\r\n\t\tif (itemsName === 'accounts') {\r\n\t\t\treturn <Footer>Нет счетов для отображения</Footer>\r\n\t\t}\r\n\t\tif (itemsName === 'budgets') {\r\n\t\t\treturn <Footer>Нет бюджетов для отображения</Footer>\r\n\t\t}\r\n\t}\r\n\r\n\tlet list = data\r\n\t\t.sort((a, b) => {\r\n\t\t\treturn b.sum - a.sum;\r\n\t\t})\r\n\t\t.map((account, index) => {\r\n\t\t\tif (index === 3 && !isShow) {\r\n\t\t\t\treturn <Cell\r\n\t\t\t\t\tkey={index}\r\n\t\t\t\t\texpandable\r\n\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\tsetIsShow(true);\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Text weight=\"semibold\" style={{marginBottom: 16}}>\r\n\t\t\t\t\t\tПоказать все\r\n\t\t\t\t\t</Text>\r\n\t\t\t\t</Cell>\r\n\t\t\t}\r\n\t\t\tif (index > 3 && !isShow) {\r\n\t\t\t\treturn null\r\n\t\t\t}\r\n\t\t\treturn <Cell\r\n\t\t\t\tkey={index}\r\n\t\t\t\tindicator={currency(account.sum)}\r\n\t\t\t\texpandable\r\n\t\t\t\tdata-id={account._id}\r\n\t\t\t\tonClick={async (e) => {\r\n\t\t\t\t\tif (itemsName === 'accounts') {\r\n\t\t\t\t\t\tawait dispatch({type: SET_ACCOUNT, payload: {id: e.currentTarget.dataset.id}});\r\n\t\t\t\t\t\tawait dispatch({type: SET_ACTIVE_VIEW, payload: {view: 'info', panel: 'account'}});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (itemsName === 'budgets') {\r\n\t\t\t\t\t\tawait dispatch({type: SET_BUDGET, payload: {id: e.currentTarget.dataset.id}});\r\n\t\t\t\t\t\tawait dispatch({type: SET_ACTIVE_VIEW, payload: {view: 'info', panel: 'budget'}});\r\n\t\t\t\t\t}\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t{account.title}\r\n\t\t\t</Cell>\r\n\t\t});\r\n\tif (needHide) {\r\n\t\tif (isShow) list.push(<Cell\r\n\t\t\tkey={data.length}\r\n\t\t\texpandable\r\n\t\t\tonClick={() => {\r\n\t\t\t\tsetIsShow(false);\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<Text weight=\"semibold\" style={{marginBottom: 16}}>\r\n\t\t\t\t{itemsName === 'accounts' ? 'Скрыть счета' : 'Скрыть бюджеты'}\r\n\t\t\t</Text>\r\n\t\t</Cell>);\r\n\t}\r\n\r\n\r\n\treturn list;\r\n}","export const SET_ACCOUNTS = 'SET_ACCOUNTS';\r\nexport const SET_BUDGETS = 'SET_BUDGETS';\r\nexport const SET_BUDGET = 'SET_BUDGET';\r\nexport const SET_MODAL = 'SET_MODAL';\r\nexport const SET_ERROR = 'SET_ERROR';\r\nexport const SET_SUCCESS_MESSAGE = 'SET_SUCCESS_MESSAGE';\r\nexport const SET_ACTIVE_VIEW = 'SET_ACTIVE_VIEW';\r\nexport const SET_ACTIVE_PANEL= 'SET_ACTIVE_PANEL';\r\nexport const SET_ACCOUNT = 'SET_ACCOUNT';\r\nexport const SET_POPOUT = 'SET_POPOUT';\r\nexport const SET_EDITED_ITEM = 'SET_EDITED_ITEM';\r\nexport const SET_DATE = 'SET_DATE';\r\nexport const SET_HISTORY_BACK = 'SET_HISTORY_BACK';","import React, {createContext, useReducer} from 'react';\r\nimport {\r\n\tSET_ACCOUNT,\r\n\tSET_ACCOUNTS,\r\n\tSET_ACTIVE_PANEL,\r\n\tSET_ACTIVE_VIEW,\r\n\tSET_BUDGET,\r\n\tSET_BUDGETS, SET_DATE,\r\n\tSET_EDITED_ITEM,\r\n\tSET_ERROR, SET_HISTORY_BACK,\r\n\tSET_MODAL,\r\n\tSET_POPOUT,\r\n\tSET_SUCCESS_MESSAGE\r\n} from './actions';\r\n\r\nconst initialState = {\r\n\taccounts: [],\r\n\tbudgets: [],\r\n\taccount: null,\r\n\tbudget: null,\r\n\tmodal: null,\r\n\tsuccessMessage: null,\r\n\terror: null,\r\n\tactiveView: 'home',\r\n\tactivePanel: 'home',\r\n\tpopout: null,\r\n\teditedItem: null,\r\n\tcurrentDate: new Date(),\r\n\thistory: []\r\n}\r\n\r\nconst reducer = (state, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase SET_ACTIVE_VIEW: {\r\n\t\t\twindow.history.pushState({activeView: action.payload.view, activePanel: action.payload.panel}, `${action.payload.panel}.${action.payload.panel}`, window.location.search);\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tactiveView: action.payload.view,\r\n\t\t\t\tactivePanel: action.payload.panel,\r\n\t\t\t\thistory: [...state.history, {activeView: action.payload.view, activePanel: action.payload.panel}]\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_ACTIVE_PANEL: {\r\n\t\t\twindow.history.pushState({activeView: state.activeView, activePanel: action.payload.panel}, `${state.activeView}.${action.payload.panel}`, window.location.search);\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tactivePanel: action.payload.panel,\r\n\t\t\t\thistory: [...state.history, {activeView: state.activeView, activePanel: action.payload.panel}]\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_HISTORY_BACK: {\r\n\t\t\tconst backEl = state.history[state.history.length-2];\r\n\t\t\tconst historyState = action.payload?.state;\r\n\t\t\tif (historyState) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...state,\r\n\t\t\t\t\tactiveView: historyState.activeView,\r\n\t\t\t\t\tactivePanel: historyState.activePanel,\r\n\t\t\t\t\thistory: [{activeView: historyState.activeView, activePanel: historyState.activePanel}]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!backEl) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...state,\r\n\t\t\t\t\tactiveView: 'home',\r\n\t\t\t\t\tactivePanel: 'home',\r\n\t\t\t\t\thistory: [{activeView: 'home', activePanel: 'home'}]\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst newHistory = state.history;\r\n\t\t\t\tnewHistory.pop();\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...state,\r\n\t\t\t\t\tactiveView: backEl.activeView,\r\n\t\t\t\t\tactivePanel: backEl.activePanel,\r\n\t\t\t\t\thistory: [...newHistory]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_ACCOUNTS: {\r\n\t\t\tconst accountId = state.account?._id;\r\n\t\t\tconst account = !accountId ? accountId : action.payload.accounts.find(item => {\r\n\t\t\t\treturn item._id === accountId;\r\n\t\t\t})\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\taccounts: action.payload.accounts,\r\n\t\t\t\taccount: account\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_BUDGETS: {\r\n\t\t\tconst budgetId = state.budget?._id;\r\n\t\t\tconst budget = !budgetId ? budgetId : action.payload.budgets.find(item => item._id === budgetId)\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tbudgets: action.payload.budgets,\r\n\t\t\t\tbudget: budget\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_ACCOUNT: {\r\n\t\t\tconst {payload: {id}} = action;\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\taccount: state.accounts.find(item => {\r\n\t\t\t\t\treturn item._id === id;\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_BUDGET: {\r\n\t\t\tconst {payload: {id}} = action;\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tbudget: !id ? id : state.budgets.find(item => item._id === id)\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_EDITED_ITEM: {\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\teditedItem: action.payload.item\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_POPOUT: {\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tpopout: action.payload.popout\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_MODAL: {\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tmodal: action.payload.modal\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_SUCCESS_MESSAGE: {\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tsuccessMessage: action.payload.message\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_ERROR: {\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\terror: action.payload.error\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase SET_DATE: {\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tcurrentDate: new Date(action.payload.date)\r\n\t\t\t}\r\n\t\t}\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n}\r\n\r\nexport const State = createContext();\r\n\r\nexport const StateProvider = ({children}) => {\r\n\tconst value = useReducer(reducer, initialState);\r\n\treturn (\r\n\t\t<State.Provider value={value}>\r\n\t\t\t{children}\r\n\t\t</State.Provider>\r\n\t)\r\n}","import React, {useContext, useEffect, useState} from 'react';\r\nimport {Snackbar} from \"@vkontakte/vkui\";\r\nimport {State} from \"../state\";\r\nimport {SET_ERROR, SET_SUCCESS_MESSAGE} from \"../state/actions\";\r\nimport Icon24ErrorCircle from '@vkontakte/icons/dist/24/error_circle';\r\nimport Icon24CheckCircleOn from '@vkontakte/icons/dist/24/check_circle_on';\r\n\r\nconst InfoSnackbar = () => {\r\n\tconst [state, dispatch] = useContext(State);\r\n\tconst [snackbar, setSnackbar] = useState(null);\r\n\tuseEffect(() => {\r\n\t\tif (!state.error) return;\r\n\t\tsetSnackbar(<Snackbar\r\n\t\t\tonClose={\r\n\t\t\t\t() => {\r\n\t\t\t\t\tdispatch({type: SET_ERROR, payload: {error: null}});\r\n\t\t\t\t\tsetSnackbar(null);\r\n\t\t\t\t}}\r\n\t\t\tbefore={<Icon24ErrorCircle style={{color: 'var(--destructive)'}}/>}\r\n\t\t>\r\n\t\t\t{state.error.message}\r\n\t\t</Snackbar>)\r\n\t}, [setSnackbar, dispatch, state.error]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!state.successMessage) return;\r\n\t\tsetSnackbar(<Snackbar\r\n\t\t\tonClose={\r\n\t\t\t\t() => {\r\n\t\t\t\t\tdispatch({type: SET_SUCCESS_MESSAGE, payload: {message: null}});\r\n\t\t\t\t\tsetSnackbar(null);\r\n\t\t\t\t}}\r\n\t\t\tbefore={<Icon24CheckCircleOn style={{color: 'var(--accent)'}}/>}\r\n\t\t>\r\n\t\t\t{state.successMessage}\r\n\t\t</Snackbar>)\r\n\t}, [setSnackbar, dispatch, state.successMessage]);\r\n\treturn (\r\n\t\t<>\r\n\t\t\t{snackbar}\r\n\t\t</>\r\n\t)\r\n}\r\n\r\nexport default InfoSnackbar;","import React, {useContext} from 'react';\r\nimport {addMonths, format, subMonths} from 'date-fns';\r\nimport {ru} from 'date-fns/locale';\r\nimport Icon24BrowserBack from '@vkontakte/icons/dist/24/browser_back';\r\nimport Icon24BrowserForward from '@vkontakte/icons/dist/24/browser_forward';\r\nimport {State} from \"../state\";\r\nimport {Button, Cell, Group} from \"@vkontakte/vkui\";\r\n\r\nexport default ({onRefresh}) => {\r\n\tconst [state, dispatch] = useContext(State);\r\n\tconst dateFormat = 'LLLL yyyy';\r\n\tconst disabled = format(new Date(), 'yyyy.M') >= format(state.currentDate, 'yyyy.M');\r\n\r\n\tconst nextMonth = () => {\r\n\t\tdispatch({type: 'SET_DATE', payload: {date: (addMonths(state.currentDate, 1))}});\r\n\t\tonRefresh();\r\n\t};\r\n\r\n\tconst prevMonth = () => {\r\n\t\tdispatch({type: 'SET_DATE', payload: {date: (subMonths(state.currentDate, 1))}});\r\n\t\tonRefresh();\r\n\t};\r\n\r\n\treturn (\r\n\t\t<Group>\r\n\t\t\t<Cell\r\n\t\t\t\tbefore={<Button onClick={prevMonth} mode={'secondary'}><Icon24BrowserBack/></Button>}\r\n\t\t\t\tasideContent={<Button disabled={disabled} onClick={nextMonth}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmode={'secondary'}><Icon24BrowserForward/></Button>}\r\n\t\t\t\tstyle={{textAlign: 'center', fontWeight: 'bold'}}\r\n\t\t\t>\r\n\t\t\t\t{format(state.currentDate, dateFormat, {locale: ru}).toLocaleUpperCase()}\r\n\t\t\t</Cell>\r\n\t\t</Group>\r\n\t)\r\n}","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Panel from '@vkontakte/vkui/dist/components/Panel/Panel';\r\nimport PanelHeader from '@vkontakte/vkui/dist/components/PanelHeader/PanelHeader';\r\nimport Group from '@vkontakte/vkui/dist/components/Group/Group';\r\nimport Div from '@vkontakte/vkui/dist/components/Div/Div';\r\nimport {Header, List, PanelHeaderButton, PullToRefresh, Title} from \"@vkontakte/vkui\";\r\nimport currency from \"../handlers/currency\";\r\nimport ListOfItems from \"../components/ListOfItems\";\r\nimport {SET_ACCOUNT, SET_MODAL} from \"../state/actions\";\r\nimport Icon28MarketAddBadgeOutline from '@vkontakte/icons/dist/28/market_add_badge_outline';\r\nimport Icon28ListAddOutline from '@vkontakte/icons/dist/28/list_add_outline';\r\nimport InfoSnackbar from \"../components/InfoSnackbar\";\r\nimport MonthSwitch from \"../components/MonthSwitch\";\r\n\r\nconst Home = ({id, accounts, budgets, dispatch, onRefresh, isFetching}) => {\r\n\tconst sumOfAll = accounts.map(el => el.sum).reduce((acc, cur) => acc + cur, 0);\r\n\treturn (\r\n\t\t<Panel id={id}>\r\n\t\t\t<PanelHeader\r\n\t\t\t\tleft={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<PanelHeaderButton\r\n\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: 'add-account'}});\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<Icon28ListAddOutline/>\r\n\t\t\t\t\t\t</PanelHeaderButton>\r\n\t\t\t\t\t\t{accounts.length !== 0 && <PanelHeaderButton\r\n\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\tdispatch({type: SET_ACCOUNT, payload: {id: null}});\r\n\t\t\t\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: 'add-money'}});\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<Icon28MarketAddBadgeOutline/>\r\n\t\t\t\t\t\t</PanelHeaderButton>}\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t>Balance</PanelHeader>\r\n\t\t\t<MonthSwitch onRefresh={onRefresh} />\r\n\t\t\t<PullToRefresh onRefresh={onRefresh} isFetching={isFetching}>\r\n\t\t\t\t<List>\r\n\t\t\t\t\t<Group\r\n\t\t\t\t\t\theader={<Header mode=\"secondary\">Ваши счета</Header>}\r\n\t\t\t\t\t\tseparator=\"show\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Div>\r\n\t\t\t\t\t\t\t<Title level=\"1\" weight=\"semibold\" style={{marginBottom: 16}}>{currency(sumOfAll)}</Title>\r\n\t\t\t\t\t\t\t<ListOfItems data={accounts} dispatch={dispatch} showAll={false} itemsName={'accounts'}/>\r\n\t\t\t\t\t\t</Div>\r\n\t\t\t\t\t</Group>\r\n\t\t\t\t\t<Group\r\n\t\t\t\t\t\theader={<Header mode={'secondary'}>Ваши бюджеты</Header>}\r\n\t\t\t\t\t\tseparator={'show'}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Div>\r\n\t\t\t\t\t\t\t<ListOfItems data={budgets} dispatch={dispatch} showAll={false} itemsName={'budgets'}/>\r\n\t\t\t\t\t\t</Div>\r\n\t\t\t\t\t</Group>\r\n\t\t\t\t</List>\r\n\t\t\t</PullToRefresh>\r\n\t\t\t<InfoSnackbar/>\r\n\t\t</Panel>\r\n\t)\r\n};\r\n\r\nHome.propTypes = {\r\n\tid: PropTypes.string.isRequired,\r\n};\r\n\r\nexport default Home;\r\n","import React, {useState, useEffect, useCallback, useContext} from 'react';\r\nimport queryString from 'query-string';\r\nimport axios from 'axios';\r\nimport {SET_ERROR, SET_MODAL, SET_POPOUT, SET_SUCCESS_MESSAGE} from \"../state/actions\";\r\nimport {State} from \"../state\";\r\nimport {PopoutWrapper, ScreenSpinner} from \"@vkontakte/vkui\";\r\n\r\nexport default url => {\r\n\tconst [isLoading, setLoading] = useState(false);\r\n\tconst [response, setResponse] = useState(null);\r\n\tconst [error, setError] = useState(null);\r\n\tconst [options, setOptions] = useState({});\r\n\tconst [, dispatch] = useContext(State);\r\n\r\n\tconst apiBase = process.env.NODE_ENV !== 'development' ? process.env.REACT_APP_BASEURL : process.env.REACT_APP_BASEURL_DEV;\r\n\r\n\tconst doApiFetch = useCallback((options = {}) => {\r\n\t\tsetOptions(options);\r\n\t\tsetResponse(null);\r\n\t\tsetError(null);\r\n\t\tsetLoading(true);\r\n\t\tdispatch({type: SET_POPOUT, payload: {popout: (<PopoutWrapper><ScreenSpinner /></PopoutWrapper>)}});\r\n\t}, [dispatch]);\r\n\r\n\tconst {method = 'GET', params, ...bodyFields} = options;\r\n\tconst headers = {\r\n\t\t'Content-Type': 'application/json',\r\n\t}\r\n\tconst axiosOptions = {\r\n\t\tmethod: method,\r\n\t\tbaseURL: apiBase,\r\n\t\turl,\r\n\t\theaders,\r\n\t\tparams: params ? {...params, ...queryString.parse(window.location.search)} : {...queryString.parse(window.location.search)},\r\n\t\tdata: method !== 'GET' ? bodyFields : null,\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\r\n\t\tif (!isLoading) return;\r\n\r\n\t\tconst fetchData = async () => {\r\n\t\t\tsetLoading(false);\r\n\t\t\treturn await axios(axiosOptions)\r\n\t\t\t\t.then(async (response) => {\r\n\t\t\t\t\tsetResponse(response.data.data);\r\n\t\t\t\t\tdispatch({type: SET_POPOUT, payload: {popout: null}});\r\n\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: null}});\r\n\t\t\t\t\tdispatch({type: SET_SUCCESS_MESSAGE, payload: {message: response.data.message}});\r\n\t\t\t\t})\r\n\t\t\t\t.catch((error) => {\r\n\t\t\t\t\tlet e = error?.response ? error.response.data.error : new Error('Проблемы с подключением к API');\r\n\t\t\t\t\tsetError(e);\r\n\t\t\t\t\tsetLoading(false);\r\n\t\t\t\t\tdispatch({type: SET_POPOUT, payload: {popout: null}});\r\n\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: null}});\r\n\t\t\t\t\tdispatch({type: SET_ERROR, payload: {error: e}});\r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t\tfetchData();\r\n\r\n\t}, [isLoading, axiosOptions, dispatch]);\r\n\treturn [{isLoading, response, error}, doApiFetch];\r\n}","export default (e) => {\r\n\tconst validity = e.currentTarget.validity;\r\n\tif (validity.valid) {\r\n\t\treturn {status: 'valid', message: null}\r\n\t} else {\r\n\t\tif (validity.badInput) {\r\n\t\t\treturn {status: 'error', message: 'Неверный формат ввода'}\r\n\t\t}\r\n\t\tif (validity.tooLong) {\r\n\t\t\treturn {status: 'error', message: 'Превышена максимальная длина'}\r\n\t\t}\r\n\t\tif (validity.typeMismatch) {\r\n\t\t\treturn {status: 'error', message: 'Несоответствие типа'}\r\n\t\t}\r\n\t\tif (validity.rangeOverflow) {\r\n\t\t\treturn {status: 'error', message: 'Слишком большое число'}\r\n\t\t}\r\n\t\treturn {status: 'default', message: null}\r\n\t}\r\n}","import React, {useEffect, useReducer} from 'react';\r\nimport {Button, FormLayout, Input} from \"@vkontakte/vkui\";\r\nimport currency from \"../../handlers/currency\";\r\nimport useApi from \"../../handlers/useApi\";\r\nimport validate from \"../../handlers/validate\";\r\n\r\nconst initialState = {\r\n\ttitle: '',\r\n\tsum: '',\r\n\ttitleValidation: {},\r\n\tsumValidation: {}\r\n}\r\n\r\nconst reducer = (state, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'CHANGE_STATE':\r\n\t\t\tconst {payload} = action;\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\t...payload\r\n\t\t\t}\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n}\r\n\r\nexport default ({onRefresh}) => {\r\n\tconst [stateForm, dispatchForm] = useReducer(reducer, initialState);\r\n\tconst [{response}, doApiFetch] = useApi('/money-box');\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tonRefresh();\r\n\t}, [response, onRefresh]);\r\n\r\n\treturn (\r\n\t\t<FormLayout\r\n\t\t\tonSubmit={async e => {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tawait doApiFetch({\r\n\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\ttitle: stateForm.title,\r\n\t\t\t\t\tsum: stateForm.sum\r\n\t\t\t\t});\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<Input type={'text'} placeholder={'Карта, наличные, счет в банке'} top={'Название'} value={stateForm.title}\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t maxLength={'20'}\r\n\t\t\t\t\t\t status={stateForm.titleValidation.status}\r\n\t\t\t\t\t\t bottom={stateForm.titleValidation.message ? stateForm.titleValidation.message : `${stateForm.title.length} из 20`}\r\n\t\t\t\t\t\t onChange={e => dispatchForm({type: 'CHANGE_STATE', payload: {title: e.currentTarget.value, titleValidation: validate(e)}})}/>\r\n\t\t\t<Input type={'number'} placeholder={currency(0)} top={'Остаток в рублях'} value={stateForm.sum}\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t status={stateForm.sumValidation.status}\r\n\t\t\t\t\t\t max={999999999}\r\n\t\t\t\t\t\t step={0.01}\r\n\t\t\t\t\t\t bottom={stateForm.sumValidation.message ? stateForm.sumValidation.message : 'Денежные средства, находящиеся на счете в данный момент'}\r\n\t\t\t\t\t\t onChange={e => dispatchForm({type: 'CHANGE_STATE', payload: {sum: e.currentTarget.value, sumValidation: validate(e)}})}/>\r\n\t\t\t<Button size={'xl'}>Сохранить</Button>\r\n\t\t</FormLayout>\r\n\t)\r\n}","import React, {useEffect, useReducer, useState} from 'react';\r\nimport {format} from 'date-fns';\r\nimport {Button, Counter, Div, FormLayout, Input, Radio, Select, Textarea} from \"@vkontakte/vkui\";\r\nimport currency from \"../../handlers/currency\";\r\nimport useApi from \"../../handlers/useApi\";\r\nimport validate from \"../../handlers/validate\";\r\n\r\nconst initialState = {\r\n\taccount: '',\r\n\ttitle: '',\r\n\tdate: format(new Date(), 'yyyy-MM-dd'),\r\n\tincome: false,\r\n\tdescription: '',\r\n\tprice: '',\r\n\tquantity: '',\r\n\ttags: [],\r\n\tvalidate: {\r\n\t\taccount: {},\r\n\t\ttitle: {},\r\n\t\tdescription: {},\r\n\t\tprice: {},\r\n\t\tquantity: {},\r\n\t\ttags: {},\r\n\t}\r\n}\r\n\r\nconst reducer = (state, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'CHANGE_STATE':\r\n\t\t\tconst {payload: {validateForm, ...payload}} = action;\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\t...payload,\r\n\t\t\t\tvalidate: {...state.validate, ...validateForm}\r\n\t\t\t}\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n}\r\n\r\nexport default ({accounts, id = null, editedItem = null, onRefresh}) => {\r\n\tconst [apiStr] = useState(() => {\r\n\t\treturn !editedItem ? '/item' : `/item/${editedItem._id}`;\r\n\t})\r\n\tconst [{response}, doApiFetch] = useApi(apiStr);\r\n\tconst [state, dispatch] = useReducer(reducer, initialState);\r\n\tconst accountList = accounts.map(item => {\r\n\t\treturn (<option key={item._id} value={item._id}>{item.title} ({currency(item.sum)})</option>)\r\n\t});\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!editedItem) return;\r\n\t\teditedItem.date = format(new Date(editedItem.date), 'yyyy-MM-dd');\r\n\t\tdispatch({type: 'CHANGE_STATE', payload: {...editedItem}});\r\n\t}, [editedItem, dispatch]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tonRefresh();\r\n\t}, [response, onRefresh]);\r\n\r\n\tconst tags = state.tags.map((tag, index) => <Counter style={{marginRight: '5px'}} key={index}>{tag}</Counter>);\r\n\r\n\treturn (\r\n\t\t<FormLayout\r\n\t\t\tonSubmit={e => {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tdoApiFetch({\r\n\t\t\t\t\tmethod: !editedItem ? 'POST' : 'PATCH',\r\n\t\t\t\t\tdate: state.date,\r\n\t\t\t\t\ttitle: state.title,\r\n\t\t\t\t\tdescription: state.description,\r\n\t\t\t\t\tprice: state.price,\r\n\t\t\t\t\tquantity: state.quantity,\r\n\t\t\t\t\tincome: state.income,\r\n\t\t\t\t\ttags: state.tags,\r\n\t\t\t\t\titemFrom: state.account || id\r\n\t\t\t\t});\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<Select top={'Счет'}\r\n\t\t\t\t\t\t\tplaceholder={'Выберите счет'}\r\n\t\t\t\t\t\t\tonChange={(e) => {\r\n\t\t\t\t\t\t\t\tdispatch({\r\n\t\t\t\t\t\t\t\t\ttype: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t\t\tpayload: {account: e.currentTarget.value, validateForm: {account: validate(e)}}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\tdefaultValue={editedItem?.itemFrom || id || state.account} required={true}\r\n\t\t\t\t\t\t\tstatus={state.validate?.account?.status}\r\n\t\t\t\t\t\t\tbottom={state.validate?.account?.message}\r\n\t\t\t>\r\n\t\t\t\t{accountList}\r\n\t\t\t</Select>\r\n\t\t\t<Input type={'date'}\r\n\t\t\t\t\t\t top={'Дата'}\r\n\t\t\t\t\t\t value={state.date}\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t onChange={(e) => {\r\n\t\t\t\t\t\t\t dispatch({type: 'CHANGE_STATE', payload: {date: e.currentTarget.value}})\r\n\t\t\t\t\t\t }}\r\n\t\t\t/>\r\n\t\t\t<Input type={'text'}\r\n\t\t\t\t\t\t placeholder={'Продукт, услуга, товар'}\r\n\t\t\t\t\t\t value={state.title}\r\n\t\t\t\t\t\t top={'Название'}\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t maxLength={20}\r\n\t\t\t\t\t\t status={state.validate?.title?.status}\r\n\t\t\t\t\t\t bottom={state.validate?.title?.message ? state.validate?.title?.message : `${state.title.length} из 20`}\r\n\t\t\t\t\t\t onChange={(e) => {\r\n\t\t\t\t\t\t\t dispatch({\r\n\t\t\t\t\t\t\t\t type: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t\t payload: {title: e.currentTarget.value, validateForm: {title: validate(e)}}\r\n\t\t\t\t\t\t\t })\r\n\t\t\t\t\t\t }}/>\r\n\t\t\t<Radio name={'income'}\r\n\t\t\t\t\t\t value={false}\r\n\t\t\t\t\t\t defaultChecked={state.income ? null : true}\r\n\t\t\t\t\t\t onClick={() => {\r\n\t\t\t\t\t\t\t dispatch({type: 'CHANGE_STATE', payload: {income: false}})\r\n\t\t\t\t\t\t }}\r\n\t\t\t>\r\n\t\t\t\tРасход\r\n\t\t\t</Radio>\r\n\t\t\t<Radio name={'income'}\r\n\t\t\t\t\t\t value={true}\r\n\t\t\t\t\t\t defaultChecked={state.income ? true : null}\r\n\t\t\t\t\t\t onClick={() => {\r\n\t\t\t\t\t\t\t dispatch({type: 'CHANGE_STATE', payload: {income: true}})\r\n\t\t\t\t\t\t }}\r\n\t\t\t>\r\n\t\t\t\tДоход\r\n\t\t\t</Radio>\r\n\t\t\t{\r\n\t\t\t\t!state.income\r\n\t\t\t\t&&\r\n\t\t\t\t<Textarea top={'Описание'}\r\n\t\t\t\t\t\t\t\t\tplaceholder={'Описание товара(продукта, услуги)'}\r\n\t\t\t\t\t\t\t\t\tvalue={state.description}\r\n\t\t\t\t\t\t\t\t\tmaxLength={70}\r\n\t\t\t\t\t\t\t\t\tstatus={state.validate?.description?.status}\r\n\t\t\t\t\t\t\t\t\tbottom={state.validate?.description?.message ? state.validate?.description?.message : `${state.description.length} из 70`}\r\n\t\t\t\t\t\t\t\t\tonChange={(e) => {\r\n\t\t\t\t\t\t\t\t\t\tdispatch({\r\n\t\t\t\t\t\t\t\t\t\t\ttype: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t\t\t\t\tpayload: {\r\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: e.currentTarget.value,\r\n\t\t\t\t\t\t\t\t\t\t\t\tvalidateForm: {description: validate(e)}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t/>\r\n\t\t\t}\r\n\t\t\t<Input type={'text'}\r\n\t\t\t\t\t\t top={'Тэги'}\r\n\t\t\t\t\t\t value={state.tags.join(' ')}\r\n\t\t\t\t\t\t placeholder={'Тэги через пробел'}\r\n\t\t\t\t\t\t status={state.validate?.tags?.status}\r\n\t\t\t\t\t\t maxLength={100}\r\n\t\t\t\t\t\t bottom={state.validate?.tags?.message ? state.validate?.tags?.message : `${state.tags.length} из 100`}\r\n\t\t\t\t\t\t onChange={(e) => {\r\n\t\t\t\t\t\t\t dispatch({\r\n\t\t\t\t\t\t\t\t type: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t\t payload: {tags: e.currentTarget.value.toLowerCase().split(' '), validateForm: {tags: validate(e)}}\r\n\t\t\t\t\t\t\t })\r\n\t\t\t\t\t\t }}\r\n\t\t\t/>\r\n\t\t\t{\r\n\t\t\t\tstate.tags.length !== 0\r\n\t\t\t\t&&\r\n\t\t\t\t<Div style={{display: 'flex'}}>\r\n\t\t\t\t\t{tags}\r\n\t\t\t\t</Div>\r\n\t\t\t}\r\n\t\t\t<Input type={'number'}\r\n\t\t\t\t\t\t placeholder={currency(0)}\r\n\t\t\t\t\t\t top={'Цена'}\r\n\t\t\t\t\t\t max={99999999}\r\n\t\t\t\t\t\t step={0.01}\r\n\t\t\t\t\t\t status={state.validate?.price?.status}\r\n\t\t\t\t\t\t bottom={state.validate?.price?.message}\r\n\t\t\t\t\t\t value={state.price}\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t onChange={(e) => {\r\n\t\t\t\t\t\t\t dispatch({\r\n\t\t\t\t\t\t\t\t type: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t\t payload: {price: e.currentTarget.value, validateForm: {price: validate(e)}}\r\n\t\t\t\t\t\t\t })\r\n\t\t\t\t\t\t }}\r\n\t\t\t/>\r\n\t\t\t<Input type={'number'}\r\n\t\t\t\t\t\t placeholder={'0'}\r\n\t\t\t\t\t\t top={'Кол-во'}\r\n\t\t\t\t\t\t max={9999999}\r\n\t\t\t\t\t\t step={0.01}\r\n\t\t\t\t\t\t status={state.validate?.quantity?.status}\r\n\t\t\t\t\t\t bottom={state.validate?.quantity?.message}\r\n\t\t\t\t\t\t value={state.quantity}\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t onChange={(e) => {\r\n\t\t\t\t\t\t\t dispatch({\r\n\t\t\t\t\t\t\t\t type: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t\t payload: {quantity: e.currentTarget.value, validateForm: {quantity: validate(e)}}\r\n\t\t\t\t\t\t\t })\r\n\t\t\t\t\t\t }}\r\n\t\t\t/>\r\n\t\t\t<Button size={'xl'}>\r\n\t\t\t\tСохранить\r\n\t\t\t</Button>\r\n\t\t</FormLayout>\r\n\t)\r\n}","import React from 'react';\r\nimport {Caption, RichCell} from \"@vkontakte/vkui\";\r\nimport {format} from \"date-fns\";\r\nimport ruLocale from \"date-fns/locale/ru\";\r\nimport currency from \"./currency\";\r\nimport {SET_EDITED_ITEM, SET_MODAL} from \"../state/actions\";\r\n\r\nexport default function mapRichCell(dispatch) {\r\n\treturn (item, index) => {\r\n\t\tconsole.log(item);\r\n\t\tconsole.log('date1', new Date(item?.titleDate.replace(/[.]/g, '-')).getFullYear(), new Date(item?.titleDate.replace(/[.]/g, '-')).getMonth(), new Date(item?.titleDate.replace(/[.]/g, '-')).getDate() );\r\n\t\tif (item?.titleDate) {\r\n\t\t\tconsole.log(item?.titleDate.replace(/[.]/g, '-'))\r\n\t\t\treturn (\r\n\t\t\t\t<Caption level=\"2\" weight=\"semibold\" caps\r\n\t\t\t\t\t\t\t\t key={index}>{format(new Date(item?.titleDate.replace(/[.]/g, '-')), 'dd MMMM yyyy', {locale: ruLocale})}</Caption>\r\n\t\t\t)\r\n\t\t}\r\n\t\treturn (\r\n\t\t\t<RichCell\r\n\t\t\t\tkey={index}\r\n\t\t\t\tmultiline\r\n\t\t\t\tcaption={format(new Date(item?.date.replace(/[.]/g, '-')), 'dd MMMM yyyy', {locale: ruLocale})}\r\n\t\t\t\tafter={item?.income ? currency(item?.sum) : currency(-1 * item?.sum)}\r\n\t\t\t\tdata-id={item?._id}\r\n\t\t\t\tonClick={() => {\r\n\t\t\t\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: item}});\r\n\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: 'add-money'}});\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t{item?.title}\r\n\t\t\t</RichCell>\r\n\t\t)\r\n\t};\r\n}","import compareAsc from \"date-fns/compareAsc\";\r\n\r\nexport default function (a, b){\r\n\tconst aDate = new Date(a.date);\r\n\tconst bDate = new Date(b.date);\r\n\treturn compareAsc(bDate, aDate);\r\n}","import isEqual from \"date-fns/isEqual\";\r\n\r\nexport default function (prev, curr) {\r\n\tif (isEqual(new Date(prev[prev.length-1]?.date), new Date(curr.date))) {\r\n\t\treturn [...prev, curr];\r\n\t} else {\r\n\t\treturn [...prev, {titleDate: curr.date}, curr];\r\n\t}\r\n}","import React, {useEffect, useState} from 'react';\r\nimport useApi from \"../handlers/useApi\";\r\nimport {\r\n\tAlert,\r\n\tCell,\r\n\tDiv,\r\n\tFooter,\r\n\tHeader,\r\n\tList,\r\n\tPanel,\r\n\tPanelHeader,\r\n\tPanelHeaderBack,\r\n\tPanelHeaderButton,\r\n\tPanelHeaderContent,\r\n\tPanelHeaderContext,\r\n\tSearch,\r\n\tTitle\r\n} from \"@vkontakte/vkui\";\r\nimport currency from \"../handlers/currency\";\r\nimport Group from \"@vkontakte/vkui/dist/components/Group/Group\";\r\nimport {SET_ACTIVE_VIEW, SET_EDITED_ITEM, SET_HISTORY_BACK, SET_MODAL, SET_POPOUT} from \"../state/actions\";\r\nimport Icon28MarketAddBadgeOutline from \"@vkontakte/icons/dist/28/market_add_badge_outline\";\r\nimport Icon16Dropdown from '@vkontakte/icons/dist/16/dropdown';\r\n\r\nimport Icon28DeleteOutline from '@vkontakte/icons/dist/28/delete_outline';\r\nimport mapRichCell from \"../handlers/mapRichCell\";\r\nimport InfoSnackbar from \"../components/InfoSnackbar\";\r\nimport sort from \"../handlers/sort\";\r\nimport reduce from \"../handlers/reduce\";\r\nimport MonthSwitch from \"../components/MonthSwitch\";\r\n\r\nexport default ({id, account, dispatch, onRefresh}) => {\r\n\tconst [isOpened, setIsOpened] = useState(false);\r\n\tconst [{response}, doApiFetch] = useApi(`/money-box/${account?._id}`);\r\n\tconst [items, setItems] = useState(() => account?.operations);\r\n\tconst [filteredItems, setFilteredItems] = useState(() => items);\r\n\r\n\t//console.log('filteredItems', filteredItems.sort(sort).reduce(reduce, []))\r\n\tconst accountItemsList = filteredItems.sort(sort).reduce(reduce, []).map(mapRichCell(dispatch));\r\n\t// const accountItemsList = filteredItems.sort(sort).map(mapRichCell(dispatch));\r\n\r\n\tconst toggleContext = () => {\r\n\t\tsetIsOpened(!isOpened);\r\n\t}\r\n\tconst alert = (\r\n\t\t<Alert\r\n\t\t\tactions={[\r\n\t\t\t\t{\r\n\t\t\t\t\ttitle: 'Отмена',\r\n\t\t\t\t\tautoclose: true,\r\n\t\t\t\t\tmode: \"cancel\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttitle: 'Удалить',\r\n\t\t\t\t\tautoclose: true,\r\n\t\t\t\t\taction: async () => {\r\n\t\t\t\t\t\ttoggleContext();\r\n\t\t\t\t\t\tawait doApiFetch({\r\n\t\t\t\t\t\t\tmethod: 'DELETE'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]}\r\n\t\t\tonClose={() => {\r\n\t\t\t\ttoggleContext();\r\n\t\t\t\tdispatch({type: SET_POPOUT, payload: {popout: null}})\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<h2>Удалить счет?</h2>\r\n\t\t\t<p>Удаление счета приведет к удалению всех данных по доходам и расходам, привязанным к данному счету. Суммы\r\n\t\t\t\tбюджетов могут отображаться некоректно.</p>\r\n\t\t</Alert>\r\n\t)\r\n\r\n\tuseEffect(() => {\r\n\t\tsetItems(account?.operations);\r\n\t\tsetFilteredItems(account?.operations);\r\n\t}, [account]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tdispatch({type: SET_ACTIVE_VIEW, payload: {view: 'home', panel: 'home'}});\r\n\t\t// dispatch({type: SET_HISTORY_BACK});\r\n\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: null}});\r\n\t\tonRefresh();\r\n\t}, [dispatch, response, onRefresh]);\r\n\r\n\tconst onSearch = (str) => {\r\n\t\tif (str === '') {\r\n\t\t\tsetFilteredItems(items);\r\n\t\t} else {\r\n\t\t\tsetFilteredItems(account?.operations.filter(({title}) => title.toLowerCase().indexOf(str.toLowerCase()) > -1));\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Panel id={id}>\r\n\t\t\t<PanelHeader left={\r\n\t\t\t\t<>\r\n\t\t\t\t\t<PanelHeaderBack onClick={() => {\r\n\t\t\t\t\t\t// dispatch({type: SET_ACTIVE_VIEW, payload: {view: 'home', panel: 'home'}});\r\n\t\t\t\t\t\tdispatch({type: SET_HISTORY_BACK})\r\n\t\t\t\t\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: null}});\r\n\t\t\t\t\t}}/>\r\n\t\t\t\t\t<PanelHeaderButton\r\n\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: null}});\r\n\t\t\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: 'add-money'}});\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Icon28MarketAddBadgeOutline/>\r\n\t\t\t\t\t</PanelHeaderButton>\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\t\t\t>\r\n\t\t\t\t<PanelHeaderContent\r\n\t\t\t\t\taside={<Icon16Dropdown style={{transform: `rotate(${isOpened ? '180deg' : '0'})`}}/>}\r\n\t\t\t\t\tonClick={toggleContext}\r\n\t\t\t\t>\r\n\t\t\t\t\t{account?.title}\r\n\t\t\t\t</PanelHeaderContent>\r\n\t\t\t</PanelHeader>\r\n\t\t\t<PanelHeaderContext opened={isOpened} onClose={toggleContext}>\r\n\t\t\t\t<List>\r\n\t\t\t\t\t<Cell\r\n\t\t\t\t\t\tbefore={<Icon28DeleteOutline/>}\r\n\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\tdispatch({type: SET_POPOUT, payload: {popout: alert}})\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\tУдалить счет {account?.title}\r\n\t\t\t\t\t</Cell>\r\n\t\t\t\t</List>\r\n\t\t\t</PanelHeaderContext>\r\n\t\t\t<MonthSwitch onRefresh={onRefresh} />\r\n\t\t\t<Search onChange={(e) => {\r\n\t\t\t\tonSearch(e.currentTarget.value)\r\n\t\t\t}}/>\r\n\t\t\t<Group\r\n\t\t\t\theader={<Header mode=\"secondary\">Информация по счету</Header>}\r\n\t\t\t\tseparator=\"show\"\r\n\t\t\t>\r\n\t\t\t\t<Div>\r\n\t\t\t\t\t<Title level=\"1\" weight=\"semibold\" style={{marginBottom: 16}}>{currency(account?.sum)}</Title>\r\n\t\t\t\t</Div>\r\n\r\n\t\t\t\t{account?.operations.length === 0 && <Footer>Операций по счету еще не было</Footer>}\r\n\t\t\t\t<Div>\r\n\t\t\t\t\t{accountItemsList}\r\n\t\t\t\t\t{accountItemsList.length === 0 && <Footer>Нет данных для отображения</Footer>}\r\n\t\t\t\t</Div>\r\n\t\t\t</Group>\r\n\t\t\t<InfoSnackbar/>\r\n\t\t</Panel>\r\n\t)\r\n}","import React from 'react';\r\nimport {format} from 'date-fns';\r\nimport ruLocale from 'date-fns/locale/ru';\r\nimport {Footer, Group, Header, Panel, PanelHeader, PanelHeaderButton} from \"@vkontakte/vkui\";\r\nimport ListOfItems from \"../components/ListOfItems\";\r\nimport {SET_MODAL} from \"../state/actions\";\r\nimport Icon28ListAddOutline from \"@vkontakte/icons/dist/28/list_add_outline\";\r\nimport currency from \"../handlers/currency\";\r\nimport InfoSnackbar from \"../components/InfoSnackbar\";\r\nimport MonthSwitch from \"../components/MonthSwitch\";\r\n\r\nexport default ({id, budgets, dispatch, date = new Date(), onRefresh}) => {\r\n\tconst budgetsStartSum = budgets.map(el => el.startSum).reduce((acc, cur) => acc + cur, 0);\r\n\tconst budgetsSum = budgets.map(el => el.sum).reduce((acc, cur) => acc + cur, 0);\r\n\treturn (\r\n\t\t<Panel id={id}>\r\n\t\t\t<PanelHeader\r\n\t\t\t\tleft={\r\n\t\t\t\t\t<PanelHeaderButton onClick={() => dispatch({type: SET_MODAL, payload: {modal: 'add-budget'}})}>\r\n\t\t\t\t\t\t<Icon28ListAddOutline/>\r\n\t\t\t\t\t</PanelHeaderButton>\r\n\t\t\t\t}\r\n\t\t\t>\r\n\t\t\t\tБюджеты\r\n\t\t\t</PanelHeader>\r\n\t\t\t<MonthSwitch onRefresh={onRefresh} />\r\n\t\t\t<Group\r\n\t\t\t\theader={<Header mode=\"secondary\">Ваши бюджеты\r\n\t\t\t\t\tна {format(new Date(date), 'MMM yyyy', {locale: ruLocale})}</Header>}\r\n\t\t\t\tseparator=\"show\"\r\n\t\t\t>\r\n\t\t\t\t<ListOfItems data={budgets} dispatch={dispatch} showAll={true} itemsName={'budgets'} needHide={false}/>\r\n\t\t\t\t<Footer>Осталось {currency(budgetsSum)} из {currency(budgetsStartSum)}</Footer>\r\n\t\t\t</Group>\r\n\t\t\t<InfoSnackbar/>\r\n\t\t</Panel>\r\n\t)\r\n}","import React, {useEffect, useReducer, useState} from 'react';\r\nimport {Button, FormLayout, Input} from \"@vkontakte/vkui\";\r\nimport useApi from \"../../handlers/useApi\";\r\nimport validate from \"../../handlers/validate\";\r\nimport currency from \"../../handlers/currency\";\r\n\r\nconst initialState = {\r\n\ttitle: '',\r\n\tstartSum: '',\r\n\tvalidate: {\r\n\t\ttitle: {},\r\n\t\tstartSum: {}\r\n\t}\r\n}\r\n\r\nconst reducer = (state, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'CHANGE_STATE':\r\n\t\t\tconst {payload: {validateForm, ...payload}} = action;\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\t...payload,\r\n\t\t\t\tvalidate: {...state.validate, ...validateForm}\r\n\t\t\t}\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n}\r\n\r\nexport default ({onRefresh, editedItem = null}) => {\r\n\tconst [stateForm, dispatchForm] = useReducer(reducer, initialState);\r\n\tconst [apiStr] = useState(() => {\r\n\t\treturn !editedItem ? '/budget' : `/budget/${editedItem._id}`;\r\n\t})\r\n\tconst [{response}, doApiFetch] = useApi(apiStr);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!editedItem) return;\r\n\t\tif (!response) dispatchForm({type: 'CHANGE_STATE', payload: {...editedItem}});\r\n\t}, [editedItem, dispatchForm, response]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tonRefresh();\r\n\t}, [onRefresh, response]);\r\n\r\n\treturn (\r\n\t\t<FormLayout\r\n\t\t\tonSubmit={async e => {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tawait doApiFetch({\r\n\t\t\t\t\tmethod: !editedItem ? 'POST' : 'PATCH',\r\n\t\t\t\t\ttitle: stateForm.title,\r\n\t\t\t\t\tsum: stateForm.startSum\r\n\t\t\t\t});\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<Input type={'text'} placeholder={'Название бюджета'} top={'Название'} value={stateForm.title}\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t maxLength={'20'}\r\n\t\t\t\t\t\t status={stateForm.validate?.title?.status}\r\n\t\t\t\t\t\t bottom={stateForm.validate?.title?.message ? stateForm.validate?.title?.message : `${stateForm.title.length} из 20`}\r\n\t\t\t\t\t\t onChange={e => dispatchForm({\r\n\t\t\t\t\t\t\t type: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t payload: {title: e.currentTarget.value, validateForm: {title: validate(e)}}\r\n\t\t\t\t\t\t })}/>\r\n\t\t\t<Input type={'number'} placeholder={currency(0)} top={'Бюджет в рублях'} value={stateForm.startSum}\r\n\t\t\t\t\t\t required={true}\r\n\t\t\t\t\t\t status={stateForm.validate?.startSum?.status}\r\n\t\t\t\t\t\t max={999999999}\r\n\t\t\t\t\t\t step={0.01}\r\n\t\t\t\t\t\t bottom={stateForm.validate?.startSum?.message ? stateForm.validate?.startSum?.message : 'Сколько вы готовы на это потратить?'}\r\n\t\t\t\t\t\t onChange={e => dispatchForm({\r\n\t\t\t\t\t\t\t type: 'CHANGE_STATE',\r\n\t\t\t\t\t\t\t payload: {startSum: e.currentTarget.value, validateForm: {startSum: validate(e)}}\r\n\t\t\t\t\t\t })}/>\r\n\t\t\t<Button size={'xl'}>Сохранить</Button>\r\n\t\t</FormLayout>\r\n\t)\r\n}","import React, {useEffect, useState} from 'react';\r\nimport {\r\n\tAlert,\r\n\tCell,\r\n\tDiv, Footer,\r\n\tList,\r\n\tPanel,\r\n\tPanelHeader,\r\n\tPanelHeaderBack,\r\n\tPanelHeaderButton,\r\n\tPanelHeaderContent,\r\n\tPanelHeaderContext,\r\n\tSearch\r\n} from \"@vkontakte/vkui\";\r\nimport {SET_ACTIVE_VIEW, SET_BUDGET, SET_EDITED_ITEM, SET_HISTORY_BACK, SET_MODAL, SET_POPOUT} from \"../state/actions\";\r\nimport Icon28MarketAddBadgeOutline from \"@vkontakte/icons/dist/28/market_add_badge_outline\";\r\nimport useApi from \"../handlers/useApi\";\r\nimport Icon16Dropdown from \"@vkontakte/icons/dist/16/dropdown\";\r\nimport Icon28DeleteOutline from '@vkontakte/icons/dist/28/delete_outline';\r\nimport Icon28EditOutline from '@vkontakte/icons/dist/28/edit_outline';\r\nimport mapRichCell from \"../handlers/mapRichCell\";\r\nimport InfoSnackbar from \"../components/InfoSnackbar\";\r\nimport sort from \"../handlers/sort\";\r\nimport reduce from \"../handlers/reduce\";\r\n\r\nexport default ({id, budget, dispatch, onRefresh}) => {\r\n\tconst [isOpened, setIsOpened] = useState(false);\r\n\tconst [{response}, doApiFetch] = useApi(`/budget/${budget?._id}`);\r\n\tconst [items, setItems] = useState(() => budget?.items);\r\n\tconst [filteredItems, setFilteredItems] = useState(() => items);\r\n\r\n\tuseEffect(() => {\r\n\t\tsetItems(budget?.items);\r\n\t\tsetFilteredItems(budget?.items);\r\n\t}, [budget])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tif (response?.deletedCount) {\r\n\t\t\tdispatch({type: SET_ACTIVE_VIEW, payload: {view: 'home', panel: 'home'}});\r\n\t\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: null}});\r\n\t\t\tonRefresh();\r\n\t\t}\r\n\t}, [response, dispatch, onRefresh]);\r\n\r\n\tconst toggleContext = () => {\r\n\t\tsetIsOpened(!isOpened);\r\n\t}\r\n\r\n\tconst alertDelete = (\r\n\t\t<Alert\r\n\t\t\tactions={[\r\n\t\t\t\t{\r\n\t\t\t\t\ttitle: 'Отмена',\r\n\t\t\t\t\tautoclose: true,\r\n\t\t\t\t\tmode: \"cancel\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttitle: 'Удалить',\r\n\t\t\t\t\tautoclose: true,\r\n\t\t\t\t\taction: async () => {\r\n\t\t\t\t\t\ttoggleContext();\r\n\t\t\t\t\t\tawait doApiFetch({\r\n\t\t\t\t\t\t\tmethod: 'DELETE'\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]}\r\n\t\t\tonClose={() => {\r\n\t\t\t\ttoggleContext();\r\n\t\t\t\tdispatch({type: SET_POPOUT, payload: {popout: null}})\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<h2>Удалить бюджет?</h2>\r\n\t\t\t<p>Вы действительно хотите удалить бюджет?</p>\r\n\t\t</Alert>\r\n\t)\r\n\r\n\tconst itemsList = filteredItems && filteredItems.sort(sort).reduce(reduce, []).map(mapRichCell(dispatch));\r\n\r\n\tconst onSearch = (str) => {\r\n\t\tif (str === '') {\r\n\t\t\tsetFilteredItems(items);\r\n\t\t} else {\r\n\t\t\tsetFilteredItems(budget.items.filter(({title}) => title.toLowerCase().indexOf(str.toLowerCase()) > -1));\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Panel id={id}>\r\n\t\t\t<PanelHeader left={\r\n\t\t\t\t<>\r\n\t\t\t\t\t<PanelHeaderBack onClick={() => {\r\n\t\t\t\t\t\t// dispatch({type: SET_ACTIVE_VIEW, payload: {view: 'home', panel: 'home'}});\r\n\t\t\t\t\t\tdispatch({type: SET_HISTORY_BACK});\r\n\t\t\t\t\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: null}});\r\n\t\t\t\t\t\tdispatch({type: SET_BUDGET, payload: {id: null}});\r\n\t\t\t\t\t}}/>\r\n\t\t\t\t\t<PanelHeaderButton\r\n\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\tdispatch({type: SET_EDITED_ITEM, payload: {item: null}});\r\n\t\t\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: 'add-money'}});\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Icon28MarketAddBadgeOutline/>\r\n\t\t\t\t\t</PanelHeaderButton>\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\t\t\t>\r\n\t\t\t\t<PanelHeaderContent\r\n\t\t\t\t\taside={<Icon16Dropdown style={{transform: `rotate(${isOpened ? '180deg' : '0'})`}}/>}\r\n\t\t\t\t\tonClick={toggleContext}\r\n\t\t\t\t>\r\n\t\t\t\t\t{budget?.title}\r\n\t\t\t\t</PanelHeaderContent>\r\n\t\t\t</PanelHeader>\r\n\t\t\t<PanelHeaderContext opened={isOpened} onClose={toggleContext}>\r\n\t\t\t\t<List>\r\n\t\t\t\t\t<Cell\r\n\t\t\t\t\t\tbefore={<Icon28EditOutline/>}\r\n\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\tdispatch({type: SET_MODAL, payload: {modal: 'add-budget'}})\r\n\t\t\t\t\t\t\ttoggleContext();\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\tИзменить бюджет {budget?.title}\r\n\t\t\t\t\t</Cell>\r\n\t\t\t\t\t<Cell\r\n\t\t\t\t\t\tbefore={<Icon28DeleteOutline/>}\r\n\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\tdispatch({type: SET_POPOUT, payload: {popout: alertDelete}})\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\tУдалить бюджет {budget?.title}\r\n\t\t\t\t\t</Cell>\r\n\t\t\t\t</List>\r\n\t\t\t</PanelHeaderContext>\r\n\t\t\t<Search onChange={(e) => {\r\n\t\t\t\tonSearch(e.currentTarget.value)\r\n\t\t\t}}/>\r\n\t\t\t<Div>\r\n\t\t\t\t{itemsList}\r\n\t\t\t\t{itemsList?.length === 0 && <Footer>Нет данных для отображения</Footer>}\r\n\t\t\t</Div>\r\n\t\t\t<InfoSnackbar/>\r\n\t\t</Panel>\r\n\t)\r\n}","import React, { useState, useEffect } from 'react';\r\nimport {Footer, Group, Panel, PanelHeader, Search} from \"@vkontakte/vkui\";\r\nimport MonthSwitch from \"../components/MonthSwitch\";\r\nimport mapStats from \"../handlers/mapStats\";\r\n\r\nexport default ({id, accounts, onRefresh}) => {\r\n\tconst [operations, setOperations] = useState(() => {\r\n\t\treturn accounts\r\n\t\t\t.map(item => item.operations)\r\n\t\t\t.flat()\r\n\t\t\t.filter(({income}) => !income)\r\n\t\t\t.sort((a, b) => a.title.localeCompare(b.title))\r\n\t});\r\n\tconst [filteredItems, setFilteredItems] = useState(() => operations);\r\n\tconst reducer = (prev, curr) => {\r\n\t\tif (prev[prev.length-1]?.title === curr.title) {\r\n\t\t\tconst prevItem = prev[prev.length-1];\r\n\t\t\tprevItem.sum = prevItem.sum + curr.sum;\r\n\t\t\tprevItem.quantity += curr.quantity;\r\n\t\t\tconst array = [...prev.slice(0, prev.length-1), prevItem];\r\n\t\t\treturn [...array];\r\n\t\t} else {\r\n\t\t\treturn [...prev, {title: curr.title, sum: curr.sum, quantity: curr.quantity}];\r\n\t\t}\r\n\t}\r\n\r\n\tconst accountItemsList = filteredItems\r\n\t\t.reduce(reducer, [])\r\n\t\t.map(mapStats());\r\n\r\n\tuseEffect(() => {\r\n\t\tconst items = accounts\r\n\t\t\t.map(item => item.operations)\r\n\t\t\t.flat()\r\n\t\t\t.filter(({income}) => !income)\r\n\t\t\t.sort((a, b) => a.title.localeCompare(b.title));\r\n\t\tsetOperations(items);\r\n\t\tsetFilteredItems(items);\r\n\t}, [accounts])\r\n\r\n\tconst onSearch = (str) => {\r\n\t\tif (str === '') {\r\n\t\t\tsetFilteredItems(accounts\r\n\t\t\t\t.map(item => item.operations)\r\n\t\t\t\t.flat()\r\n\t\t\t\t.filter(({income}) => !income)\r\n\t\t\t\t.sort((a, b) => a.title.localeCompare(b.title))\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tsetFilteredItems(accounts\r\n\t\t\t\t.map(item => item.operations)\r\n\t\t\t\t.flat()\r\n\t\t\t\t.filter(({income}) => !income)\r\n\t\t\t\t.sort((a, b) => a.title.localeCompare(b.title))\r\n\t\t\t\t.filter(({title}) => title.toLowerCase().indexOf(str.toLowerCase()) > -1));\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Panel id={id}>\r\n\t\t\t<PanelHeader>\r\n\t\t\t\tСводка\r\n\t\t\t</PanelHeader>\r\n\t\t\t<MonthSwitch onRefresh={onRefresh} />\r\n\t\t\t<Search onChange={(e) => {\r\n\t\t\t\tonSearch(e.currentTarget.value)\r\n\t\t\t}}/>\r\n\t\t\t<Group>\r\n\t\t\t\t{accountItemsList}\r\n\t\t\t\t{accountItemsList.length === 0 && <Footer>Нет данных для отображения</Footer>}\r\n\t\t\t</Group>\r\n\t\t</Panel>\r\n\t)\r\n}","import React from 'react';\r\nimport {RichCell} from \"@vkontakte/vkui\";\r\nimport currency from \"./currency\";\r\n\r\nexport default () => {\r\n\treturn (item, index) => {\r\n\t\treturn (\r\n\t\t\t<RichCell\r\n\t\t\t\tkey={index}\r\n\t\t\t\tmultiline\r\n\t\t\t\tcaption={`Кол-во: ${item?.quantity} | Ср. цена ${currency(item?.sum/item?.quantity)}`}\r\n\t\t\t\tafter={currency(item?.sum)}\r\n\t\t\t\tdata-title={item?.title}\r\n\t\t\t>\r\n\t\t\t\t{item?.title}\r\n\t\t\t</RichCell>\r\n\t\t)\r\n\t}\r\n}","import React, {useCallback, useContext, useEffect, useState} from 'react';\r\nimport View from '@vkontakte/vkui/dist/components/View/View';\r\nimport '@vkontakte/vkui/dist/vkui.css';\r\nimport Home from './panels/Home';\r\nimport useApi from \"./handlers/useApi\";\r\nimport {State} from './state';\r\nimport {SET_ACCOUNTS, SET_ACTIVE_VIEW, SET_BUDGETS, SET_HISTORY_BACK, SET_MODAL} from \"./state/actions\";\r\nimport {\r\n\tANDROID,\r\n\tEpic,\r\n\tIOS,\r\n\tModalPage,\r\n\tModalPageHeader,\r\n\tModalRoot,\r\n\tPanelHeaderButton,\r\n\tplatform,\r\n\tTabbar,\r\n\tTabbarItem\r\n} from \"@vkontakte/vkui\";\r\nimport Icon24Cancel from '@vkontakte/icons/dist/24/cancel';\r\nimport Icon24Done from '@vkontakte/icons/dist/24/done';\r\nimport Icon28HomeOutline from '@vkontakte/icons/dist/28/home_outline';\r\nimport Icon28CoinsOutline from '@vkontakte/icons/dist/28/coins_outline';\r\nimport Icon28StatisticsOutline from '@vkontakte/icons/dist/28/statistics_outline';\r\nimport AddAccount from \"./components/modals/AddAccount\";\r\nimport AddMoney from \"./components/modals/AddMoney\";\r\nimport AccountInfo from \"./panels/AccountInfo\";\r\nimport Budgets from \"./panels/Budgets\";\r\nimport AddBudget from \"./components/modals/AddBudget\";\r\nimport BudgetInfo from \"./panels/BudgetInfo\";\r\nimport Stats from \"./panels/Stats\";\r\n\r\nconst App = () => {\r\n\tconst os = platform();\r\n\tconst [{response, isLoading}, doApiFetch] = useApi('/state');\r\n\tconst [needFetch, setNeedFetch] = useState(true);\r\n\tconst [state, dispatch] = useContext(State);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!needFetch) return;\r\n\t\tdoApiFetch({\r\n\t\t\tparams: {\r\n\t\t\t\tdate: new Date(state.currentDate)\r\n\t\t\t}\r\n\t\t});\r\n\t\tsetNeedFetch(false);\r\n\t}, [needFetch, doApiFetch, state.currentDate]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tdispatch({type: SET_ACCOUNTS, payload: {accounts: response?.accounts ? response?.accounts : []}});\r\n\t\tdispatch({type: SET_BUDGETS, payload: {budgets: response?.budgets ? response?.budgets : []}});\r\n\t}, [response, dispatch]);\r\n\r\n\tuseEffect(() => {\r\n\t\twindow.onpopstate = (e) => {\r\n\t\t\tif (state.history.length !== 0) {\r\n\t\t\t\treturn dispatch({type: SET_HISTORY_BACK, payload: {state: e.state}});\r\n\t\t\t}\r\n\t\t}\r\n\t}, [dispatch, state.history]);\r\n\r\n\tconst onRefresh = useCallback(() => {\r\n\t\tsetNeedFetch(true);\r\n\t}, []);\r\n\r\n\tconst modalBack = () => {\r\n\t\tdispatch({type: SET_MODAL, payload: {modal: null}});\r\n\t}\r\n\r\n\tconst modal = (\r\n\t\t<ModalRoot\r\n\t\t\tactiveModal={state.modal}\r\n\t\t\tonClose={modalBack}\r\n\t\t>\r\n\t\t\t<ModalPage id={'add-account'} header={\r\n\t\t\t\t<ModalPageHeader\r\n\t\t\t\t\tleft={os === ANDROID && <PanelHeaderButton onClick={modalBack}><Icon24Cancel/></PanelHeaderButton>}\r\n\t\t\t\t\tright={<PanelHeaderButton onClick={modalBack}>{os === IOS ? 'Готово' : <Icon24Done/>}</PanelHeaderButton>}\r\n\t\t\t\t>\r\n\t\t\t\t\tДобавить счет\r\n\t\t\t\t</ModalPageHeader>\r\n\t\t\t}>\r\n\t\t\t\t<AddAccount onRefresh={onRefresh}/>\r\n\t\t\t</ModalPage>\r\n\r\n\t\t\t<ModalPage id={'add-money'} header={\r\n\t\t\t\t<ModalPageHeader\r\n\t\t\t\t\tleft={os === ANDROID && <PanelHeaderButton onClick={modalBack}><Icon24Cancel/></PanelHeaderButton>}\r\n\t\t\t\t\tright={<PanelHeaderButton onClick={modalBack}>{os === IOS ? 'Готово' : <Icon24Done/>}</PanelHeaderButton>}\r\n\t\t\t\t>\r\n\t\t\t\t\t{state.editedItem ? 'Редактировать' : 'Добавить запись'}\r\n\t\t\t\t</ModalPageHeader>\r\n\t\t\t}>\r\n\t\t\t\t<AddMoney accounts={state.accounts} id={state.account?._id}\r\n\t\t\t\t\t\t\t\t\teditedItem={state.editedItem} onRefresh={onRefresh}/>\r\n\t\t\t</ModalPage>\r\n\r\n\t\t\t<ModalPage id={'add-budget'} header={\r\n\t\t\t\t<ModalPageHeader\r\n\t\t\t\t\tleft={os === ANDROID && <PanelHeaderButton onClick={modalBack}><Icon24Cancel/></PanelHeaderButton>}\r\n\t\t\t\t\tright={<PanelHeaderButton onClick={modalBack}>{os === IOS ? 'Готово' : <Icon24Done/>}</PanelHeaderButton>}\r\n\t\t\t\t>\r\n\t\t\t\t\tДобавить бюджет\r\n\t\t\t\t</ModalPageHeader>\r\n\t\t\t}>\r\n\t\t\t\t<AddBudget editedItem={state.budget} onRefresh={onRefresh} dispatch={dispatch}/>\r\n\t\t\t</ModalPage>\r\n\t\t</ModalRoot>\r\n\t)\r\n\r\n\tconst onStoryChange = (e) => {\r\n\t\tdispatch({\r\n\t\t\ttype: SET_ACTIVE_VIEW,\r\n\t\t\tpayload: {view: e.currentTarget.dataset.story, panel: e.currentTarget.dataset.panel}\r\n\t\t})\r\n\t}\r\n\r\n\tconst tabBar = (\r\n\t\t<Tabbar>\r\n\t\t\t<TabbarItem\r\n\t\t\t\tonClick={onStoryChange}\r\n\t\t\t\tselected={state.activeView === 'home'}\r\n\t\t\t\tdata-story={'home'}\r\n\t\t\t\tdata-panel={'home'}\r\n\t\t\t\ttext={'Баланс'}\r\n\t\t\t>\r\n\t\t\t\t<Icon28HomeOutline/>\r\n\t\t\t</TabbarItem>\r\n\t\t\t<TabbarItem\r\n\t\t\t\tonClick={onStoryChange}\r\n\t\t\t\tselected={state.activeView === 'info' && state.activePanel === 'budgets'}\r\n\t\t\t\tdata-story={'info'}\r\n\t\t\t\tdata-panel={'budgets'}\r\n\t\t\t\ttext={'Бюджеты'}\r\n\t\t\t>\r\n\t\t\t\t<Icon28CoinsOutline/>\r\n\t\t\t</TabbarItem>\r\n\t\t\t<TabbarItem\r\n\t\t\t\tonClick={onStoryChange}\r\n\t\t\t\tselected={state.activeView === 'info' && state.activePanel === 'stats'}\r\n\t\t\t\tdata-story={'info'}\r\n\t\t\t\tdata-panel={'stats'}\r\n\t\t\t\ttext={'Сводка'}\r\n\t\t\t>\r\n\t\t\t\t<Icon28StatisticsOutline/>\r\n\t\t\t</TabbarItem>\r\n\t\t</Tabbar>\r\n\t)\r\n\r\n\treturn (\r\n\t\t<Epic activeStory={state.activeView} tabbar={tabBar}>\r\n\t\t\t<View id={'home'} activePanel={state.activePanel} popout={state.popout} modal={modal}>\r\n\t\t\t\t<Home id='home' accounts={state.accounts} budgets={state.budgets} dispatch={dispatch} isLoading={isLoading}\r\n\t\t\t\t\t\t\tonRefresh={onRefresh} isFetching={isLoading}/>\r\n\t\t\t</View>\r\n\t\t\t<View id={'info'} activePanel={state.activePanel} popout={state.popout} modal={modal}>\r\n\t\t\t\t<AccountInfo id={'account'} account={state.accounts.find(item => item._id === state.account?._id)}\r\n\t\t\t\t\t\t\t\t\t\t dispatch={dispatch} onRefresh={onRefresh}/>\r\n\t\t\t\t<BudgetInfo id={'budget'} budget={state.budgets.find(item => item._id === state.budget?._id)}\r\n\t\t\t\t\t\t\t\t\t\tdispatch={dispatch} onRefresh={onRefresh}/>\r\n\t\t\t\t<Budgets id={'budgets'} budgets={state.budgets} dispatch={dispatch} onRefresh={onRefresh} date={state.currentDate}/>\r\n\t\t\t\t<Stats id={'stats'} accounts={state.accounts} onRefresh={onRefresh} dispatch={dispatch}/>\r\n\t\t\t</View>\r\n\t\t</Epic>\r\n\t);\r\n}\r\n\r\nexport default App;\r\n\r\n","import \"core-js/features/map\";\r\nimport \"core-js/features/set\";\r\nimport React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport bridge from \"@vkontakte/vk-bridge\";\r\nimport App from \"./App\";\r\nimport {StateProvider} from \"./state\";\r\n\r\nbridge.subscribe(({detail: {type, data}}) => {\r\n  if (type === 'VKWebAppUpdateConfig') {\r\n    const schemeAttribute = document.createAttribute('scheme');\r\n    schemeAttribute.value = data.scheme ? data.scheme : 'client_light';\r\n    document.body.attributes.setNamedItem(schemeAttribute);\r\n  }\r\n});\r\n// Init VK  Mini App\r\nbridge.send(\"VKWebAppInit\");\r\n\r\nReactDOM.render(\r\n  <StateProvider>\r\n    <App />\r\n  </StateProvider>, document.getElementById(\"root\"));\r\nif (process.env.NODE_ENV === \"development\") {\r\n  import(\"./eruda\").then(({ default: eruda }) => {}); //runtime download\r\n}\r\nimport(\"./eruda\").then(({ default: eruda }) => {}); //runtime download\r\n"],"sourceRoot":""}